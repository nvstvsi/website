<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>covering</title>
  <script>
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$', '$$'], ['\\[', '\\]']],
      processEscapes: true,
      processEnvironments: true,
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '0.8em',
      packages: {'[+]': ['ams']},
      macros: {
        R: '\\mathbb{R}',
        C: '\\mathbb{C}',
        N: '\\mathbb{N}',
        Z: '\\mathbb{Z}',
        Q: '\\mathbb{Q}',
        E: '\\mathbb{E}',
        F: '\\mathbb{F}',
        S: '\\mathbb{S}',
        H: '\\mathcal{H}',
        L: '\\mathcal{L}',
        dif: '\\,\\mathrm{d}',
        supp: '\\operatorname{supp}',
        proj: '\\operatorname{proj}',
        Id: '\\operatorname{Id}',
        Span: '\\operatorname{span}',
        graph: '\\operatorname{graph}',
        dist: '\\operatorname{dist}',
        diam: '\\operatorname{diam}',
        avg: '\\operatorname{avg}',
        div: '\\operatorname{div}',
        vol: '\\operatorname{vol}',
        ord: '\\operatorname{ord}',
        Chi: '\\mathbf{1}',
        sub: '\\subseteq',
        mres: '\\downharpoonright',
        ddag: '\\ddagger',
        dag: '\\dagger',
        norm: ['\\left\\| #1 \\right\\|', 1],
        abs: ['\\left| #1 \\right|', 1],
        set: ['\\left\\{ #1 \\right\\}', 1],
        inner: ['\\langle #1, #2 \\rangle', 2],
        floor: ['\\lfloor #1 \\rfloor', 1],
        ceil: ['\\lceil #1 \\rceil', 1],
        bigskull: '\\unicode{x1F480}',
        skull: '\\unicode{x2620}',
        mathwitch: '\\unicode{x1F9D9}',
        pumpkin: '\\unicode{x1F383}',
        mathpumpkin: '\\unicode{x1F383}',
        bigpumpkin: '\\unicode{x1F383}',
        mathghost: '\\unicode{x1F47B}',
        mathcat: '\\unicode{x1F408}',
        mathbat: '\\unicode{x1F987}',
        esssup: '\\operatorname{ess\\,sup}',
        essinf: '\\operatorname{ess\\,inf}',
        Lip: '\\operatorname{Lip}',
        pd: ['\\frac{\\partial#1}{\\partial#2}', 2],
        od: ['\\frac{\\mathrm{d}#1}{\\mathrm{d}#2}', 2],
        dashint: '\\mathchoice{\\rlap{-}\\!\\int}{\\rlap{\\raise.15ex\\hbox{\\smash{\\scriptscriptstyle-}}}\\int}{\\rlap{\\raise.09ex\\hbox{\\smash{\\scriptscriptstyle-}}}\\int}{\\rlap{\\raise.09ex\\hbox{\\smash{\\scriptscriptstyle-}}}\\int}'
      }
    },
    startup: {
      pageReady: () => {
        return MathJax.startup.defaultPageReady().then(() => {
          console.log('MathJax ready');
        });
      }
    }
  };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" id="MathJax-script"></script>
  <script>
  // Auto-reload when watch.js signals a rebuild
  (function() {
    // Save state before unload
    window.addEventListener('beforeunload', function() {
      saveProofState();
      saveCollapsibleState();
    });
    
    const eventSource = new EventSource('http://localhost:35729/reload-stream');
    
    eventSource.onmessage = function(event) {
      if (event.data === 'reload') {
        console.log('üìù File updated, saving state and reloading...');
        // Save state before reload
        saveProofState();
        saveCollapsibleState();
        // Small delay to ensure localStorage flush
        setTimeout(() => {
          window.location.reload();
        }, 50);
      }
    };
    
    eventSource.onerror = function() {
      console.log('‚ö†Ô∏è  Auto-reload server not available. Run node watch.js to enable auto-reload.');
      eventSource.close();
    };
    
    console.log('üîÑ Auto-reload enabled');
  })();
  </script>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: Georgia, "Times New Roman", serif;
      font-size: 16px;
      line-height: 1.7;
      max-width: 900px;
      margin: 0 auto;
      padding: 40px 20px;
      color: #1a1a1a;
      background: #ffffff;
    }
    h2, h3, h4 {
      margin-top: 2em;
      margin-bottom: 0.75em;
      color: #000;
      font-weight: 600;
    }
    h2 { font-size: 1.5em; border-bottom: 1px solid #e0e0e0; padding-bottom: 0.3em; }
    h3 { font-size: 1.25em; }
    h4 { font-size: 1.1em; }
    p {
      margin: 1em 0;
      text-indent: 2em;
    }
    p:first-of-type,
    h2 + p,
    h3 + p,
    h4 + p,
    .theorem-box + p,
    .proof-box + p {
      text-indent: 0;
    }
    .noindent + p,
    p:has(> .noindent:first-child) {
      text-indent: 0 !important;
    }
    .noindent {
      display: none;
    }
    .theorem-box {
      margin: 1.75em 0;
      padding: 1.25em;
      border-left: 5px solid #16a34a;
      background: linear-gradient(to top, #bbf7d0 0%, #d1fae5 100%);
      border-radius: 6px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }
    .definition-box { border-left-color: #16a34a; background: linear-gradient(to top, #d1fae5 0%, #ecfdf5 100%); }
    .lemma-box { border-left-color: #1e3a8a; background: linear-gradient(to top, #bfdbfe 0%, #dbeafe 100%); }
    .corollary-box { border-left-color: #9333ea; background: linear-gradient(to top, #e9d5ff 0%, #f3e8ff 100%); }
    .proposition-box { border-left-color: #dc2626; background: linear-gradient(to top, #fecaca 0%, #fee2e2 100%); }
    .remark-box { border-left-color: #64748b; background: linear-gradient(to top, #e2e8f0 0%, #f1f5f9 100%); }
    .example-box { border-left-color: #0891b2; background: linear-gradient(to top, #a5f3fc 0%, #cffafe 100%); }
    .construction-box { border-left-color: #ea580c; background: linear-gradient(to top, #fed7aa 0%, #ffedd5 100%); }
    .notation-box { border-left-color: #ca8a04; background: linear-gradient(to top, #fef08a 0%, #fef9c3 100%); }
    .exercise-box { border-left-color: #ea580c; background: linear-gradient(to top, #fed7aa 0%, #ffedd5 100%); }
    .problem-box { border-left-color: #ec4899; background: linear-gradient(to top, #fbcfe8 0%, #fce7f3 100%); }
    .theorem-header {
      margin-bottom: 0.75em;
      font-size: 1.05em;
      font-weight: 600;
    }
    .theorem-header.clickable {
      cursor: pointer;
      user-select: none;
    }
    .theorem-header.clickable:hover {
      background: rgba(0,0,0,0.03);
      margin: -0.5em -0.75em 0.75em -0.75em;
      padding: 0.5em 0.75em;
      border-radius: 4px;
    }
    .collapsible-icon {
      display: inline-block;
      transition: transform 0.2s ease;
      font-size: 0.75em;
      margin-right: 0.5em;
      color: #6b7280;
    }
    .collapsible-box.collapsed .collapsible-icon {
      transform: rotate(-90deg);
    }
    .collapsible-content {
      transition: max-height 0.3s ease;
      overflow: hidden;
    }
    .collapsible-box.collapsed .collapsible-content {
      display: none;
    }
    .theorem-content {
      padding-left: 0.5em;
      line-height: 1.8;
    }
    .proof-box {
      margin: 1.5em 0;
      border: 1px solid #e5e7eb;
      border-radius: 6px;
      background: white;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }
    .proof-header {
      position: sticky;
      top: 0;
      background: linear-gradient(to bottom, #fafafa 0%, #f5f5f5 100%);
      border-bottom: 1px solid #e5e7eb;
      z-index: 100;
      border-radius: 6px 6px 0 0;
    }
    .proof-toggle {
      width: 100%;
      padding: 0.85em 1.25em;
      border: none;
      background: transparent;
      text-align: left;
      cursor: pointer;
      font-family: inherit;
      font-size: 1em;
      display: flex;
      align-items: center;
      gap: 0.75em;
      transition: background 0.15s;
    }
    .proof-toggle:hover { background: rgba(0,0,0,0.03); }
    .proof-toggle-icon {
      display: inline-block;
      transition: transform 0.2s ease;
      font-size: 0.75em;
      color: #6b7280;
    }
    .proof-box.collapsed .proof-toggle-icon {
      transform: rotate(-90deg);
    }
    .proof-content {
      padding: 1.25em;
      line-height: 1.8;
    }
    .proof-box.collapsed .proof-content {
      display: none;
    }
    .proof-end {
      float: right;
      font-size: 1.3em;
      margin-left: 0.5em;
      color: #374151;
    }
    .subproof {
      margin: 1em 0;
      border: 1px solid #d1d5db;
      border-radius: 4px;
      background: #f9fafb;
    }
    .subproof-header {
      background: linear-gradient(to bottom, #f9fafb 0%, #f3f4f6 100%);
      border-bottom: 1px solid #d1d5db;
      border-radius: 4px 4px 0 0;
    }
    .subproof-toggle {
      width: 100%;
      padding: 0.6em 1em;
      border: none;
      background: transparent;
      text-align: left;
      cursor: pointer;
      font-family: inherit;
      font-size: 0.95em;
      display: flex;
      align-items: center;
      gap: 0.5em;
      transition: background 0.15s;
    }
    .subproof-toggle:hover {
      background: rgba(0,0,0,0.03);
    }
    .subproof-toggle-icon {
      display: inline-block;
      transition: transform 0.2s ease;
      font-size: 0.7em;
      color: #6b7280;
    }
    .subproof.collapsed .subproof-toggle-icon {
      transform: rotate(-90deg);
    }
    .subproof-content {
      padding: 1em;
      line-height: 1.7;
    }
    .subproof.collapsed .subproof-content {
      display: none;
    }
    .ref-link {
      color: #2563eb;
      text-decoration: none;
      font-weight: 500;
      padding: 0 0.15em;
      border-radius: 2px;
    }
    .ref-link:hover {
      background: #dbeafe;
      text-decoration: underline;
    }
    .ref-unknown {
      color: #dc2626;
      font-weight: bold;
      background: #fee2e2;
      padding: 0.1em 0.3em;
      border-radius: 3px;
    }
    strong { font-weight: 600; }
    em { font-style: italic; }
    ol, ul {
      margin: 1em 0;
      padding-left: 2.5em;
      line-height: 1.8;
    }
    li {
      margin: 0.5em 0;
    }
    .latex-image {
      max-width: 100%;
      height: auto;
      display: block;
      margin: 1.5em auto;
    }
    .latex-figure .latex-image {
      display: inline-block;
      margin: 0.5em;
      vertical-align: middle;
    }
    .latex-figure {
      margin: 2em 0;
      text-align: center;
      line-height: 0;
    }
    .latex-figure .figure-content {
      margin-bottom: 0.75em;
      line-height: normal;
    }
    .latex-figure .figure-content > * {
      vertical-align: middle;
    }
    .latex-figure figcaption {
      font-size: 0.9em;
      color: #4b5563;
      font-style: italic;
      margin-top: 0.5em;
    }
  </style>
</head>
<body>
  <h2>Vitali Covering Theorems</h2>
<p>In this section we present some important covering theorems which will be useful in later sections.</p>
<div class="theorem-box notation-box" id="not:dil_ball">
  <div class="theorem-header"><strong>Notation ?</strong></div>
  <div class="theorem-content">Let $(X,d)$ be a metric space.
    For each ball $B \subset X$ and each $\lambda > 0$, we denote by $\lambda B$ the ball with the same center as $B$ and radius $\lambda$ times the radius of $B$.</div>
</div>
<div class="theorem-box lemma-box" id="lem:finite_3r_covering_lemma">
  <div class="theorem-header"><strong>Lemma ?</strong> (Vitali's Finite $3$-times Covering Lemma)</div>
  <div class="theorem-content">Let $(X,d)$ be a metric space. 
    Let $\{ B_j \}_{j=1}^N$ be a finite collection of closed balls in $X$.
    Then there exists a disjoint subcollection $\{ B_{j_k} \}_{k=1}^M$ such that
    \[ \bigcup_{j=1}^N B_j \subseteq \bigcup_{k=1}^M 3 B_{j_k}. \]</div>
</div>
<p>Basically if we are given a finite collection of balls, there exists a disjoint subcollection which, when we triple the radii of the balls in the subcollection, covers all the original balls.</p>
<div class="proof-box collapsed" data-proof-id="proof-num-0">
  <div class="proof-header">
    <button class="proof-toggle" onclick="toggleProof('proof-num-0')" aria-expanded="false">
      <span class="proof-toggle-icon">‚ñº</span>
      <strong>Proof</strong>
    </button>
  </div>
  <div class="proof-content" id="proof-num-0">
    If the number of balls $N = 0$, then the result is trivial.
    Assume $N \geq 1$.
    Let $B_{j_1}$ be a ball of largest radius in the collection $\{ B_j \}_{j=1}^N$.
    If there are multiple such balls, choose one arbitrarily.
<p>Now let $B_{j_2}$ be a ball of largest radius in the collection $\{ B_j \}_{j=1}^N$ which is disjoint from $B_{j_1}$.
    If there is no such ball, then we stop without defining $B_{j_2}$.
    If there are multiple such balls, choose one arbitrarily.</p>
<p>Continuing in this manner, at step $k \geq 2$, assume that we have already defined disjoint balls $B_{j_1}, B_{j_2}, \ldots, B_{j_{k-1}}$.
    Let $B_{j_k}$ be a ball of largest radius in the collection $\{ B_j \}_{j=1}^N$ which is disjoint from each of the previously defined balls $B_{j_1}, B_{j_2}, \ldots, B_{j_{k-1}}$.
    If there is no such ball, then we stop without defining $B_{j_k}$.
    If there are multiple such balls, choose one arbitrarily.
    Since the original collection $\{ B_j \}_{j=1}^N$ is finite, this process must stop after a finite number of steps.
    Suppose the process stops after $M$ steps, so that we have defined disjoint balls $B_{j_1}, B_{j_2}, \ldots, B_{j_M}$.</p>
<p>It remains to prove the desired inclusion.
    Let $B_j$ be an arbitrary ball in the original collection $\{ B_j \}_{j=1}^N$.
    If $B_j$ is one of the selected balls $B_{j_1}, B_{j_2}, \ldots, B_{j_M}$, then clearly $B_j \subseteq 3 B_j$.
    Otherwise, if $B_j$ is not one of the selected balls, then by construction $B_j$ must intersect at least one of the selected balls --- let $B_{j_k}$ be the selected ball which $B_j$ intersects with minimal possible index $k \in \{ 1,2,\ldots,M \}$.
    Note that the radius of $B_j$ is at most the radius of $B_{j_k}$ by construction --- otherwise we would have selected $B_j$ instead of $B_{j_k}$ at step $k$.
    Now for each point $x \in B_j$, we have
    \[ d(x, \text{center}(B_{j_k})) \leq d(x, \text{center}(B_j)) + d(\text{center}(B_j), \text{center}(B_{j_k})) \leq r_j + (r_j + r_{j_k}) \leq 3 r_{j_k}, \]
    where $r_j$ and $r_{j_k}$ denote the radii of $B_j$ and $B_{j_k}$ respectively.
    This shows that $x \in 3 B_{j_k}$, and hence $B_j \subseteq 3 B_{j_k}$.
    Since $B_j$ was arbitrary, this completes the proof.</p>
<p><div style="margin: 1em 0;"></div>
    <em>A pedantic point about centers and radii of balls.</em></p>
<p>Okay extremely pedantic point here: the center and radius of a closed ball is not necessarily unique in an arbitrary metric space.
    That is, there exists metric spaces $(X,d)$ and points $x,y \in X$ with $x \neq y$ such that
    \[ \overline{B}(x,r) = \overline{B}(y,r), \qquad\forall r>0. \]
    The $p$-adic numbers (for any prime $p$) have this property. Very weird, I know.</p>
<p>Here's why you might think this is a problem.
    We have not defined the balls by reference to their centers and radii, so by ``a ball in $X$'' we mean a set $B \subseteq X$ such that there exists $x \in X$ and $r > 0$ with $ B = \overline{B} (x,r).$
    These $x$ and $r$ are not necessarily unique, but we have used them in the proof above --- in the estimates --- and have been speaking of ``the center'' and ``the radius'' of a ball as if they were well-defined.
    If you go through the proof with a particular choice of center and radius for each ball, you will see that the proof works out fine regardless of which choices you make.
    <span class="proof-end">‚ñ°</span>
  </div>
</div></p>
<div class="theorem-box exercise-box" id="ex:vitali_finite_best_constant">
  <div class="theorem-header"><strong>Exercise ?</strong></div>
  <div class="theorem-content">Show that in Lemma <span class="ref-unknown" title="Reference not found: lem:finite_3r_covering_lemma">[lem:finite_3r_covering_lemma?]</span>, the constant $3$ is the best possible.</div>
</div>
<div class="proof-box collapsed" data-proof-id="proof-num-1">
  <div class="proof-header">
    <button class="proof-toggle" onclick="toggleProof('proof-num-1')" aria-expanded="false">
      <span class="proof-toggle-icon">‚ñº</span>
      <strong>Proof</strong>
    </button>
  </div>
  <div class="proof-content" id="proof-num-1">
    Let $(X,d) = (\R, |\cdot|)$ be the real line with the usual metric, and let
    \[ \mathcal{F} := \{ [-1,1], [1,3] \}. \] 
    Then any disjoint subcollection $\mathcal{C} \subseteq \mathcal{F}$ can contain at most one interval, since the two intervals in $\mathcal{F}$ are disjoint.
    If $\mathcal{C} = \{ [-1,1] \}$, then for each $r < 3$, we have
    \[ [1,3] \not\subseteq r[-1,1] = [-r,r] \]
    Similarly, if $\mathcal{C} = \{ [1,3] \}$, then for each $r < 3$, we have
    \[ [-1,1] \not\subseteq r[1,3] = [2-r, 2+r]. \]
    Draw the picture on a number line.
<p>This shows that the conclusion of Lemma <span class="ref-unknown" title="Reference not found: lem:finite_3r_covering_lemma">[lem:finite_3r_covering_lemma?]</span> fails if we replace the constant $3$ by any smaller constant.
    <span class="proof-end">‚ñ°</span>
  </div>
</div></p>
<p>This is cool, but what if we have an infinite collection of balls?</p>
<div class="theorem-box lemma-box" id="lem:infinite_5r_covering_lemma">
  <div class="theorem-header"><strong>Lemma ?</strong> (Vitali's Infinite $5$-times Covering Lemma)</div>
  <div class="theorem-content">Let $(X,d)$ be a seperable metric space.
    Let $\mathcal{F}$ be an arbitrary collection of closed balls in $X$ with uniformly bounded radii, i.e.,
    \[ R := \sup \{ \text{radius}(B) : B \in \mathcal{F} \} < \infty. \]
    Then there exists a countable disjoint subcollection $\{ B_j \}_{j=1}^\infty \subseteq \mathcal{F}$ such that
    \[ \bigcup_{B \in \mathcal{F}} B \subseteq \bigcup_{j=1}^\infty 5 B_j. \]</div>
</div>
<p>Note that the seperability assumption on $(X,d)$ is necessary to ensure that we can extract a countable subcollection of balls (as no uncountable disjoint collection of balls can exist in a seperable metric space).</p>
<div class="proof-box collapsed" data-proof-id="proof-num-2">
  <div class="proof-header">
    <button class="proof-toggle" onclick="toggleProof('proof-num-2')" aria-expanded="false">
      <span class="proof-toggle-icon">‚ñº</span>
      <strong>Proof</strong>
    </button>
  </div>
  <div class="proof-content" id="proof-num-2">
    For each integer $k \geq 0$, define
    \[ \mathcal{F}_k := \{ B \in \mathcal{F} : 2^{-k-1} R < \text{radius}(B) \leq 2^{-k} R \} \]
    so that $\mathcal{F}_k$ is the collection of balls in $\mathcal{F}$ whose radii lie in the interval $( 2^{-k-1} R, 2^{-k} R ]$.
<p>This defines a partition of $\mathcal{F}$, i.e., we have
    \[ \mathcal{F} = \bigcup_{k=0}^\infty \mathcal{F}_k. \]
    We define a sequence $\{ \mathcal{C}_k \}_{k=0}^\infty$ as follows.
    First, we set $\mathcal{C}_0$ to be a maximal disjoint subcollection of $\mathcal{F}_0$ (which exists by Zorn's Lemma).
    Let $\mathcal{C}_1$ be a maximal disjoint subcollection of
    \[ \{ B \in \mathcal{F}_1 : B \cap C = \emptyset \text{ for all } C \in \mathcal{C}_0 \}. \]
    Continuing in this manner, for each integer $k \geq 1$, we define $\mathcal{C}_k$ to be a maximal disjoint subcollection of
    \[ \{ B \in \mathcal{F}_k : B \cap C = \emptyset \text{ for all } C \in \bigcup_{j=0}^{k-1} \mathcal{C}_j \}. \]
    Finally, we define
    \[ \mathcal{C} := \bigcup_{k=0}^\infty \mathcal{C}_k. \]
    By construction, $\mathcal{C}$ is a disjoint collection of balls in $\mathcal{F}$.
    Since $(X,d)$ is seperable, this implies that $\mathcal{C}$ is countable, so we may write $\mathcal{C} = \{ B_j \}_{j=1}^\infty$.</p>
<p>It remains to prove the desired inclusion.
    Let $B \in \mathcal{F}$ be arbitrary.
    Then there exists a unique integer $k \geq 0$ such that $B \in \mathcal{F}_k$.
    There are two possibilities --- either $B$ satisfies
    \[ B \cap \hat{B} = \emptyset \quad\text{ for all }\  \hat{B} \in \bigcup_{j=0}^{k-1} \mathcal{C}_j \]
    or not.</p>
<p>If $B\cap \hat{B} = \emptyset$ for all $\hat{B} \in \bigcup_{j=0}^{k-1} \mathcal{C}_j$, then by maximality of $\mathcal{C}_k$, we must have $B \in \mathcal{C}_k$.
    Otherwise, if there exists some $\hat{B} \in \bigcup_{j=0}^{k-1} \mathcal{C}_j$ such that $B \cap \hat{B} \neq \emptyset$, then $B$ intersects a ball from the union of $\mathcal{C}_0, \mathcal{C}_1, \ldots, \mathcal{C}_{k-1}$.
    In either case, the ball $B$ intersects some ball $\hat{B}$ that belongs to the union of the collections $\mathcal{C}_0, \mathcal{C}_1, \ldots, \mathcal{C}_k$.
    Note that such a ball $\hat{B}$ must have radius at least $2^{-k-1} R$ since it belongs to one of the collections $\mathcal{C}_0, \mathcal{C}_1, \ldots, \mathcal{C}_k$.
    Meanwhile, the radius of $B$ is at most $2^{-k} R$ since $B \in \mathcal{F}_k$.
    Thus for each point $x \in B$, we have
    \begin{align*}
        d(x, \text{center}(\hat{B})) &\leq d(x, \text{center}(B)) + d(\text{center}(B), \text{center}(\hat{B})) \\
            &\leq r_B + (r_B + r_{\hat{B}}) \\
            &= 2 r_B + r_{\hat{B}} \\
            &\leq 2 \cdot 2^{-k} R + r_{\hat{B}} \\
            &= 4\cdot 2^{-k-1} R + r_{\hat{B}} \\
            &\leq 4 r_{\hat{B}} + r_{\hat{B}} = 5 r_{\hat{B}},
    \end{align*}
    where $r_B$ and $r_{\hat{B}}$ denote the radii of $B$ and $\hat{B}$ respectively.
    This shows that $x \in 5 \hat{B}$, and hence $B \subseteq 5 \hat{B}$.
    Since $B\in \mathcal{F}$ was arbitrary, this completes the proof.
    <span class="proof-end">‚ñ°</span>
  </div>
</div></p>
<div class="theorem-box exercise-box" id="ex:vitali_infinite_best_constant">
  <div class="theorem-header"><strong>Exercise ?</strong> (Best Constant in Infinite Vitali Covering Lemma)</div>
  <div class="theorem-content">Show that in Lemma <span class="ref-unknown" title="Reference not found: lem:infinite_5r_covering_lemma">[lem:infinite_5r_covering_lemma?]</span>, the constant $5$ can be replaced by any constant larger than $3$, but not by $3$ itself.</div>
</div>
<p>Why $5$? We like $5$. $5$ is cool.</p>
<div class="proof-box collapsed" data-proof-id="proof-num-3">
  <div class="proof-header">
    <button class="proof-toggle" onclick="toggleProof('proof-num-3')" aria-expanded="false">
      <span class="proof-toggle-icon">‚ñº</span>
      <strong>Proof</strong>
    </button>
  </div>
  <div class="proof-content" id="proof-num-3">
    Fix $b>1$. 
    For each integer $k \geq 0$, define
    \[ \mathcal{F}_k := \{ B \in \mathcal{F} : b^{-k-1} R < \text{radius}(B) \leq b^{-k} R \} \]
    instead of the dyadic definition in the proof of Lemma <span class="ref-unknown" title="Reference not found: lem:infinite_5r_covering_lemma">[lem:infinite_5r_covering_lemma?]</span>.
<p>Following the exact same proof as in Lemma <span class="ref-unknown" title="Reference not found: lem:infinite_5r_covering_lemma">[lem:infinite_5r_covering_lemma?]</span>, we can construct a countable disjoint subcollection $\mathcal{C} \subseteq \mathcal{F}$.
    We claim that 
    \[ \bigcup_{B \in \mathcal{F}} B \subseteq \bigcup_{B \in \mathcal{C}} (1 + 2b)B. \]</p>
<p>Let $B \in \mathcal{F}$ be arbitrary.
    Then there exists a unique integer $k \geq 0$ such that $B \in \mathcal{F}_k$.
    There are two possibilities --- either $B$ satisfies
    \[ B \cap \hat{B} = \emptyset \quad\text{ for all }\  \hat{B} \in \bigcup_{j=0}^{k-1} \mathcal{C}_j \]
    or not.</p>
<p>If $B\cap \hat{B} = \emptyset$ for all $\hat{B} \in \bigcup_{j=0}^{k-1} \mathcal{C}_j$, then by maximality of $\mathcal{C}_k$, we must have $B \in \mathcal{C}_k$.
    Otherwise, if there exists some $\hat{B} \in \bigcup_{j=0}^{k-1} \mathcal{C}_j$ such that $B \cap \hat{B} \neq \emptyset$, then $B$ intersects a ball from the union of $\mathcal{C}_0, \mathcal{C}_1, \ldots, \mathcal{C}_{k-1}$.
    In either case, the ball $B$ intersects some ball $\hat{B}$ that belongs to the union of the collections $\mathcal{C}_0, \mathcal{C}_1, \ldots, \mathcal{C}_k$.
    Note that such a ball $\hat{B}$ must have radius at least $c^{-k-1} R$ since it belongs to one of the collections $\mathcal{C}_0, \mathcal{C}_1, \ldots, \mathcal{C}_k$.
    Meanwhile, the radius of $B$ is at most $c^{-k} R$ since $B \in \mathcal{F}_k$.
    Thus for each point $x \in B$, we have
    \begin{align*}
        d(x, \text{center}(\hat{B})) &\leq d(x, \text{center}(B)) + d(\text{center}(B), \text{center}(\hat{B})) \\
            &\leq r_B + (r_B + r_{\hat{B}}) \\
            &= 2 r_B + r_{\hat{B}} \\
            &\leq 2 \cdot c^{-k} R + r_{\hat{B}} \\
            &= 2c\cdot c^{-k-1} R + r_{\hat{B}} \\
            &\leq 2c r_{\hat{B}} + r_{\hat{B}} = (1 + 2c) r_{\hat{B}},
    \end{align*}
    where $r_B$ and $r_{\hat{B}}$ denote the radii of $B$ and $\hat{B}$ respectively.
    This shows that $x \in (1 + 2c) \hat{B}$, and hence $B \subseteq (1 + 2c) \hat{B}$.
    Since $B\in \mathcal{F}$ was arbitrary, this proves the claim.</p>
<p>This also proves that the constant $5$ in Lemma <span class="ref-unknown" title="Reference not found: lem:infinite_5r_covering_lemma">[lem:infinite_5r_covering_lemma?]</span> can be replaced by any constant larger than $3$ by choosing $b > 1$ such that $1 + 2b$ equals the desired constant.</p>
<p><div style="margin: 1em 0;"></div></p>
<p>Now we show that the constant $3$ cannot be achieved.
    Let $(X,d) = (\R, |\cdot|)$ be the real line with the usual metric, and let
    \[ \mathcal{F} := \{ ( x - r, x + r ) : |x| < 1/2, 0 < r < (|x|+1)/3 \}. \]
    Then each interval in $\mathcal{F}$ contains $0$ so any disjoint subcollection $\mathcal{C} \subseteq \mathcal{F}$ can contain at most one interval.
    However see that 
    \[ (-1,1) = \bigcup_{|x| < 1/2} ( x - (|x|+1)/3, x + (|x|+1)/3 ) \]
    but for each interval $( x - r, x + r ) \in \mathcal{F}$, we have
    \[ (-1,1) \not\subseteq 3( x - r, x + r ) = ( x - 3r, x + 3r ). \]
    Let's check this --- if $0\leq x < 1/2$, then $x - 3r > x - (|x|+1) = -1$, so $( x - 3r, x + 3r )$ does not contain $(-1,1)$, and if $-1/2 < x < 0$, then $x + 3r < x + (|x|+1) = 1$, so again $( x - 3r, x + 3r )$ does not contain $(-1,1)$.
    This shows that the conclusion of Lemma <span class="ref-unknown" title="Reference not found: lem:infinite_5r_covering_lemma">[lem:infinite_5r_covering_lemma?]</span> fails if we replace the constant $5$ by $3$.
    <span class="proof-end">‚ñ°</span>
  </div>
</div></p>
<div class="theorem-box exercise-box" id="ex:vitali_infinite_no_bounded_radii">
  <div class="theorem-header"><strong>Exercise ?</strong> (Unbounded Radii in Infinite Vitali Covering Lemma)</div>
  <div class="theorem-content">Show that if we remove the assumption that the radii of the balls in $\mathcal{F}$ are uniformly bounded in Lemma <span class="ref-unknown" title="Reference not found: lem:infinite_5r_covering_lemma">[lem:infinite_5r_covering_lemma?]</span>, then the conclusion of the lemma may fail.</div>
</div>
<div class="proof-box collapsed" data-proof-id="proof-num-4">
  <div class="proof-header">
    <button class="proof-toggle" onclick="toggleProof('proof-num-4')" aria-expanded="false">
      <span class="proof-toggle-icon">‚ñº</span>
      <strong>Proof</strong>
    </button>
  </div>
  <div class="proof-content" id="proof-num-4">
    Let $(X,d) = (\R, |\cdot|)$ be the real line with the usual metric, and let
    \[ \mathcal{F} := \{ [-r,r] : r > 0 \}. \]
    Then $\mathcal{F}$ is the collection of all closed intervals centered at the origin.
    Then any disjoint subcollection $\mathcal{C} \subseteq \mathcal{F}$ can contain at most one interval, since any two intervals in $\mathcal{F}$ intersect.
    But for each interval $[-R,R] \in \mathcal{F}$ with $R > 0$, we have
    \[ \R = \bigcup_{r > 0} [-r,r] \not\subseteq 5[-R,R] = [-5R, 5R]. \]
    This shows that the conclusion of Lemma <span class="ref-unknown" title="Reference not found: lem:infinite_5r_covering_lemma">[lem:infinite_5r_covering_lemma?]</span> fails in this case.
    <span class="proof-end">‚ñ°</span>
  </div>
</div>
<div class="theorem-box exercise-box" id="ex:vitali_infinite_no_separability">
  <div class="theorem-header"><strong>Exercise ?</strong> (Non-Separability in Infinite Vitali Covering Lemma)</div>
  <div class="theorem-content">Show that if we drop the assumption that $(X,d)$ is separable in Lemma <span class="ref-unknown" title="Reference not found: lem:infinite_5r_covering_lemma">[lem:infinite_5r_covering_lemma?]</span>, then the set $\mathcal{C}$ may not be countable, but retains the other properties stated in the lemma.</div>
</div>
<div class="proof-box collapsed" data-proof-id="proof-num-5">
  <div class="proof-header">
    <button class="proof-toggle" onclick="toggleProof('proof-num-5')" aria-expanded="false">
      <span class="proof-toggle-icon">‚ñº</span>
      <strong>Proof</strong>
    </button>
  </div>
  <div class="proof-content" id="proof-num-5">
    The only place in the proof of Lemma <span class="ref-unknown" title="Reference not found: lem:infinite_5r_covering_lemma">[lem:infinite_5r_covering_lemma?]</span> where we used the separability of $(X,d)$ was to conclude that the disjoint collection $\mathcal{C}$ is countable.
    If we drop the separability assumption, then $\mathcal{C}$ may be uncountable, but the rest of the proof remains unchanged.
    We still have that $\mathcal{C}$ is a disjoint collection of balls in $\mathcal{F}$ such that
    \[ \bigcup_{B \in \mathcal{F}} B \subseteq \bigcup_{B \in \mathcal{C}} 5 B. \]
    <span class="proof-end">‚ñ°</span>
  </div>
</div>
<div class="theorem-box lemma-box" id="lem:vitali_covering_lemma_variant">
  <div class="theorem-header"><strong>Lemma ?</strong> (Vitali Covering Lemma Technical Variant)</div>
  <div class="theorem-content">Let $(X,d)$ be a separable metric space and let $A\subset X$. 
    Let $\mathcal{F}$ be a collection of closed balls in $X$ which covers $A$ and has uniformly bounded radii, i.e.,
    \[ R := \sup \{ \text{radius}(B) : B \in \mathcal{F} \} < \infty. \]
    Also assume that for each point $x \in A$ and each $\delta > 0$, there exists a ball $B \in \mathcal{F}$ such that $x \in B$ and $\text{radius}(B) < \delta$.
    Then there exists a countable disjoint subcollection $\mathcal{C} \subseteq \mathcal{F}$ such that for each finite collection of balls $\{ B_j \}_{j=1}^N \subseteq \mathcal{F}$, we have
    \[ A \setminus \bigcup_{j=1}^N B_j \subseteq \bigcup_{B \in \mathcal{C}\setminus \{B_1, \ldots, B_N\}} 5B. \]</div>
</div>
<div class="proof-box collapsed" data-proof-id="proof-num-6">
  <div class="proof-header">
    <button class="proof-toggle" onclick="toggleProof('proof-num-6')" aria-expanded="false">
      <span class="proof-toggle-icon">‚ñº</span>
      <strong>Proof</strong>
    </button>
  </div>
  <div class="proof-content" id="proof-num-6">
    Let $\mathcal{C}$ be the countable disjoint subcollection of balls constructed in the proof of Lemma <span class="ref-unknown" title="Reference not found: lem:infinite_5r_covering_lemma">[lem:infinite_5r_covering_lemma?]</span>.
    Let $\{ B_j \}_{j=1}^N \subseteq \mathcal{F}$ be an arbitrary finite collection of balls.
<p>If $A \subset \bigcup_{j=1}^N B_j$, then the desired inclusion is trivial as the set on the left side is empty.
    Thus we suppose $A$ is not contained in $\bigcup_{j=1}^N B_j$, and let $x \in A \setminus \bigcup_{j=1}^N B_j$ be arbitrary.
    By assumption that there exist balls in $\mathcal{F}$ of arbitrarily small radius covering each point in $A$, there exists a ball $B \in \mathcal{F}$ such that $x \in B$ and the radius of $B$ is less than the distance from $x$ to the set $\bigcup_{j=1}^N B_j$.
    In particular, this implies that $B$ does not intersect any of the balls $B_1, B_2, \ldots, B_N$, as all these balls are closed.
    But from the proof of Lemma <span class="ref-unknown" title="Reference not found: lem:infinite_5r_covering_lemma">[lem:infinite_5r_covering_lemma?]</span>, we know that there exists some ball $\hat{B} \in \mathcal{C}$ which intersects $B$ and hence $B \subseteq 5 \hat{B}$.
    That is, we have found some ball $\hat{B} \in \mathcal{C}$ such that $x \in B \subseteq 5 \hat{B}$ and $\hat{B} \notin \{ B_1, B_2, \ldots, B_N \}$.
    Since $x \in A \setminus \bigcup_{j=1}^N B_j$ was arbitrary, this completes the proof.
    <span class="proof-end">‚ñ°</span>
  </div>
</div></p>
<div class="theorem-box lemma-box" id="lem:filling_open_sets_with_balls">
  <div class="theorem-header"><strong>Lemma ?</strong> (Filling Open Sets with Balls)</div>
  <div class="theorem-content">Let $\delta > 0$.
    For each open set $U \subset \R^n$, there exists a disjoint collection of closed balls $\{ B_j \}_{j=1}^\infty$ such that
    $\bigcup_{j=1}^\infty B_j \subseteq U$ , $\diam(B_j) \leq \delta$ for each $j\geq 1$, and
    \[ \mathcal{L}^n\left( U \setminus \bigcup_{j=1}^\infty B_j \right) = 0. \]</div>
</div>
<p>In other words, for each $\delta > 0$ we can fill up an open set $U$ with disjoint balls of diameter at most $\delta$ so that the leftover set has Lebesgue measure zero.</p>
<div class="proof-box collapsed" data-proof-id="proof-num-7">
  <div class="proof-header">
    <button class="proof-toggle" onclick="toggleProof('proof-num-7')" aria-expanded="false">
      <span class="proof-toggle-icon">‚ñº</span>
      <strong>Proof</strong>
    </button>
  </div>
  <div class="proof-content" id="proof-num-7">
    Fix $\theta \in ( 1 - \frac{1}{5^n}, 1 )$. Assume first that $\mathcal{L}^n(U) < \infty$.
<p><em>Step 1:</em> We claim there exists a finite collection of disjoint balls $\{ B_j \}_{j=1}^{N_1}$ such that $\diam(B_j) \leq \delta$ for each $j = 1,2,\ldots,N_1$ and
    \[ \mathcal{L}^n\left( U \setminus \bigcup_{j=1}^{N_1} B_j \right) \leq \ \theta \mathcal{L}^n(U). \tag{$\diamondsuit$}\]</p>
<p>To see this, let $\mathcal{F} := \{ B \subseteq U : B\text{ is a closed ball with } \diam B < \delta \}$. 
    Then $\mathcal{F}$ is a collection of closed balls which covers $U$ and has uniformly bounded radii, so by Lemma <span class="ref-unknown" title="Reference not found: lem:infinite_5r_covering_lemma">[lem:infinite_5r_covering_lemma?]</span>, there exists a countable disjoint subcollection $\{ B_j \}_{j=1}^\infty \subseteq \mathcal{F}$ such that
    \[ U \subseteq \bigcup_{j=1}^\infty 5 B_j. \]
    Thus we have 
    \begin{align*}
        \mathcal{L}^n(U) &\leq \mathcal{L}^n\left( \bigcup_{j=1}^\infty 5 B_j \right) \leq \sum_{j=1}^\infty \mathcal{L}^n(5 B_j) \\
            &= \sum_{j=1}^\infty 5^n \mathcal{L}^n(B_j) \\
            &= 5^n \sum_{j=1}^\infty \mathcal{L}^n(B_j) \\
            &= 5^n \mathcal{L}^n\left( \bigcup_{j=1}^\infty B_j \right)
    \end{align*}
    since the balls $\{ B_j \}_{j=1}^\infty$ are disjoint.
    Rearranging gives
    \[ \frac{1}{5^n} \mathcal{L}^n(U) \leq \mathcal{L}^n\left( \bigcup_{j=1}^\infty B_j \right) \] 
    which implies that 
    \[ \mathcal{L}^n\left( U \setminus \bigcup_{j=1}^\infty B_j \right) \leq \left( 1 - \frac{1}{5^n} \right) \mathcal{L}^n(U) \] 
    Since $\theta > 1 - \frac{1}{5^n}$, we can choose $N_1$ sufficiently large so that the finite collection of disjoint balls $\{ B_j \}_{j=1}^{N_1}$ satisfies ($\diamondsuit$).
    This proves the claim in Step 1.</p>
<p><div style="margin: 1em 0;"></div>
    <em>Step 2:</em> Now let 
    \[ U_1 := U \setminus \bigcup_{j=1}^{N_1} B_j \] 
    and \[ \mathcal{F}_1 := \{ B \subseteq U_1 : B\text{ is a closed ball with } \diam B < \delta \}. \]
    As in Step 1, there exists finitely many disjoint balls $\{ B_j \}_{j=N_1+1}^{N_2} \subseteq \mathcal{F}_1$ such that $\diam(B_j) \leq \delta$ for each $j = N_1+1, N_1+2, \ldots, N_2$ and
    \[ \mathcal{L}^n\left( U_1 \setminus \bigcup_{j=N_1+1}^{N_2} B_j \right) \leq \theta \mathcal{L}^n(U_1). \]
    Thus we obtain
    \begin{align*}
        \mathcal{L}^n \left( U \setminus \bigcup_{j=1}^{N_2} B_j \right) &= \mathcal{L}^n\left( U_1 \setminus \bigcup_{j=N_1+1}^{N_2} B_j \right) \\
            &\leq \theta \mathcal{L}^n(U_1) \\
            &= \theta \mathcal{L}^n\left( U \setminus \bigcup_{j=1}^{N_1} B_j \right) \\
            &\leq \theta^2 \mathcal{L}^n(U).
    \end{align*}</p>
<p>By iterating this process, we obtain for each integer $m \geq 1$ a finite collection of disjoint balls $\{ B_j \}_{j=N_{m-1}+1}^{N_m}$ such that $\diam(B_j) \leq \delta$ for each $j = N_{m-1}+1, N_{m-1}+2, \ldots, N_m$ and
    \[ \mathcal{L}^n \left( U \setminus \bigcup_{j=1}^{N_m} B_j \right) \leq \theta^m \mathcal{L}^n(U). \]
    Since $\theta \in ( 1 - \frac{1}{5^n}, 1 )$, we have $\theta^m \to 0$ as $m \to \infty$, which implies that
    \[ \mathcal{L}^n\left( U \setminus \bigcup_{j=1}^\infty B_j \right) = 0. \]
    This completes the proof when $\mathcal{L}^n(U) < \infty$.</p>
<p><div style="margin: 1em 0;"></div>
    <em>Step 3:</em> Finally, if $\mathcal{L}^n(U) = \infty$, we can write $U$ as a countable union of bounded open sets 
    \[ U = \bigcup_{j=1}^\infty ( U \cap \{ x \in \R^n : (j-1) \leq |x| < j \} ). \]
    Applying the previous case to each bounded open set $U \cap \{ x \in \R^n : (j-1) \leq |x| < j \}$ for $j = 1,2,\ldots$ and taking the union of all the resulting collections of balls gives the desired result.
    <span class="proof-end">‚ñ°</span>
  </div>
</div></p>
<p>This ends the section on Vitali Covering Lemmas.
We will use these in the next section to investigate the Hardy-Littlewood Maximal Function, and later on to study Hausdorff measure.</p>
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      console.log('Restoring proof collapse states...');
      try {
        const openProofs = JSON.parse(localStorage.getItem('openProofs') || '{}');
        const currentPage = window.location.pathname;
        const pageOpen = openProofs[currentPage] || [];
        
        console.log('Current page:', currentPage);
        console.log('Open proof IDs stored:', pageOpen);
        console.log('Found ' + pageOpen.length + ' open proofs for this page');
        
        document.querySelectorAll('.proof-box').forEach(box => {
          const proofId = box.getAttribute('data-proof-id');
          console.log('Checking proof:', proofId, 'Should be open:', pageOpen.includes(proofId));
          if (pageOpen.includes(proofId)) {
            // This proof should be open
            box.classList.remove('collapsed');
            const button = box.querySelector('.proof-toggle');
            button.setAttribute('aria-expanded', 'true');
          } else {
            // This proof should be collapsed (default)
            box.classList.add('collapsed');
            const button = box.querySelector('.proof-toggle');
            button.setAttribute('aria-expanded', 'false');
          }
        });
        
        const openBoxes = JSON.parse(localStorage.getItem('openBoxes') || '{}');
        const pageBoxes = openBoxes[currentPage] || [];
        
        console.log('Open box IDs stored:', pageBoxes);
        
        document.querySelectorAll('.collapsible-box').forEach(box => {
          const boxId = box.getAttribute('data-collapsible-id');
          console.log('Checking box:', boxId, 'Should be open:', pageBoxes.includes(boxId));
          if (pageBoxes.includes(boxId)) {
            box.classList.remove('collapsed');
          } else {
            box.classList.add('collapsed');
          }
        });
        
        console.log('Proof states restored');
      } catch (e) {
        console.error('Error restoring collapse state:', e);
      }
    });
    
    function toggleProof(proofId) {
      const proofContent = document.getElementById(proofId);
      const proofBox = proofContent.closest('.proof-box');
      proofBox.classList.toggle('collapsed');
      
      const button = proofBox.querySelector('.proof-toggle');
      button.setAttribute('aria-expanded', !proofBox.classList.contains('collapsed'));
      
      saveProofState();
    }
    
    function toggleSubproof(subproofId) {
      const subproofContent = document.getElementById(subproofId);
      const subproof = subproofContent.closest('.subproof');
      subproof.classList.toggle('collapsed');
      
      const button = subproof.querySelector('.subproof-toggle');
      button.setAttribute('aria-expanded', !subproof.classList.contains('collapsed'));
    }
    
    function saveProofState() {
      try {
        const currentPage = window.location.pathname;
        const openProofs = JSON.parse(localStorage.getItem('openProofs') || '{}');
        if (!openProofs[currentPage]) {
          openProofs[currentPage] = [];
        }
        
        // Get all OPEN (not collapsed) proofs
        openProofs[currentPage] = [];
        document.querySelectorAll('.proof-box:not(.collapsed)').forEach(box => {
          const proofId = box.getAttribute('data-proof-id');
          if (proofId) {
            openProofs[currentPage].push(proofId);
          }
        });
        
        localStorage.setItem('openProofs', JSON.stringify(openProofs));
        console.log('Saved proof state (open proofs):', openProofs[currentPage]);
      } catch (e) {
        console.error('Error saving collapse state:', e);
      }
    }
    
    function toggleCollapsible(collapsibleId) {
      const content = document.getElementById(collapsibleId);
      const box = content.closest('.collapsible-box');
      box.classList.toggle('collapsed');
      
      saveCollapsibleState();
    }
    
    function saveCollapsibleState() {
      try {
        const currentPage = window.location.pathname;
        const openBoxes = JSON.parse(localStorage.getItem('openBoxes') || '{}');
        if (!openBoxes[currentPage]) {
          openBoxes[currentPage] = [];
        }
        
        // Get all OPEN (not collapsed) boxes
        openBoxes[currentPage] = [];
        document.querySelectorAll('.collapsible-box:not(.collapsed)').forEach(box => {
          const boxId = box.getAttribute('data-collapsible-id');
          if (boxId) {
            openBoxes[currentPage].push(boxId);
          }
        });
        
        localStorage.setItem('openBoxes', JSON.stringify(openBoxes));
      } catch (e) {
        console.error('Error saving box state:', e);
      }
    }
    
    document.addEventListener('keydown', (e) => {
      if (e.key === 'p' && e.ctrlKey) {
        e.preventDefault();
        const proofBoxes = document.querySelectorAll('.proof-box');
        const anyExpanded = Array.from(proofBoxes).some(box => !box.classList.contains('collapsed'));
        
        proofBoxes.forEach(box => {
          if (anyExpanded) {
            box.classList.add('collapsed');
          } else {
            box.classList.remove('collapsed');
          }
        });
        
        saveProofState();
      }
    });
    
    document.querySelectorAll('a.ref-link').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const targetId = link.getAttribute('href').substring(1);
        const target = document.getElementById(targetId);
        if (target) {
          target.scrollIntoView({ behavior: 'smooth', block: 'center' });
          target.style.background = '#fef3c7';
          target.style.transition = 'background 0.3s ease';
          setTimeout(() => { target.style.background = ''; }, 1500);
        }
      });
    });
  </script>
</body>
</html>