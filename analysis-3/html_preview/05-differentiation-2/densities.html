<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>densities</title>
  <script>
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$', '$$'], ['\\[', '\\]']],
      processEscapes: true,
      processEnvironments: true,
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '0.8em',
      packages: {'[+]': ['ams']},
      macros: {
        R: '\\mathbb{R}',
        C: '\\mathbb{C}',
        N: '\\mathbb{N}',
        Z: '\\mathbb{Z}',
        Q: '\\mathbb{Q}',
        E: '\\mathbb{E}',
        F: '\\mathbb{F}',
        S: '\\mathbb{S}',
        H: '\\mathcal{H}',
        L: '\\mathcal{L}',
        dif: '\\,\\mathrm{d}',
        supp: '\\operatorname{supp}',
        proj: '\\operatorname{proj}',
        Id: '\\operatorname{Id}',
        Span: '\\operatorname{span}',
        graph: '\\operatorname{graph}',
        dist: '\\operatorname{dist}',
        diam: '\\operatorname{diam}',
        avg: '\\operatorname{avg}',
        div: '\\operatorname{div}',
        vol: '\\operatorname{vol}',
        ord: '\\operatorname{ord}',
        Chi: '\\mathbf{1}',
        sub: '\\subseteq',
        mres: '\\downharpoonright',
        ddag: '\\ddagger',
        dag: '\\dagger',
        norm: ['\\left\\| #1 \\right\\|', 1],
        abs: ['\\left| #1 \\right|', 1],
        set: ['\\left\\{ #1 \\right\\}', 1],
        inner: ['\\langle #1, #2 \\rangle', 2],
        floor: ['\\lfloor #1 \\rfloor', 1],
        ceil: ['\\lceil #1 \\rceil', 1],
        llbracket: '\\unicode{x27E6}',
        rrbracket: '\\unicode{x27E7}',
        bigskull: '\\unicode{x1F480}',
        skull: '\\unicode{x2620}',
        mathwitch: '\\unicode{x1F9D9}',
        pumpkin: '\\unicode{x1F383}',
        mathpumpkin: '\\unicode{x1F383}',
        bigpumpkin: '\\unicode{x1F383}',
        mathghost: '\\unicode{x1F47B}',
        mathcat: '\\unicode{x1F408}',
        mathbat: '\\unicode{x1F987}',
        esssup: '\\operatorname{ess\\,sup}',
        essinf: '\\operatorname{ess\\,inf}',
        Lip: '\\operatorname{Lip}',
        pd: ['\\frac{\\partial#1}{\\partial#2}', 2],
        od: ['\\frac{\\mathrm{d}#1}{\\mathrm{d}#2}', 2],
        dashint: '\\mathchoice{\\rlap{-}\\!\\int}{\\rlap{\\raise.15ex\\hbox{\\smash{\\scriptscriptstyle-}}}\\int}{\\rlap{\\raise.09ex\\hbox{\\smash{\\scriptscriptstyle-}}}\\int}{\\rlap{\\raise.09ex\\hbox{\\smash{\\scriptscriptstyle-}}}\\int}',
        eurologo: '\\unicode{x20AC}',
        starredbullet: '\\unicode{x2726}',
        grimace: '\\unicode{x1F62C}',
        textthing: '\\unicode{x2639}',
        noway: '\\unicode{x26D4}',
        warning: '\\unicode{x26A0}',
        danger: '\\unicode{x26A0}',
        textxswup: '\\unicode{x2195}',
        textxswdown: '\\unicode{x2195}',
        decoone: '\\unicode{x2756}',
        decotwo: '\\unicode{x2767}',
        decothreeleft: '\\unicode{x2619}',
        decothreeright: '\\unicode{x2767}',
        decofourleft: '\\unicode{x261A}',
        decofourright: '\\unicode{x261B}',
        floweroneleft: '\\unicode{x2740}',
        floweroneright: '\\unicode{x2740}',
        lefthand: '\\unicode{x261C}',
        righthand: '\\unicode{x261E}',
        decosix: '\\unicode{x2766}',
        bomb: '\\unicode{x1F4A3}',
        caution: '\\unicode{x2621}',
        leftblackhand: '\\unicode{x261A}',
        rightblackhand: '\\unicode{x261B}',
        leafleft: '\\unicode{x2618}',
        leafright: '\\unicode{x2618}',
        leafNW: '\\unicode{x2618}',
        leafNE: '\\unicode{x2618}',
        leafSE: '\\unicode{x2618}',
        leafSW: '\\unicode{x2618}',
        aldineleft: '\\unicode{x2619}',
        aldineright: '\\unicode{x2767}',
        aldine: '\\unicode{x2766}',
        aldinesmall: '\\unicode{x2767}',
        aldinesmallrevert: '\\unicode{x2619}',
        aldinesmallup: '\\unicode{x2766}',
        grappe: '\\unicode{x2766}',
        rightgrappe: '\\unicode{x2767}',
        leftgrappe: '\\unicode{x2619}',
        oldpilcrowone: '\\unicode{x00B6}',
        oldpilcrowtwo: '\\unicode{x00B6}',
        oldpilcrowthree: '\\unicode{x00B6}',
        oldpilcrowfour: '\\unicode{x00B6}',
        oldpilcrowfive: '\\unicode{x00B6}',
        oldpilcrowsix: '\\unicode{x00B6}'
      }
    },
    startup: {
      pageReady: () => {
        return MathJax.startup.defaultPageReady().then(() => {
          console.log('MathJax ready');
        });
      }
    }
  };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" id="MathJax-script"></script>
  <script>
  (function() {
    window.addEventListener('beforeunload', function() {
      saveProofState();
      saveCollapsibleState();
    });
    
    const eventSource = new EventSource('http://localhost:35729/reload-stream');
    
    eventSource.onmessage = function(event) {
      if (event.data === 'reload') {
        console.log('üìù File updated, saving state and reloading...');
        saveProofState();
        saveCollapsibleState();
        setTimeout(() => {
          window.location.reload();
        }, 50);
      }
    };
    
    eventSource.onerror = function() {
      console.log('‚ö†Ô∏è  Auto-reload server not available. Run node watch.js to enable auto-reload.');
      eventSource.close();
    };
    
    console.log('üîÑ Auto-reload enabled');
  })();
  </script>
  <style>
    * { box-sizing: border-box; }
    
    body {
      font-family: Georgia, "Times New Roman", serif;
      font-size: 16px;
      line-height: 1.7;
      margin: 0;
      padding: 0;
      color: #1a1a1a;
      background: #ffffff;
    }
    
    /* Layout with sidebar */
    .page-layout {
      display: flex;
      min-height: 100vh;
    }
    
    /* Sidebar styles */
    .sidebar {
      width: 280px;
      background: #fff;
      border-right: 1px solid #e0e0e0;
      position: fixed;
      top: 0;
      left: 0;
      height: 100vh;
      overflow-y: auto;
      padding: 20px 0;
      font-size: 14px;
    }
    
    .sidebar-header {
      padding: 15px 20px 25px;
      border-bottom: 1px solid #e0e0e0;
    }
    
    .sidebar-header h1 {
      font-size: 1.3em;
      font-weight: 600;
      color: #1a1a1a;
      margin: 0 0 5px 0;
    }
    
    .sidebar-header .subtitle {
      font-size: 0.85em;
      color: #666;
      font-style: italic;
    }
    
    .sidebar-header .back-link {
      display: block;
      font-size: 0.8em;
      color: #666;
      text-decoration: none;
      margin-top: 12px;
    }
    
    .sidebar-header .back-link:hover {
      color: #1a1a1a;
    }
    
    .sidebar-nav {
      padding: 10px 0;
    }
    
    .chapter-group {
      margin-bottom: 2px;
    }
    
    .chapter-title {
      padding: 12px 20px;
      font-size: 0.9em;
      font-weight: 600;
      color: #333;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .chapter-title:hover {
      background: #f5f5f5;
    }
    
    .chapter-title .toggle {
      font-size: 0.65em;
      color: #999;
      transition: transform 0.2s;
    }
    
    .chapter-group.expanded .chapter-title .toggle {
      transform: rotate(90deg);
    }
    
    .section-list {
      display: none;
      padding: 5px 0;
      background: #f8f8f8;
    }
    
    .chapter-group.expanded .section-list {
      display: block;
    }
    
    .section-link {
      display: block;
      padding: 8px 20px 8px 35px;
      font-size: 0.85em;
      color: #555;
      text-decoration: none;
      border-left: 3px solid transparent;
    }
    
    .section-link:hover {
      background: #f0f0f0;
      color: #1a1a1a;
    }
    
    .section-link.active {
      background: #e8e8e8;
      border-left-color: #333;
      color: #000;
      font-weight: 500;
    }
    
    /* Main content area */
    .main-content {
      margin-left: 280px;
      flex: 1;
      max-width: 900px;
      padding: 40px 60px;
    }
    
    @media (max-width: 1100px) {
      .sidebar {
        width: 240px;
      }
      .main-content {
        margin-left: 240px;
        padding: 30px 40px;
      }
    }
    
    @media (max-width: 800px) {
      .sidebar {
        position: relative;
        width: 100%;
        height: auto;
        border-right: none;
        border-bottom: 1px solid #e0e0e0;
      }
      .main-content {
        margin-left: 0;
        padding: 20px;
      }
      .page-layout {
        flex-direction: column;
      }
    }
    
    h2, h3, h4 {
      margin-top: 2em;
      margin-bottom: 0.75em;
      color: #000;
      font-weight: 600;
    }
    h2 { font-size: 1.5em; border-bottom: 1px solid #e0e0e0; padding-bottom: 0.3em; }
    h3 { font-size: 1.25em; }
    h4 { font-size: 1.1em; }
    p {
      margin: 1em 0;
      text-indent: 2em;
    }
    p:first-of-type,
    h2 + p,
    h3 + p,
    h4 + p,
    .theorem-box + p,
    .proof-box + p {
      text-indent: 0;
    }
    .noindent + p,
    p:has(> .noindent:first-child) {
      text-indent: 0 !important;
    }
    .noindent {
      display: none;
    }
    .theorem-box {
      margin: 1.75em 0;
      padding: 1.25em;
      border-left: 5px solid #16a34a;
      background: linear-gradient(to top, #bbf7d0 0%, #d1fae5 100%);
      border-radius: 6px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }
    .definition-box { border-left-color: #16a34a; background: linear-gradient(to top, #d1fae5 0%, #ecfdf5 100%); }
    .lemma-box { border-left-color: #1e3a8a; background: linear-gradient(to top, #bfdbfe 0%, #dbeafe 100%); }
    .corollary-box { border-left-color: #9333ea; background: linear-gradient(to top, #e9d5ff 0%, #f3e8ff 100%); }
    .proposition-box { border-left-color: #dc2626; background: linear-gradient(to top, #fecaca 0%, #fee2e2 100%); }
    .remark-box { border-left-color: #64748b; background: linear-gradient(to top, #e2e8f0 0%, #f1f5f9 100%); }
    .example-box { border-left-color: #0891b2; background: linear-gradient(to top, #a5f3fc 0%, #cffafe 100%); }
    .construction-box { border-left-color: #ea580c; background: linear-gradient(to top, #fed7aa 0%, #ffedd5 100%); }
    .notation-box { border-left-color: #ca8a04; background: linear-gradient(to top, #fef08a 0%, #fef9c3 100%); }
    .exercise-box { border-left-color: #ea580c; background: linear-gradient(to top, #fed7aa 0%, #ffedd5 100%); }
    .problem-box { border-left-color: #ec4899; background: linear-gradient(to top, #fbcfe8 0%, #fce7f3 100%); }
    .theorem-header {
      margin-bottom: 0.75em;
      font-size: 1.05em;
      font-weight: 600;
    }
    .theorem-header.clickable {
      cursor: pointer;
      user-select: none;
    }
    .theorem-header.clickable:hover {
      background: rgba(0,0,0,0.03);
      margin: -0.5em -0.75em 0.75em -0.75em;
      padding: 0.5em 0.75em;
      border-radius: 4px;
    }
    .collapsible-icon {
      display: inline-block;
      transition: transform 0.2s ease;
      font-size: 0.75em;
      margin-right: 0.5em;
      color: #6b7280;
    }
    .collapsible-box.collapsed .collapsible-icon {
      transform: rotate(-90deg);
    }
    .collapsible-content {
      transition: max-height 0.3s ease;
      overflow: hidden;
    }
    .collapsible-box.collapsed .collapsible-content {
      display: none;
    }
    .theorem-content {
      padding-left: 0.5em;
      line-height: 1.8;
    }
    .proof-box {
      margin: 1.5em 0;
      border: 1px solid #e5e7eb;
      border-radius: 6px;
      background: white;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }
    .proof-header {
      position: sticky;
      top: 0;
      background: linear-gradient(to bottom, #fafafa 0%, #f5f5f5 100%);
      border-bottom: 1px solid #e5e7eb;
      z-index: 100;
      border-radius: 6px 6px 0 0;
    }
    .proof-toggle {
      width: 100%;
      padding: 0.85em 1.25em;
      border: none;
      background: transparent;
      text-align: left;
      cursor: pointer;
      font-family: inherit;
      font-size: 1em;
      display: flex;
      align-items: center;
      gap: 0.75em;
      transition: background 0.15s;
    }
    .proof-toggle:hover { background: rgba(0,0,0,0.03); }
    .proof-toggle-icon {
      display: inline-block;
      transition: transform 0.2s ease;
      font-size: 0.75em;
      color: #6b7280;
    }
    .proof-box.collapsed .proof-toggle-icon {
      transform: rotate(-90deg);
    }
    .proof-content {
      padding: 1.25em;
      line-height: 1.8;
    }
    .proof-box.collapsed .proof-content {
      display: none;
    }
    .proof-end {
      float: right;
      font-size: 1.3em;
      margin-left: 0.5em;
      color: #374151;
    }
    .subproof {
      margin: 1em 0;
      border: 1px solid #d1d5db;
      border-radius: 4px;
      background: #f9fafb;
    }
    .subproof-header {
      background: linear-gradient(to bottom, #f9fafb 0%, #f3f4f6 100%);
      border-bottom: 1px solid #d1d5db;
      border-radius: 4px 4px 0 0;
    }
    .subproof-toggle {
      width: 100%;
      padding: 0.6em 1em;
      border: none;
      background: transparent;
      text-align: left;
      cursor: pointer;
      font-family: inherit;
      font-size: 0.95em;
      display: flex;
      align-items: center;
      gap: 0.5em;
      transition: background 0.15s;
    }
    .subproof-toggle:hover {
      background: rgba(0,0,0,0.03);
    }
    .subproof-toggle-icon {
      display: inline-block;
      transition: transform 0.2s ease;
      font-size: 0.7em;
      color: #6b7280;
    }
    .subproof.collapsed .subproof-toggle-icon {
      transform: rotate(-90deg);
    }
    .subproof-content {
      padding: 1em;
      line-height: 1.7;
    }
    .subproof.collapsed .subproof-content {
      display: none;
    }
    .ref-link {
      color: #2563eb;
      text-decoration: none;
      font-weight: 500;
      padding: 0 0.15em;
      border-radius: 2px;
    }
    .ref-link:hover {
      background: #dbeafe;
      text-decoration: underline;
    }
    .ref-unknown {
      color: #dc2626;
      font-weight: bold;
      background: #fee2e2;
      padding: 0.1em 0.3em;
      border-radius: 3px;
    }
    strong { font-weight: 600; }
    em { font-style: italic; }
    ol, ul {
      margin: 1em 0;
      padding-left: 2.5em;
      line-height: 1.8;
    }
    li {
      margin: 0.5em 0;
    }
    .latex-image {
      max-width: 100%;
      height: auto;
      display: block;
      margin: 1.5em auto;
    }
    .latex-figure .latex-image {
      display: inline-block;
      margin: 0.5em;
      vertical-align: middle;
    }
    .latex-figure {
      margin: 2em 0;
      text-align: center;
      line-height: 0;
    }
    .latex-figure .figure-content {
      margin-bottom: 0.75em;
      line-height: normal;
    }
    .latex-figure .figure-content > * {
      vertical-align: middle;
    }
    .latex-figure figcaption {
      font-size: 0.9em;
      color: #4b5563;
      font-style: italic;
      margin-top: 0.5em;
    }
  </style>
</head>
<body>
  <div class="page-layout">
    <nav class="sidebar">
      <div class="sidebar-header">
        <h1>Analysis III</h1>
        <div class="subtitle">Measure Theory &amp; Integration</div>
        <a href="../index.html" class="back-link">‚Üê Table of Contents</a>
      </div>
      <div class="sidebar-nav">
        <div class="chapter-group expanded">
          <div class="chapter-title" onclick="toggleChapter(this)"><span>1. Measure Theory</span><span class="toggle">‚ñ∂</span></div>
          <div class="section-list">
            <a href="../01-measure-theory/measure-theory.html" class="section-link">Overview</a>
            <a href="../01-measure-theory/basics.html" class="section-link">Outer Measures</a>
            <a href="../01-measure-theory/lebesgue-meas.html" class="section-link">Lebesgue Measure</a>
            <a href="../01-measure-theory/cantor.html" class="section-link">The Cantor Set</a>
            <a href="../01-measure-theory/measure-spaces.html" class="section-link">Measure Spaces</a>
          </div>
        </div>
        <div class="chapter-group">
          <div class="chapter-title" onclick="toggleChapter(this)"><span>2. Integration</span><span class="toggle">‚ñ∂</span></div>
          <div class="section-list">
            <a href="../02-integration/integration.html" class="section-link">Overview</a>
            <a href="../02-integration/integrals-1.html" class="section-link">Simple Functions</a>
            <a href="../02-integration/integrals-2.html" class="section-link">General Functions</a>
            <a href="../02-integration/convergence.html" class="section-link">Convergence Theorems</a>
            <a href="../02-integration/inequality-party.html" class="section-link">Integral Inequalities</a>
            <a href="../02-integration/lp_spaces.html" class="section-link">L·µñ Spaces</a>
          </div>
        </div>
        <div class="chapter-group">
          <div class="chapter-title" onclick="toggleChapter(this)"><span>3. Product Measures</span><span class="toggle">‚ñ∂</span></div>
          <div class="section-list">
            <a href="../03-fubini/fubini_ch.html" class="section-link">Overview</a>
            <a href="../03-fubini/fubini.html" class="section-link">Fubini-Tonelli</a>
            <a href="../03-fubini/integrals-3.html" class="section-link">Product Measures</a>
          </div>
        </div>
        <div class="chapter-group">
          <div class="chapter-title" onclick="toggleChapter(this)"><span>4. Differentiation I</span><span class="toggle">‚ñ∂</span></div>
          <div class="section-list">
            <a href="../04-differentiation-1/differentiation.html" class="section-link">Overview</a>
            <a href="../04-differentiation-1/covering.html" class="section-link">Vitali Covering</a>
            <a href="../04-differentiation-1/monotone.html" class="section-link">Monotone Functions</a>
            <a href="../04-differentiation-1/BV_on_R.html" class="section-link">Bounded Variation</a>
            <a href="../04-differentiation-1/FTOC.html" class="section-link">FTC for Lebesgue</a>
            <a href="../04-differentiation-1/HL.html" class="section-link">Hardy-Littlewood</a>
          </div>
        </div>
        <div class="chapter-group">
          <div class="chapter-title" onclick="toggleChapter(this)"><span>5. Differentiation I (cont)</span><span class="toggle">‚ñ∂</span></div>
          <div class="section-list">
            <a href="../05-differentiation-1/differentiation.html" class="section-link">Overview</a>
            <a href="../05-differentiation-1/r-nik.html" class="section-link">Radon-Nikodym</a>
          </div>
        </div>
        <div class="chapter-group">
          <div class="chapter-title" onclick="toggleChapter(this)"><span>6. Differentiation II</span><span class="toggle">‚ñ∂</span></div>
          <div class="section-list">
            <a href="../06-differentiation-2/diff-2.html" class="section-link">Overview</a>
            <a href="../06-differentiation-2/vector-measures.html" class="section-link">Vector Measures</a>
            <a href="../06-differentiation-2/r-nik.html" class="section-link">Radon-Nikodym</a>
            <a href="../06-differentiation-2/besi.html" class="section-link">Besicovitch</a>
            <a href="../06-differentiation-2/densities.html" class="section-link">Densities</a>
            <a href="../06-differentiation-2/diff-measures.html" class="section-link">Measure Derivatives</a>
          </div>
        </div>
        <div class="chapter-group">
          <div class="chapter-title" onclick="toggleChapter(this)"><span>7. Riesz Representation</span><span class="toggle">‚ñ∂</span></div>
          <div class="section-list">
            <a href="../06-riesz/riesz.html" class="section-link">Overview</a>
            <a href="../06-riesz/riesz_functional.html" class="section-link">Riesz Representation</a>
            <a href="../06-riesz/LCH_spaces.html" class="section-link">LCH Spaces</a>
          </div>
        </div>
        <div class="chapter-group">
          <div class="chapter-title" onclick="toggleChapter(this)"><span>8. Integral Formulas</span><span class="toggle">‚ñ∂</span></div>
          <div class="section-list">
            <a href="../07-formulas/formulas.html" class="section-link">Overview</a>
            <a href="../07-formulas/hausdorff_meas.html" class="section-link">Hausdorff Measures</a>
            <a href="../07-formulas/lippy.html" class="section-link">Lipschitz Maps</a>
            <a href="../07-formulas/rademacher.html" class="section-link">Rademacher</a>
            <a href="../07-formulas/coarea-prereq.html" class="section-link">Coarea Prerequisites</a>
            <a href="../07-formulas/coarea.html" class="section-link">Coarea Formula</a>
            <a href="../07-formulas/area-prereq.html" class="section-link">Area Prerequisites</a>
            <a href="../07-formulas/area-formula.html" class="section-link">Area Formula</a>
          </div>
        </div>
        <div class="chapter-group">
          <div class="chapter-title" onclick="toggleChapter(this)"><span>9. Extension Results</span><span class="toggle">‚ñ∂</span></div>
          <div class="section-list">
            <a href="../08-ext-res/ext-res.html" class="section-link">Overview</a>
            <a href="../08-ext-res/taylor_thm_integral_remainder.html" class="section-link">Taylor's Theorem</a>
            <a href="../08-ext-res/whitney-cover.html" class="section-link">Whitney Covering</a>
            <a href="../08-ext-res/whitney-partition-of-unity.html" class="section-link">Partition of Unity</a>
            <a href="../08-ext-res/whitney-decomposition.html" class="section-link">Decomposition</a>
            <a href="../08-ext-res/whitney-extension-theorem.html" class="section-link">Extension Theorem</a>
            <a href="../08-ext-res/whitney-extension-proof.html" class="section-link">Extension Proof</a>
            <a href="../08-ext-res/whitney-extension-applications.html" class="section-link">Applications</a>
            <a href="../08-ext-res/whitney-extension.html" class="section-link">Summary</a>
            <a href="../08-ext-res/more-bump.html" class="section-link">More Bump Functions</a>
          </div>
        </div>
      </div>
    </nav>
    
    <main class="main-content">
      <h2>Densities</h2>
<p>Now that we are armed with the powerful Besicovich Covering Theorem, we can show that the Radon-Nikodym derivative can be expressed as a limit of ratios of measures in many cases of interest.
For this, we will need to define the notion of <em>density</em> of a measure at a point.</p>
<p><div style="margin: 1em 0;"></div>
In this entire section, $(X,d)$ will be a metric space.</p>
<h3>Definitions and the Upper Density Theorem</h3>
<div class="theorem-box definition-box" id="def:n_dim_upper_lower_density">
  <div class="theorem-header"><strong>Definition ?</strong> ($n$-Dimensional Upper and Lower Densities)</div>
  <div class="theorem-content">Let $\mu$ be an outer measure on $X$, and let $n \in \Z^+$.
    For a subset $A \subseteq X$ and a point $x \in X$, the <em>$n$-dimensional upper density</em> of $\mu$ at $x$ with respect to $A$ is defined as
    \[ \Theta^{*n}(\mu,A,x) := \limsup_{r \to 0} \frac{\mu\big( A \cap \overline{B}(x,r) \big)}{\omega_n r^n}, \]
    and the <em>$n$-dimensional lower density</em> of $\mu$ at $x$ with respect to $A$ is defined as
    \[ \Theta_*^n(\mu,A,x) := \liminf_{r \to 0} \frac{\mu\big( A \cap \overline{B}(x,r) \big)}{\omega_n r^n}, \]
    where $\omega_n$ is the volume of the unit ball in $\R^n$.
<p><div style="margin: 1em 0;"></div>
    In the case $A=X$, we simply write $\Theta^{*n}(\mu,x)$ and $\Theta_*^n(\mu,x)$ for the upper and lower densities, respectively.</p>
<p><div style="margin: 1em 0;"></div>
    If the upper and lower densities at a point $x\in X$ are equal, we call the common value the <em>$n$-dimensional density</em> of $\mu$ at $x$ with respect to $A$, denoted
    \[ \Theta^n(\mu,A,x) := \lim_{r \to 0} \frac{\mu\big( A \cap \overline{B}(x,r) \big)}{\omega_n r^n}. \]</div>
</div></p>
<div class="theorem-box exercise-box" id="ex:density_measurable">
  <div class="theorem-header"><strong>Exercise ?</strong> (Measurability of Densities)</div>
  <div class="theorem-content">Let $\mu$ be a Borel outer measure on $X$ such that $\mu(B) < \infty$ for each closed ball $B \subseteq X$.
    Then for each $r > 0$ and each $x \in X$, we have
    \[ \mu(A \cap \overline{B}(x,r)) \geq \limsup_{y\to x} \mu( A \cap \overline{B}(y,r) ). \]
    That is, for each $r>0$ the function
    \[ X\ni x\longmapsto \frac{\mu(A \cap \overline{B}(x,r))}{\omega_n r^n} \in [0,\infty] \]
    is upper semicontinuous.
<p>Conclude that the lower $n$-dimensional density $\Theta^{n}_*(\mu,A,\cdot) : X \to [0,\infty]$ is a Borel measurable function.</p>
<p><div style="margin: 1em 0;"></div>
    Also the upper $n$-dimensional density $\Theta^{*n}(\mu,A,\cdot) : X \to [0,\infty]$ is a Borel measurable function.</div>
</div></p>
<div class="proof-box collapsed" data-proof-id="proof-num-0">
  <div class="proof-header">
    <button class="proof-toggle" onclick="toggleProof('proof-num-0')" aria-expanded="false">
      <span class="proof-toggle-icon">‚ñº</span>
      <strong>Proof</strong>
    </button>
  </div>
  <div class="proof-content" id="proof-num-0">
    Fix $r > 0$ and let $x \in X$.
    Let $\{ y_k \}_{k=1}^\infty \subseteq X$ be a sequence such that $y_k \to x$ as $k \to \infty$.
    Then for each $\epsilon > 0$, there exists $N \in \Z^+$ such that 
    \[ \overline{B}(y_k,r) \subseteq \overline{B}(x,r+\epsilon) \quad \forall k \geq N \]
    and hence
    \[ \mu( A \cap \overline{B}(y_k,r) ) \leq \mu( A \cap \overline{B}(x,r+\epsilon) ) \]
    by monotonicity of $\mu$.
    Taking the limit superior as $k \to \infty$ gives
    \[ \limsup_{k\to\infty} \mu( A \cap \overline{B}(y_k,r) ) \leq \mu( A \cap \overline{B}(x,r+\epsilon) ). \]
    Since this holds for each $\epsilon > 0$, we get
    \[ \limsup_{r \to 0} \frac{\mu( A \cap \overline{B}(x,r) )}{\omega_n r^n} \leq \mu( A \cap \overline{B}(x,r) ) \]
    by <span class="ref-unknown" title="Reference not found: prop:sequences_of_measurable_sets">[prop:sequences_of_measurable_sets?]</span>.
    Since $\{ y_k \}_{k=1}^\infty$ was an arbitrary sequence which converged to $x$, we have shown that
    \[ \mu(A \cap \overline{B}(x,r)) \geq \limsup_{y\to x} \mu( A \cap \overline{B}(y,r) ). \]
    Since $x\in X$ was arbitrary and $r > 0$ is fixed, this shows that the function
    \[ X\ni x\longmapsto \frac{\mu(A \cap \overline{B}(x,r))}{\omega_n r^n} \in [0,\infty] \]
    is upper semicontinuous.
<p>Thus for each $m \in \Z^+$, the function
    \[ X\ni x \longmapsto \inf_{0 < r < \frac{1}{m}} \frac{\mu(A \cap \overline{B}(x,r))}{\omega_n r^n} \]
    is also upper semicontinuous, and hence Borel measurable.
    As a result, the lower $n$-dimensional density
    \[ \Theta^{n}_*(\mu,A,x) = \lim_{m \to \infty} \inf_{0 < r < \frac{1}{m}} \frac{\mu(A \cap \overline{B}(x,r))}{\omega_n r^n} \]
    is a Borel measurable function on $X$.</p>
<p><div style="margin: 1em 0;"></div></p>
<p>We claim that for each $r > 0$ the map 
    \[ X\ni x \longmapsto \frac{\mu(A \cap B(x,r))}{\omega_n r^n} \in [0,\infty] \]
    is lower semicontinuous.</p>
<p>To see this, let $x \in X$ and let $\{ y_k \}_{k=1}^\infty \subseteq X$ be a sequence such that $y_k \to x$ as $k \to \infty$.
    Then for each $\epsilon > 0$, there exists $N \in \Z^+$ such that
    \[ B(x,r-\epsilon) \subseteq B(y_k,r) \quad \forall k \geq N \]
    and hence
    \[ \mu(A \cap B(y_k,r)) \geq \mu(A \cap B(x,r-\epsilon)) \]
    by monotonicity of $\mu$. Taking the limit infimum as $k \to \infty$ gives
    \[ \liminf_{k\to\infty} \mu( A \cap B(y_k,r) ) \geq \mu( A \cap B(x,r-\epsilon) ). \]
    Since this holds for each $\epsilon > 0$, we get
    \[ \liminf_{r \to 0} \frac{\mu( A \cap B(x,r) )}{\omega_n r^n} \geq \mu( A \cap B(x,r) ) \]
    by <span class="ref-unknown" title="Reference not found: prop:sequences_of_measurable_sets">[prop:sequences_of_measurable_sets?]</span>.
    Since $\{ y_k \}_{k=1}^\infty$ was an arbitrary sequence which converged to $x$, we have shown that
    \[ \mu(A \cap B(x,r)) \leq \liminf_{y\to x} \mu( A \cap B(y,r) ). \]
    Since $x\in X$ was arbitrary and $r > 0$ is fixed, this shows that the function
    \[ X\ni x\longmapsto \frac{\mu(A \cap B(x,r))}{\omega_n r^n} \in [0,\infty] \]
    is lower semicontinuous.</p>
<p>As a result, for each $m \in \Z^+$, the function
    \[ X\ni x \longmapsto \sup_{0 < r < \frac{1}{m}} \frac{\mu(A \cap B(x,r))}{\omega_n r^n} \]
    is also lower semicontinuous, and hence Borel measurable.
    Thus the upper $n$-dimensional density
    \[ \Theta^{*n}(\mu,A,x) = \lim_{m \to \infty} \sup_{0 < r < \frac{1}{m}} \frac{\mu(A \cap B(x,r))}{\omega_n r^n} \]
    is a Borel measurable function on $X$.
    <span class="proof-end">‚ñ°</span>
  </div>
</div></p>
<p>If we have a certain inquality for the $n$-dimensional upper density, then we can relate the measure $\mu$ to the $n$-dimensional Hausdorff measure $\mathcal{H}^n$.</p>
<div class="theorem-box lemma-box" id="lem:baby_comparison_lemma">
  <div class="theorem-header"><strong>Lemma ?</strong> (Comparison Lemma)</div>
  <div class="theorem-content">Let $\mu$ be a Borel regular outer measure on $X$, and let $t\geq 0$ and $A_1 \subseteq A_2 \subseteq X$.
    Then
    \[ \Theta^{*n}(\mu,A_2,x) \geq t \quad\forall x \in A_1 \ \implies t \mathcal{H}^n(A_1) \leq \mu(A_2). \]</div>
</div>
<p>Of course an important special case is when $A_1 = A_2$. Note that we <em>do not</em> assume that $A_1$ and $A_2$ are Borel measurable.</p>
<div class="proof-box collapsed" data-proof-id="proof-num-1">
  <div class="proof-header">
    <button class="proof-toggle" onclick="toggleProof('proof-num-1')" aria-expanded="false">
      <span class="proof-toggle-icon">‚ñº</span>
      <strong>Proof</strong>
    </button>
  </div>
  <div class="proof-content" id="proof-num-1">
    If either $t=0$ or $\mu(A_2) = \infty$, the inequality is trivial, so we may assume that $t > 0$ and $\mu(A_2) < \infty$.
<p>Fix $\tau \in (0,t)$ so that 
    \[  \Theta^{*n}(\mu,A_2,x) \geq \tau \quad\forall x \in A_1 .\] 
    Also let $\delta > 0$ be arbitrary and define
    \[ \mathcal{B}_\delta := \left\{ \overline{B}(x,r) : x\in A_1, 0 < r < \frac{\delta}{2}, \mu(A_2 \cap \overline{B}(x,r)) \geq \tau \omega_nr^n \right\}. \]
    Then $\mathcal{B}_\delta$ is a collection of closed balls which covers $A_1$, the diameters of the balls in $\mathcal{B}_\delta$ are uniformly bounded above by $\delta$, and for each $a \in A_1$ we have
    \[ \inf\{ r : \overline{B}(a,r) \in \mathcal{B}_\delta \} = 0. \]
    By the Vitali Covering Lemma <span class="ref-unknown" title="Reference not found: lem:infinite_5r_covering_lemma">[lem:infinite_5r_covering_lemma?]</span>, there exists a disjoint subcover $\mathcal{B}'_\delta \subseteq \mathcal{B}_\delta$ such that
    \[ A_1 \subseteq \bigcup_{ B \in \mathcal{B}'_\delta } 5B. \]</p>
<p>We claim that $\mathcal{B}'_\delta$ is countable.
    If $X$ is separable, then this is immediate as no uncountable collection of disjoint balls can exist in a separable metric space.
    If $X$ is not separable, then we can argue as follows.
    Since $ \mu(A_2 \cap B) > 0 $ for each $B \in \mathcal{B}'_\delta$, and 
    \[ B_1, B_2, \ldots, B_N \in \mathcal{B}'_\delta \implies \sum_{j=1}^N \mu(A_2 \cap B_j) = \mu(A_2 \cap \bigcup_{j=1}^N B_j) \leq \mu(A_2) < \infty \]
    it follows that $\mathcal{B}'_\delta$ is at most countable.
    Thus 
    \[ A_1 \setminus \bigcup_{j=1}^N B_j \subseteq \bigcup_{B \in \mathcal{B}'_\delta\setminus\{ B_1,\ldots,B_N \}} 5B \]
    for each $N \in \Z^+$ because $\inf\{ r : \overline{B}(a,r) \in \mathcal{B}_\delta \} = 0$ for each $a \in A_1$.
    Also 
    \begin{align*}
        \tau\sum_{j=1}^\infty \omega_n r_j^n &\leq \sum_{j=1}^\infty \mu(A_2 \cap \overline{B}(x_j,r_j)) \\
            &= \mu\left( A_2 \cap \bigcup_{j=1}^\infty \overline{B}(x_j,r_j) \right) \\
            &\leq \mu(A_2) < \infty.
    \end{align*}
    As a result, we see that 
    \[ A_2 \subseteq \left(\bigcup_{j=1}^N B_j \right) \cup \left(\bigcup_{j=N+1}^\infty 5B_j \right) \]
    for each $N \in \Z^+$, and hence the definition of $\mathcal{H}^n_{5\delta}$ gives
    \[ \mathcal{H}^n_{5\delta} (A_1) \leq \sum_{j=1}^N \omega_n r_j^n + 5^n \sum_{j=N+1}^\infty \omega_n r_j^n. \]
    Taking the limit as $N \to \infty$, the first term converges to $\sum_{j=1}^\infty \omega_n r_j^n$ and the second term converges to $0$, so we get
    \[ \mathcal{H}^n_{5\delta}(A_1) \leq \sum_{j=1}^\infty \omega_n r_j^n \leq \frac{1}{\tau} \mu(A_2). \]
    Since $\delta > 0$ was arbitrary, taking the limit as $\delta \to 0^+$ and then letting $\tau \to t^-$ gives
    \[  \mathcal{H}^n_{5\delta}(A_1) \leq \frac{1}{t} \mu(A_2) \]
    which completes the proof.
    <span class="proof-end">‚ñ°</span>
  </div>
</div></p>
<div class="theorem-box theorem-box" id="thm:upper_density_theorem">
  <div class="theorem-header"><strong>Theorem ?</strong> (Upper Density Theorem)</div>
  <div class="theorem-content">Let $\mu$ be a Borel regular outer measure on $X$, and let $A \subseteq X$ be a Borel measurable set with $\mu(A) < \infty$.
    Then for $\mathcal{H}^n$-almost every $x \in X\setminus A$, we have
    \[ \Theta^{*n}(\mu,A,x) = 0. \]</div>
</div>
<div class="proof-box collapsed" data-proof-id="proof-num-2">
  <div class="proof-header">
    <button class="proof-toggle" onclick="toggleProof('proof-num-2')" aria-expanded="false">
      <span class="proof-toggle-icon">‚ñº</span>
      <strong>Proof</strong>
    </button>
  </div>
  <div class="proof-content" id="proof-num-2">
    Let $t \geq 0$ and define
    \[ E_t := \{ x \in X\setminus A : \Theta^{*n}(\mu,A,x) > t \} \]
    and let $C \subseteq A$ be an arbitrary closed subset.
    Since $X \setminus C$ is an open set and 
    \[ E_t \subseteq X \setminus A \subseteq X \setminus C \]
    we see that
    \[ \Theta^{*n}(\mu, A\cap (X\setminus C),x) = \Theta^{*n}(\mu, A,x) \geq t \]
    for each $x \in E_t$.
    Thus by the Comparison Lemma <span class="ref-unknown" title="Reference not found: lem:baby_comparison_lemma">[lem:baby_comparison_lemma?]</span>, we have
    \[ t\mathcal{H}^n( E_t ) \leq \mu(A\setminus C). \]
    Since $C \subseteq A$ was an arbitrary closed subset, we note this holds for each closed subset of $A$.
<p>By Borel regularity of $\mu$, there exists a sequence of closed sets $\{ C_j \}_{j=1}^\infty$ such that $C_j \subseteq A$ for each $j \in \Z^+$ and
    \[ \mu(A) = \lim_{j\to\infty} \mu(C_j). \]
    Thus taking the limit as $j \to \infty$ gives
    \[ t\mathcal{H}^n( E_t ) \leq \lim_{j\to\infty} \mu(A\setminus C_j) = \mu(A) - \lim_{j\to\infty} \mu(C_j) = 0. \]
    Since $t \geq 0$ was arbitrary, we conclude that
    \[ \mathcal{H}^n( E_t ) = 0 \qquad\forall\, t > 0 \]
    which implies that
    \[ \mathcal{H}^n( \{ x \in X\setminus A : \Theta^{*n}(\mu,A,x) > 0 \} ) = 0. \]
    and hence
    \[ \Theta^{*n}(\mu,A,x) = 0 \quad\text{for $\mathcal{H}^n$-a.e. } x \in X\setminus A. \]
    <span class="proof-end">‚ñ°</span>
  </div>
</div></p>
<div class="theorem-box exercise-box" id="ex:upper_density_theorem_sigma_finite">
  <div class="theorem-header"><strong>Exercise ?</strong> (Upper Density Theorem for $\sigma$-Finite Measures)</div>
  <div class="theorem-content">Show that in the previous theorem, you can drop the hypothesis $\mu(A) < \infty$ if you assume that $(X,\mu)$ is open $\sigma$-finite.</div>
</div>
<div class="proof-box collapsed" data-proof-id="proof-num-3">
  <div class="proof-header">
    <button class="proof-toggle" onclick="toggleProof('proof-num-3')" aria-expanded="false">
      <span class="proof-toggle-icon">‚ñº</span>
      <strong>Proof</strong>
    </button>
  </div>
  <div class="proof-content" id="proof-num-3">
    Assume that $(X,\mu)$ is open $\sigma$-finite, so there exists a countable collection of open sets $\{ U_j \}_{j=1}^\infty$ such that $X = \bigcup_{j=1}^\infty U_j$ and $\mu(U_j) < \infty$ for each $j \in \Z^+$.
    Then for each $j \in \Z^+$, we consider the measure $\mu \mres U_j$ which satisfies $(\mu\mres U_j)(X) = \mu(U_j) < \infty$; thus we may apply Theorem <span class="ref-unknown" title="Reference not found: thm:upper_density_theorem">[thm:upper_density_theorem?]</span> to conclude that
    \[ \Theta^{*n}(\mu\mres U_j,A,x) = \Theta^{*n}(\mu,A\cap U_j,x) = 0 \quad\text{for $\mathcal{H}^n$-a.e. } x \in U_j\setminus A. \]
    Then we have $X\setminus A = \bigcup_{j=1}^\infty (U_j\setminus A)$, so it follows that
    \[ \Theta^{*n}(\mu,A,x) = 0 \quad\text{for $\mathcal{H}^n$-a.e. } x \in X\setminus A. \]
    <span class="proof-end">‚ñ°</span>
  </div>
</div>
<div class="theorem-box corollary-box" id="cor:density_of_lebesgue_measure">
  <div class="theorem-header"><strong>Corollary ?</strong> (Density of Lebesgue Measure)</div>
  <div class="theorem-content">If $A \subset \mathcal{L}^n$ is Lebesgue measurable, then the density $\Theta^n(\mathcal{L}^n,A,x)$ exists for $\mathcal{L}^n$-almost every $x \in \R^n$, and
    \[ \Theta^n(\mathcal{L}^n,A,x) = 1 \quad\text{for $\mathcal{L}^n$-a.e. } x \in A, \]
    and
    \[ \Theta^n(\mathcal{L}^n,A,x) = 0 \quad\text{for $\mathcal{L}^n$-a.e. } x \in \R^n\setminus A. \]</div>
</div>
<div class="proof-box collapsed" data-proof-id="proof-num-4">
  <div class="proof-header">
    <button class="proof-toggle" onclick="toggleProof('proof-num-4')" aria-expanded="false">
      <span class="proof-toggle-icon">‚ñº</span>
      <strong>Proof</strong>
    </button>
  </div>
  <div class="proof-content" id="proof-num-4">
    Since $A$ is Lebesgue measurable, we have
    \[ \mathcal{L}^n(\overline{B}(x,r)) = \mathcal{L}^n(A\cap \overline{B}(x,r)) + \mathcal{L}^n( \overline{B}(x,r)\setminus A) \qquad\forall\, x\in \R^n, r > 0 \]
    which implies that
    \[ 1 = \frac{\mathcal{L}^n(\overline{B}(x,r))}{\omega_n r^n} = \frac{\mathcal{L}^n(A\cap \overline{B}(x,r))}{\omega_n r^n} + \frac{\mathcal{L}^n(A\setminus \overline{B}(x,r))}{\omega_n r^n} \qquad \forall\, x\in \R^n, r>0. \]
    Taking the limit superior as $r \to 0^+$, the Upper Density Theorem <span class="ref-unknown" title="Reference not found: thm:upper_density_theorem">[thm:upper_density_theorem?]</span> implies that the first term on the right-hand side converges to $\Theta^{*n}(\mathcal{L}^n,A,x)$ and the second term converges to $\Theta^{*n}(\mathcal{L}^n,\R^n\setminus A,x)$ for $\mathcal{L}^n$-almost every $x \in \R^n$.
    That is, 
    \[ 1 = \Theta^{*n}(\mathcal{L}^n,A,x) + 0 \qquad\text{ for $\mathcal{L}^n$-a.e. } x \in A \]
    and
    \[ 1 = 0 + \Theta^{*n}(\mathcal{L}^n,\R^n\setminus A,x) \qquad\text{ for $\mathcal{L}^n$-a.e. } x \in \R^n\setminus A. \]
    Thus the limit defining the density $\Theta^n(\mathcal{L}^n,A,x)$ exists for $\mathcal{L}^n$-almost every $x \in \R^n$, and the desired equalities hold.
    <span class="proof-end">‚ñ°</span>
  </div>
</div>
<h3>The Symmetric Vitali Property</h3>
We want to generalize the Comparison Lemma <span class="ref-unknown" title="Reference not found: lem:baby_comparison_lemma">[lem:baby_comparison_lemma?]</span> and the Upper Density Theorem <span class="ref-unknown" title="Reference not found: thm:upper_density_theorem">[thm:upper_density_theorem?]</span>.
<div class="theorem-box exercise-box" id="ex:set_where_measure_vanishes_are_open">
  <div class="theorem-header"><strong>Exercise ?</strong> (The Set where a Measure Vanishes is Open)</div>
  <div class="theorem-content">Let $\mu$ be a Borel regular outer measure on $X$.
    Then the set \[ U_{\mu} := \{ x\in X : \mu(\overline{B}(x,r)) = 0 \text{ for some } r > 0 \} \] is open.
    If $X$ is a separable metric space, then $\mu(U_{\mu}) = 0$.</div>
</div>
<div class="proof-box collapsed" data-proof-id="proof-num-5">
  <div class="proof-header">
    <button class="proof-toggle" onclick="toggleProof('proof-num-5')" aria-expanded="false">
      <span class="proof-toggle-icon">‚ñº</span>
      <strong>Proof</strong>
    </button>
  </div>
  <div class="proof-content" id="proof-num-5">
    Let $x \in U_{\mu}$ be arbitrary.
    Then there exists $r > 0$ such that $\mu(\overline{B}(x,r)) = 0$.
    If $y \in B(x,r)$, then $d(x,y) < r$ and $\overline{B}(y,r - d(x,y)) \subseteq \overline{B}(x,r)$ by the triangle inequality, so by monotonicity of $\mu$ we have
    \[ \mu(\overline{B}(y,r - d(x,y))) \leq \mu(\overline{B}(x,r)) = 0 \]
    which implies that $y \in U_{\mu}$.
    Thus $B(x,r) \subseteq U_{\mu}$, showing that $U_{\mu}$ is open.
<p><div style="margin: 1em 0;"></div></p>
<p>Now assume that $X$ is a separable metric space.
    Then $U_{\mu}$ is also separable, so there exists a countable dense subset $\{ x_j \}_{j=1}^\infty \subseteq U_{\mu}$.
    For each $j \in \Z^+$, there exists $r_j > 0$ such that $\mu(\overline{B}(x_j,r_j)) = 0$.
    Thus
    \[ U_{\mu} = \bigcup_{j=1}^\infty \overline{B}(x_j,r_j) \]
    by density of $\{ x_j \}_{j=1}^\infty$ in $U_{\mu}$, so by countable subadditivity of $\mu$ we have
    \[ \mu(U_{\mu}) \leq \sum_{j=1}^\infty \mu(\overline{B}(x_j,r_j)) = 0. \]
    <span class="proof-end">‚ñ°</span>
  </div>
</div></p>
<div class="theorem-box definition-box" id="def:upper_lower_density_wrt_measure">
  <div class="theorem-header"><strong>Definition ?</strong> (Upper Densities with respect to a Measure)</div>
  <div class="theorem-content">Let $\mu$ and $\mu_0$ be Borel regular outer measures on $X$, and assume that $\mu_0$ is locally finite. 
    Let
    \[ U_{\mu_0} := \{ x\in X : \mu_0(\overline{B}(x,r)) = 0 \text{ for some } r > 0 \} \]
    and \[ U_{\mu} := \{ x\in X : \mu(\overline{B}(x,r)) = 0 \text{ for some } r > 0 \}. \]
    We define the <em>upper density</em> of $\mu$ with respect to $\mu_0$ by
    \[ \Theta^{*\mu_0}(\mu,x) := \begin{cases}
        \displaystyle\limsup_{r \to 0^+} \frac{\mu(\overline{B}(x,r))}{\mu_0(\overline{B}(x,r))}, & \text{ if } x \in X \setminus (U_{\mu_0} \cup U_{\mu}), \\
        \infty, & \text{ if } x \in U_{\mu_0} \setminus U_{\mu}, \\
        0, & \text{ if } x \in U_{\mu}.
    \end{cases} \]</div>
</div>
<p>Note that the set $U_{\mu_0}\setminus U_{\mu}$ in the above definition is not the only way that $\Theta^{*\mu_0}(\mu,x)$ can be infinite; it can also be infinite if the limit superior diverges to infinity.</p>
<div class="theorem-box remark-box collapsible-box collapsed" id="rem:upper_densities_wrt_measure_generalize_n_dimensional_upper_densities" data-collapsible-id="collapsible-rem:upper_densities_wrt_measure_generalize_n_dimensional_upper_densities">
  <div class="theorem-header clickable" onclick="toggleCollapsible('collapsible-rem:upper_densities_wrt_measure_generalize_n_dimensional_upper_densities')">
    <span class="collapsible-icon">‚ñº</span>
    <strong>Remark ?</strong> (Upper Densities with respect to Lebesgue Measure on $\R^n$)
  </div>
  <div class="theorem-content collapsible-content" id="collapsible-rem:upper_densities_wrt_measure_generalize_n_dimensional_upper_densities">Notice that if $X = \R^n$ and $\mu_0 = \mathcal{L}^n$ is Lebesgue measure on $\R^n$, then the definition of $\Theta^{*\mu_0}(\mu,x)$ agrees with the definition of the $n$-dimensional upper density $\Theta^{*n}(\mu,x)$ from Definition <span class="ref-unknown" title="Reference not found: def:n_dim_upper_lower_density">[def:n_dim_upper_lower_density?]</span>, i.e., we have
    \[ \Theta^{*\mathcal{L}^n}(\mu,x) = \Theta^{*n}(\mu,x) \qquad\forall x \in \R^n. \]</div>
</div>
<div class="theorem-box remark-box collapsible-box collapsed" id="remark-?" data-collapsible-id="collapsible-remark-conditions-to-ensure-mu-0-u-mu-0-0-">
  <div class="theorem-header clickable" onclick="toggleCollapsible('collapsible-remark-conditions-to-ensure-mu-0-u-mu-0-0-')">
    <span class="collapsible-icon">‚ñº</span>
    <strong>Remark ?</strong> (Conditions to Ensure $\mu_0(U_{\mu_0}) = 0$.)
  </div>
  <div class="theorem-content collapsible-content" id="collapsible-remark-conditions-to-ensure-mu-0-u-mu-0-0-">There are various conditions one can impose on $\mu_0$ to ensure that $\mu_0(U_{\mu_0}) = 0$.
    For example, if $X$ is a seperable metric space then this was shown in Exercise <span class="ref-unknown" title="Reference not found: ex:set_where_measure_vanishes_are_open">[ex:set_where_measure_vanishes_are_open?]</span>.
<p>Also if $(X,\mu_0)$ is open $\sigma$-finite and $\mu_0$ has the Symmetric Vitali Property (Definition <span class="ref-unknown" title="Reference not found: def:symmetric_vitali_property">[def:symmetric_vitali_property?]</span> below), then $\mu_0(U_{\mu_0}) = 0$.
    See Exercise <span class="ref-unknown" title="Reference not found: ex:measure_of_set_where_measure_vanishes_is_zero">[ex:measure_of_set_where_measure_vanishes_is_zero?]</span> for the proof.</div>
</div></p>
<div class="theorem-box definition-box" id="def:symmetric_vitali_property">
  <div class="theorem-header"><strong>Definition ?</strong> (Symmetric Vitali Property)</div>
  <div class="theorem-content">Let $\mu$ be a Borel outer measure on $X$. 
    We say that $\mu$ has the <em>symmetric Vitali property</em> if for each subset $A \subseteq X$ such that $\mu(A) < \infty$, and for each collection $\mathcal{B}$ of closed balls in $X$ such that the center of each ball in $\mathcal{B}$ is in $A$ and 
    \[ \inf\{ r : \overline{B}(a,r) \in\mathcal{B}\} = 0 \]
    for each $a \in A$, there exists a countable disjoint subcollection $\{ B_j \}_{j=1}^\infty \subseteq \mathcal{B}$ such that
    \[ \mu\left( A \setminus \bigcup_{j=1}^\infty B_j \right) = 0. \]</div>
</div>
<p>An informal way to think about the symmetric Vitali property is that we can ``almost'' cover an arbitrary finite measure set $A$ by disjoint balls with centers in $A$.</p>
<div class="theorem-box example-box collapsible-box collapsed" id="ex:radon_measures_on_Rn_have_symmetric_vitali_property" data-collapsible-id="collapsible-ex:radon_measures_on_Rn_have_symmetric_vitali_property">
  <div class="theorem-header clickable" onclick="toggleCollapsible('collapsible-ex:radon_measures_on_Rn_have_symmetric_vitali_property')">
    <span class="collapsible-icon">‚ñº</span>
    <strong>Example ?</strong> (Borel Regular Measures on $\R^n$ have the Symmetric Vitali Property)
  </div>
  <div class="theorem-content collapsible-content" id="collapsible-ex:radon_measures_on_Rn_have_symmetric_vitali_property">Each Borel regular outer measure on $\R^n$ which is finite on compact sets has the symmetric Vitali property --- this is exactly what was proven in Lemma <span class="ref-unknown" title="Reference not found: lem:filling_finite_measure_sets_with_balls">[lem:filling_finite_measure_sets_with_balls?]</span> by using the Besicovich Covering Theorem <span class="ref-unknown" title="Reference not found: thm:besicovitch_covering_theorem">[thm:besicovitch_covering_theorem?]</span>.</div>
</div>
<div class="theorem-box exercise-box" id="ex:finite_borel_regular_measures_with_doubling_condition_have_symmetric_vitali_property">
  <div class="theorem-header"><strong>Exercise ?</strong> (Finite Borel Regular Measures with a Doubling Condition have the Symmetric Vitali Property)</div>
  <div class="theorem-content">Let $\mu$ be a Borel regular outer measure on $X$ such that $\mu(X) < \infty$, and assume that there exists a constant $\mathbf{b} > 0$ such that 
    \[ \mu( 2B ) \leq \mathbf{b}\mu(B) \qquad \text{ for each closed ball } B \subseteq X. \tag{$\ddag$}\]
    Then $\mu$ has the symmetric Vitali property.</div>
</div>
<p>The condition $(\ddag)$ is called a <em>doubling condition</em>, and it says that we can uniformly control the measure of a ball by the measure of a ball with half the radius.
The constant $\mathbf{b}$ is called a <em>doubling constant</em> for $\mu$.
Also note that some people prefer to state the doubling condition in terms tripling the radius (which is cleaner for using things like Vitali's Covering Theorem), but the two versions are equivalent up to changing the constant $\mathbf{b}$.</p>
<div class="proof-box collapsed" data-proof-id="proof-num-6">
  <div class="proof-header">
    <button class="proof-toggle" onclick="toggleProof('proof-num-6')" aria-expanded="false">
      <span class="proof-toggle-icon">‚ñº</span>
      <strong>Proof</strong>
    </button>
  </div>
  <div class="proof-content" id="proof-num-6">
    Let $A \subseteq X$ be such that $\mu(A) < \infty$, and let $\mathcal{B}$ be a collection of closed balls in $X$ such that the center of each ball in $\mathcal{B}$ is in $A$ and
    \[ \inf\{ r : \overline{B}(a,r) \in\mathcal{B}\} = 0 \]
    for each $a \in A$.
    By Vitali's Covering Lemma (Infinite Version) <span class="ref-unknown" title="Reference not found: lem:infinite_5r_covering_lemma">[lem:infinite_5r_covering_lemma?]</span>, there exists a countable disjoint subcollection $\{ B_j \}_{j=1}^\infty \subseteq \mathcal{B}$ such that
    \[ A \subseteq \bigcup_{j=1}^\infty 5B_j. \]
    Since
    \[ \mu(5B_j) \leq \mu(8B_j) \leq \mathbf{b}^3 \mu(B_j) \]
    for each $j \in \Z^+$ by applying the doubling condition $(\ddag)$ three times, we have
    \[ \mu\left( A \setminus \bigcup_{j=1}^N B_j \right) \leq \mu\left( \bigcup_{j=N+1}^\infty 5B_j \right) \leq \mathbf{b}^3 \sum_{j=N+1}^\infty \mu(B_j) \]
    for each $N \in \Z^+$.
    Since $\sum_{j=1}^\infty \mu(B_j) \leq \mu(X) < \infty$, we have
    \[ \lim_{N \to \infty} \mu\left( A \setminus \bigcup_{j=1}^N B_j \right) = \lim_{N \to \infty} \sum_{j=N+1}^\infty \mu(B_j) = 0, \]
    which implies that
    \[ \mu\left( A \setminus \bigcup_{j=1}^\infty B_j \right) = 0. \]
    Since $\mathcal{B}$ and $A$ were arbitrary, we conclude that $\mu$ has the symmetric Vitali property.
    <span class="proof-end">‚ñ°</span>
  </div>
</div>
<div class="theorem-box exercise-box" id="ex:measure_of_set_where_measure_vanishes_is_zero">
  <div class="theorem-header"><strong>Exercise ?</strong> (Measure of Set Where Measure Vanishes is Zero)</div>
  <div class="theorem-content">Let $\mu$ be a Borel regular outer measure on $X$ which is open $\sigma$-finite and has the symmetric Vitali property.
    Show that $\mu(U_{\mu}) = 0$ where 
    \[ U_{\mu} := \{ x\in X : \mu(\overline{B}(x,r)) = 0 \text{ for some } r > 0 \}. \]</div>
</div>
<div class="proof-box collapsed" data-proof-id="proof-num-7">
  <div class="proof-header">
    <button class="proof-toggle" onclick="toggleProof('proof-num-7')" aria-expanded="false">
      <span class="proof-toggle-icon">‚ñº</span>
      <strong>Proof</strong>
    </button>
  </div>
  <div class="proof-content" id="proof-num-7">
    First we assume that $\mu(U_{\mu}) < \infty$.
    See that the collection of closed balls
    \[ \mathcal{B} := \{ \overline{B}(x,r) : x \in U_{\mu}, r > 0, \mu(\overline{B}(x,r)) = 0 \} \]
    satisfies
    \[ \inf\{ r : \overline{B}(a,r) \in\mathcal{B}\} = 0 \]
    for each $a \in U_{\mu}$.
    Since $\mu$ has the symmetric Vitali property, there exists a countable disjoint subcollection $\{ B_j \}_{j=1}^\infty \subseteq \mathcal{B}$ such that
    \[ \mu\left( U_{\mu} \setminus \bigcup_{j=1}^\infty B_j \right) = 0. \]
    But $\mu(B_j) = 0$ for each $j \in \Z^+$ by construction, so by countable subadditivity of $\mu$ we have
    \[ \mu(U_{\mu}) \leq \mu\left( U_{\mu} \setminus \bigcup_{j=1}^\infty B_j \right) + \sum_{j=1}^\infty \mu(B_j) = 0. \]
<p><div style="margin: 1em 0;"></div></p>
<p>Now if $\mu(U_{\mu}) = \infty$, since $\mu$ is open $\sigma$-finite there exists a countable collection of open sets $\{ U_k \}_{k=1}^\infty$ such that $X = \bigcup_{k=1}^\infty U_k$ and $\mu(U_k) < \infty$ for each $k \in \Z^+$.
    Then we have
    \[ U_{\mu} = \bigcup_{k=1}^\infty (U_{\mu} \cap U_k) \]
    and $\mu(U_{\mu} \cap U_k) \leq \mu(U_k) < \infty$ for each $k \in \Z^+$, so by the previous case we have $\mu(U_{\mu} \cap U_k) = 0$ for each $k \in \Z^+$.
    Thus by countable subadditivity of $\mu$ we have
    \[ \mu(U_{\mu}) \leq \sum_{k=1}^\infty \mu(U_{\mu} \cap U_k) = 0. \]
    <span class="proof-end">‚ñ°</span>
  </div>
</div></p>
<div class="theorem-box exercise-box" id="ex:symmetric_vitali_property_extends_to_infinite_measure_sets_when_open_sigma_finite">
  <div class="theorem-header"><strong>Exercise ?</strong> (Symmetric Vitali Property and Open $\sigma$-Finiteness)</div>
  <div class="theorem-content">Let $\mu$ be a Borel regular outer measure on $X$ which is open $\sigma$-finite and has the symmetric Vitali property.
    Then the symmetric Vitali property holds for all subsets $A \subseteq X$ such that $\mu(A) = \infty$ as well.</div>
</div>
<div class="proof-box collapsed" data-proof-id="proof-num-8">
  <div class="proof-header">
    <button class="proof-toggle" onclick="toggleProof('proof-num-8')" aria-expanded="false">
      <span class="proof-toggle-icon">‚ñº</span>
      <strong>Proof</strong>
    </button>
  </div>
  <div class="proof-content" id="proof-num-8">
    Let $A \subseteq X$ be such that $\mu(A) = \infty$.
    Since $\mu$ is open $\sigma$-finite, there exists a countable collection of open sets $\{ U_k \}_{k=1}^\infty$ such that $X = \bigcup_{k=1}^\infty U_k$ and $\mu(U_k) < \infty$ for each $k \in \Z^+$.
    Then we have
    \[ A = \bigcup_{k=1}^\infty (A \cap U_k) \]
    and $\mu(A \cap U_k) \leq \mu(U_k) < \infty$ for each $k \in \Z^+$.
    By the symmetric Vitali property for finite measure sets, for each $k \in \Z^+$ there exists a countable disjoint subcollection $\left\{ B_j^{(k)} \right\}_{j=1}^\infty$ of closed balls in $\mathcal{B}$ with centers in $A \cap U_k$ such that
    \[ \mu\left( (A \cap U_k) \setminus \bigcup_{j=1}^\infty B_j^{(k)} \right) = 0. \]
    Then the collection
    \[ \left\{ B_j^{(k)} : j,k \in \Z^+ \right\} \]
    is a countable disjoint subcollection of $\mathcal{B}$ with centers in $A$ such that
    \begin{align*}
        \mu\left( A \setminus \bigcup_{k=1}^\infty \bigcup_{j=1}^\infty B_j^{(k)} \right) &\leq \mu\left( \bigcup_{k=1}^\infty \left( (A \cap U_k) \setminus \bigcup_{j=1}^\infty B_j^{(k)} \right) \right) \\   
        &\leq \sum_{k=1}^\infty \mu\left( (A \cap U_k) \setminus \bigcup_{j=1}^\infty B_j^{(k)} \right) = 0.
    \end{align*}
    <span class="proof-end">‚ñ°</span>
  </div>
</div>
<div class="theorem-box lemma-box" id="lem:comparison_lemma_general">
  <div class="theorem-header"><strong>Lemma ?</strong> (General Comparison Lemma)</div>
  <div class="theorem-content">Let $\mu$ and $\mu_0$ be Borel regular outer measures on $X$ which are both open $\sigma$-finite, and assume that $\mu_0$ has the symmetric Vitali property.
    Also let $t \geq 0$ and $A \subseteq X$.
    Then
    \[ \Theta^{*\mu_0}(\mu,x) \geq t \quad\forall \,x \in A \quad \implies \mu(A) \geq t \cdot \mu_0(A). \]</div>
</div>
<div class="proof-box collapsed" data-proof-id="proof-num-9">
  <div class="proof-header">
    <button class="proof-toggle" onclick="toggleProof('proof-num-9')" aria-expanded="false">
      <span class="proof-toggle-icon">‚ñº</span>
      <strong>Proof</strong>
    </button>
  </div>
  <div class="proof-content" id="proof-num-9">
    The proof is similar to that of the Comparison Lemma <span class="ref-unknown" title="Reference not found: lem:baby_comparison_lemma">[lem:baby_comparison_lemma?]</span>, but we use the Symmetric Vitali Property in place of the Vitali Covering Lemma.
<p><div style="margin: 1em 0;"></div></p>
<p>Let $U_{\mu_0}$ and $U_{\mu}$ be as in Definition <span class="ref-unknown" title="Reference not found: def:upper_lower_density_wrt_measure">[def:upper_lower_density_wrt_measure?]</span>.
    Because $(X,\mu_0)$ is open $\sigma$-finite and $\mu_0$ has the symmetric Vitali property, we have $\mu_0(U_{\mu_0}) = 0$ by Exercise <span class="ref-unknown" title="Reference not found: ex:measure_of_set_where_measure_vanishes_is_zero">[ex:measure_of_set_where_measure_vanishes_is_zero?]</span>.
    Also the desired inequality is trivial if $t = 0$ so we assume that $t > 0$. Let $ A \subseteq X$ be a subset such that 
    \[ \Theta^{*\mu_0}(\mu,x) \geq t \quad\forall \,x \in A. \]
    Let $U \subseteq X$ be an open set such that $A \subseteq U$; 
    fix $\tau \in (0,t)$.</p>
<p>We consider the collection of closed balls
    \[ \mathcal{B} := \left\{ \overline{B}(x,r) : x\in X \cap (X\setminus U_{\mu_0}), \overline{B}(x,r) \subset U, \text{ and } \mu(\overline{B}(x,r)) > \tau \mu_0(\overline{B}(x,r)) \right\}. \]
    See that for each $a \in A \setminus U_{\mu_0}$, we have
    \[\Theta^{*\mu_0}(\mu,a) = \limsup_{r\to 0^+} \frac{\mu(\overline{B}(a,r))}{\mu_0(\overline{B}(a,r))} \geq t > \tau \]
    which implies that there exists $r_a > 0$ such that for all $0 < r < r_a$ we have
    \[ \mu(\overline{B}(a,r)) > \tau \mu_0(\overline{B}(a,r)). \]
    Thus
    \[ \inf\{ r : \overline{B}(a,r) \in\mathcal{B}\} = 0 \]
    for each $a \in A \setminus U_{\mu_0}$.</p>
<p>Since $\mu_0$ has the symmetric Vitali property, there exists a countable disjoint subcollection $\{ B_j \}_{j=1}^\infty \subseteq \mathcal{B}$ such that
    \[  \mu_0\left( (A\setminus U_{\mu_0}) \setminus \bigcup_{j=1}^\infty B_j \right) = 0. \]
    (By Exercise <span class="ref-unknown" title="Reference not found: ex:symmetric_vitali_property_extends_to_infinite_measure_sets_when_open_sigma_finite">[ex:symmetric_vitali_property_extends_to_infinite_measure_sets_when_open_sigma_finite?]</span>, we can apply the symmetric Vitali property even if $\mu_0(A) = \infty$.)
    Thus
    \[ \mu_0\left( A \setminus \bigcup_{j=1}^\infty B_j \right) \leq \mu_0\left( (A\setminus U_{\mu_0}) \setminus \bigcup_{j=1}^\infty B_j \right) + \mu_0(U_{\mu_0}) = 0 \]
    by using that $\mu_0(U_{\mu_0}) = 0$.
    By definition of $\mathcal{B}$, we have
    \[ \mu(B_j) > \tau \mu_0(B_j) \]
    for each $j \in \Z^+$, so by adding we obtain
    \begin{align*}
        \tau \mu_0(A) &\leq \tau\mu_0\left( A \setminus \bigcup_{j=1}^\infty B_j \right) + \tau \mu_0\left( \bigcup_{j=1}^\infty B_j \right)  \\
            &= 0 + \tau \sum_{j=1}^\infty \mu_0(B_j) &&\text{ by disjointness of } \{ B_j \}_{j=1}^\infty \\
            &< \sum_{j=1}^\infty \mu(B_j) &&\text{ by definition of } \mathcal{B} \\
            &= \mu\left( \bigcup_{j=1}^\infty B_j \right) \leq \mu(U) && \text{ since } B_j \subseteq U \text{ for each } j \in \Z^+.
    \end{align*}
    Since $U \supseteq A$ was an arbitrary open set, Borel regularity of $\mu$ gives
    \[ \mu(A) \geq \tau \mu_0(A). \]
    Taking the limit as $\tau \to t^-$ completes the proof.
    <span class="proof-end">‚ñ°</span>
  </div>
</div></p>
<div class="theorem-box corollary-box" id="cor:upper_density_finite">
  <div class="theorem-header"><strong>Corollary ?</strong> (Upper Density Finite almost everywhere)</div>
  <div class="theorem-content">Let $\mu$ and $\mu_0$ be Borel regular outer measures on $X$ which are both open $\sigma$-finite, and assume that $\mu_0$ has the symmetric Vitali property.
    Then
    \[ \Theta^{*\mu_0}(\mu,x) < \infty \]
    for $\mu_0$-almost every $x \in X$.</div>
</div>
<div class="proof-box collapsed" data-proof-id="proof-num-10">
  <div class="proof-header">
    <button class="proof-toggle" onclick="toggleProof('proof-num-10')" aria-expanded="false">
      <span class="proof-toggle-icon">‚ñº</span>
      <strong>Proof</strong>
    </button>
  </div>
  <div class="proof-content" id="proof-num-10">
    Before the proof, maybe you are na√Øve and think that this is obvious because our assumptions guaruntee that $\mu_0(U_{\mu_0}) = 0$ by Exercise <span class="ref-unknown" title="Reference not found: ex:measure_of_set_where_measure_vanishes_is_zero">[ex:measure_of_set_where_measure_vanishes_is_zero?]</span>, so we are done.
    A moments thought reveals that this is not the only way that $\Theta^{*\mu_0}(\mu,x)$ can be infinite; it can also be infinite if the limit superior diverges to infinity.
    Thus we need to do some work.
<p><div style="margin: 1em 0;"></div></p>
<p>Since $X$ is open $\sigma$-finite with respect to $\mu_0$, there exists a countable collection of open sets $\{ U_k \}_{k=1}^\infty$ such that $X = \bigcup_{k=1}^\infty U_k$ and $\mu_0(U_k) < \infty$ for each $k \in \Z^+$.
    For each $m \in \Z^+$, we consider $\mu \mres U_j$ which is a Borel regular outer measure on $X$ satisfying $(\mu \mres U_j)(X) = \mu(U_j) < \infty$.</p>
<p>Fix $m \in \Z^+$ and $t > 0$ and define
    \[ A_{m,t} := \{ x\in U_m \setminus U_{\mu_0} : \Theta^{*\mu_0}(\mu,x) \geq t \}. \]
    By the General Comparison Lemma <span class="ref-unknown" title="Reference not found: lem:comparison_lemma_general">[lem:comparison_lemma_general?]</span>, we have
    \[ t \mu_0 (A_{m,t}) \leq \mu_m(A_{m,t}) \leq \mu(U_m) < \infty \]
    and thus
    \[ \mu_0 (\{x \in U_m : \Theta^{*\mu_0}(\mu,x) = \infty \}) \leq \frac{1}{t} \mu(U_m). \]
    Since this holds for each $t > 0$, we conclude that
    \[ \mu_0 (\{x \in U_m : \Theta^{*\mu_0}(\mu,x) = \infty \}) = 0. \]
    Since $X = \bigcup_{m=1}^\infty U_m$, by countable subadditivity of $\mu_0$ we have
    \[ \mu_0 (\{x \in X : \Theta^{*\mu_0}(\mu,x) = \infty \}) \leq \sum_{m=1}^\infty \mu_0 (\{x \in U_m : \Theta^{*\mu_0}(\mu,x) = \infty \}) = 0. \]
    <span class="proof-end">‚ñ°</span>
  </div>
</div></p>
<div class="theorem-box theorem-box" id="thm:upper_density_theorem_general">
  <div class="theorem-header"><strong>Theorem ?</strong> (General Upper Density Theorem)</div>
  <div class="theorem-content">Let $\mu$ and $\mu_0$ be Borel regular outer measures on $X$, and assume that $(X,\mu_0)$ is open $\sigma$-finite and that $\mu_0$ has the symmetric Vitali property.
    If $A \subseteq X$ is a $\mu$-measurable set with $\mu(A) < \infty$, then 
    \[ \Theta^{*\mu_0}(\mu\mres A,x) = 0 \]
    for $\mu_0$-almost every $x \in X\setminus A$.</div>
</div>
<div class="proof-box collapsed" data-proof-id="proof-num-11">
  <div class="proof-header">
    <button class="proof-toggle" onclick="toggleProof('proof-num-11')" aria-expanded="false">
      <span class="proof-toggle-icon">‚ñº</span>
      <strong>Proof</strong>
    </button>
  </div>
  <div class="proof-content" id="proof-num-11">
    Assume that $A \subseteq X$ is a $\mu$-measurable set with $\mu(A) < \infty$.
<p>Let $t \geq 0$ and define
    \[ E_t := \{ x \in X\setminus A : \Theta^{*\mu_0}(\mu\mres A,x) > t \} \]
    and let $C \subseteq A$ be an arbitrary closed subset.
    Since $X \setminus C$ is open and
    \[ E_t \subset X \setminus A \subset X\setminus C \]
    we see that
    \[ \Theta^{*\mu_0}(\mu\mres(A\cap(X\setminus C))) = \Theta^{*\mu_0}(\mu\mres A,x) \geq t \]
    for each $x \in E_t$.
    By the General Comparison Lemma <span class="ref-unknown" title="Reference not found: lem:comparison_lemma_general">[lem:comparison_lemma_general?]</span>, we have
    \[ t\mu_0(E_t) \leq \mu\mres(A\cap(X\setminus C))(E_t) \leq \mu(A\setminus C) \]
    and we note that this holds for each closed subset $C \subseteq A$.</p>
<p>Sincce $\mu$ is Borel regular, there is a sequence of closed sets $\{ C_j \}_{j=1}^\infty$ such that $C_j \subseteq A$ for each $j \in \Z^+$ and
    \[ \lim_{j\to\infty} \mu(C_j) = \mu(A). \]
    Thus
    \[ t \mu_0(E_t) \leq \lim_{j\to\infty} \mu(A \setminus C_j) = \mu(A) - \lim_{j\to\infty}\mu(C_j) = 0. \]</p>
<p>Since $t \geq 0$ was arbitrary, we conclude that \[ \mu_0(E_t) = 0 \qquad\forall \, t>0. \]
    Thus
    \[ \mu_0( \{ x \in X\setminus A : \Theta^{*\mu_0}(\mu\mres A,x) > 0 \}) = \mu_0\left( \bigcup_{n=1}^\infty E_{1/n} \right) \leq \sum_{n=1}^\infty \mu_0(E_{1/n}) = 0 \]
    and hence
    \[ \Theta^{*\mu_0}(\mu\mres A,x) = 0 \]
    for $\mu_0$-almost every $x \in X\setminus A$.
    <span class="proof-end">‚ñ°</span>
  </div>
</div></p>
<p>We come to the final result in this section.</p>
<div class="theorem-box theorem-box" id="thm:density_theorem_general">
  <div class="theorem-header"><strong>Theorem ?</strong> (General Density Theorem)</div>
  <div class="theorem-content">Let $\mu$ be a Borel regular outer measure on $X$ which is open $\sigma$-finite and has the symmetric Vitali property.
    Then for each $\mu$-measurable set $A \subseteq X$, we have
    \[ \lim_{r\to 0^+} \frac{\mu(\overline{B}(x,r) \cap A)}{\mu(\overline{B}(x,r))} = \begin{cases}
        1, & \text{ for } \mu\text{-almost every } x \in A, \\
        0, & \text{ for } \mu\text{-almost every } x \in X\setminus A.
    \end{cases} \]</div>
</div>
<div class="proof-box collapsed" data-proof-id="proof-num-12">
  <div class="proof-header">
    <button class="proof-toggle" onclick="toggleProof('proof-num-12')" aria-expanded="false">
      <span class="proof-toggle-icon">‚ñº</span>
      <strong>Proof</strong>
    </button>
  </div>
  <div class="proof-content" id="proof-num-12">
    Letting $U_{\mu}$ be the set 
    \[ U_{\mu} = \{ x\in X : \mu(\overline{B}(x,r))=0 \text{ for some } r > 0 \} \]
    we see that by Exercise <span class="ref-unknown" title="Reference not found: ex:measure_of_set_where_measure_vanishes_is_zero">[ex:measure_of_set_where_measure_vanishes_is_zero?]</span>, we have $\mu(U_{\mu}) = 0$.
<p>We assume first that $\mu(X) < \infty$, and let $A \subseteq X$ be a $\mu$-measurable set.
    For each $x \in X\setminus U_{\mu}$, since $A$ is $\mu$-measurable we have
    \[ \mu(\overline{B}(x,r)) = \mu(\overline{B}(x,r) \cap A) + \mu(\overline{B}(x,r) \setminus A) \qquad \forall\, r > 0 \]
    which implies that
    \[ 1 = \frac{\mu(\overline{B}(x,r))}{\mu(\overline{B}(x,r))} = \frac{\mu(\overline{B}(x,r) \cap A)}{\mu(\overline{B}(x,r))} + \frac{\mu(\overline{B}(x,r) \setminus A)}{\mu(\overline{B}(x,r))} \]
    for all $r > 0$.</p>
<p>Taking the limit superior as $r \to 0^+$, the General Upper Density Theorem <span class="ref-unknown" title="Reference not found: thm:upper_density_theorem_general">[thm:upper_density_theorem_general?]</span> implies that the first term on the right converges to $0$ for $\mu$-almost every $x \in X\setminus A$ and the second term converges to $0$ for $\mu$-almost every $x \in A$.
    That is,
    \[ 1 = 0 + \Theta^{*\mu}(\mu\mres(X\setminus A),x) \qquad\text{ for $\mu$-a.e. } x \in X\setminus A \]
    and
    \[ 1 = \Theta^{*\mu}(\mu\mres A,x) + 0 \qquad\text{ for $\mu$-a.e. } x \in A. \]
    Thus the limit defining the density
    \[ \Theta^{\mu}(\mu,A,x) := \lim_{r\to 0^+} \frac{\mu(\overline{B}(x,r) \cap A)}{\mu(\overline{B}(x,r))} \]
    exists for $\mu$-almost every $x \in X$, and the desired equalities hold.</p>
<p><div style="margin: 1em 0;"></div></p>
<p>Removing the assumption that $\mu(X) < \infty$, we assume instead that $\mu$ is open $\sigma$-finite.
    Then there exists a countable collection of open sets $\{ U_k \}_{k=1}^\infty$ such that $X = \bigcup_{k=1}^\infty U_k$ and $\mu(U_k) < \infty$ for each $k \in \Z^+$.
    For each $k \in \Z^+$, by the previous case we have
    \[ \Theta^{\mu}(\mu\mres U_k,x) = \begin{cases}
        1, & \text{ for } \mu\text{-almost every } x \in A\cap U_k, \\
        0, & \text{ for } \mu\text{-almost every } x \in U_k\setminus A.
    \end{cases} \]
    Since $X = \bigcup_{k=1}^\infty U_k$, we know that
    \[ \Theta^{\mu}(\mu,A,x) = \begin{cases}
        1, & \text{ for } \mu\text{-almost every } x \in A, \\
        0, & \text{ for } \mu\text{-almost every } x \in X\setminus A.
    \end{cases} \]
    <span class="proof-end">‚ñ°</span>
  </div>
</div></p>
    </main>
  </div>
  
  <script>
    function toggleChapter(element) {
      element.parentElement.classList.toggle('expanded');
    }
    
    // Highlight current page in sidebar
    document.addEventListener('DOMContentLoaded', () => {
      const currentPath = window.location.pathname;
      const links = document.querySelectorAll('.section-link');
      links.forEach(link => {
        if (currentPath.endsWith(link.getAttribute('href').split('/').pop())) {
          link.classList.add('active');
          // Expand parent chapter
          const group = link.closest('.chapter-group');
          if (group) group.classList.add('expanded');
        }
      });
    });
    
    window.addEventListener('DOMContentLoaded', () => {
      console.log('Restoring proof collapse states...');
      try {
        const openProofs = JSON.parse(localStorage.getItem('openProofs') || '{}');
        const currentPage = window.location.pathname;
        const pageOpen = openProofs[currentPage] || [];
        
        console.log('Current page:', currentPage);
        console.log('Open proof IDs stored:', pageOpen);
        console.log('Found ' + pageOpen.length + ' open proofs for this page');
        
        document.querySelectorAll('.proof-box').forEach(box => {
          const proofId = box.getAttribute('data-proof-id');
          console.log('Checking proof:', proofId, 'Should be open:', pageOpen.includes(proofId));
          if (pageOpen.includes(proofId)) {
            box.classList.remove('collapsed');
            const button = box.querySelector('.proof-toggle');
            button.setAttribute('aria-expanded', 'true');
          } else {
            box.classList.add('collapsed');
            const button = box.querySelector('.proof-toggle');
            button.setAttribute('aria-expanded', 'false');
          }
        });
        
        const openBoxes = JSON.parse(localStorage.getItem('openBoxes') || '{}');
        const pageBoxes = openBoxes[currentPage] || [];
        
        console.log('Open box IDs stored:', pageBoxes);
        
        document.querySelectorAll('.collapsible-box').forEach(box => {
          const boxId = box.getAttribute('data-collapsible-id');
          console.log('Checking box:', boxId, 'Should be open:', pageBoxes.includes(boxId));
          if (pageBoxes.includes(boxId)) {
            box.classList.remove('collapsed');
          } else {
            box.classList.add('collapsed');
          }
        });
        
        console.log('Proof states restored');
      } catch (e) {
        console.error('Error restoring collapse state:', e);
      }
    });
    
    function toggleProof(proofId) {
      const proofContent = document.getElementById(proofId);
      const proofBox = proofContent.closest('.proof-box');
      proofBox.classList.toggle('collapsed');
      
      const button = proofBox.querySelector('.proof-toggle');
      button.setAttribute('aria-expanded', !proofBox.classList.contains('collapsed'));
      
      saveProofState();
    }
    
    function toggleSubproof(subproofId) {
      const subproofContent = document.getElementById(subproofId);
      const subproof = subproofContent.closest('.subproof');
      subproof.classList.toggle('collapsed');
      
      const button = subproof.querySelector('.subproof-toggle');
      button.setAttribute('aria-expanded', !subproof.classList.contains('collapsed'));
    }
    
    function saveProofState() {
      try {
        const currentPage = window.location.pathname;
        const openProofs = JSON.parse(localStorage.getItem('openProofs') || '{}');
        if (!openProofs[currentPage]) {
          openProofs[currentPage] = [];
        }
        
        openProofs[currentPage] = [];
        document.querySelectorAll('.proof-box:not(.collapsed)').forEach(box => {
          const proofId = box.getAttribute('data-proof-id');
          if (proofId) {
            openProofs[currentPage].push(proofId);
          }
        });
        
        localStorage.setItem('openProofs', JSON.stringify(openProofs));
        console.log('Saved proof state (open proofs):', openProofs[currentPage]);
      } catch (e) {
        console.error('Error saving collapse state:', e);
      }
    }
    
    function toggleCollapsible(collapsibleId) {
      const content = document.getElementById(collapsibleId);
      const box = content.closest('.collapsible-box');
      box.classList.toggle('collapsed');
      
      saveCollapsibleState();
    }
    
    function saveCollapsibleState() {
      try {
        const currentPage = window.location.pathname;
        const openBoxes = JSON.parse(localStorage.getItem('openBoxes') || '{}');
        if (!openBoxes[currentPage]) {
          openBoxes[currentPage] = [];
        }
        
        openBoxes[currentPage] = [];
        document.querySelectorAll('.collapsible-box:not(.collapsed)').forEach(box => {
          const boxId = box.getAttribute('data-collapsible-id');
          if (boxId) {
            openBoxes[currentPage].push(boxId);
          }
        });
        
        localStorage.setItem('openBoxes', JSON.stringify(openBoxes));
      } catch (e) {
        console.error('Error saving box state:', e);
      }
    }
    
    document.addEventListener('keydown', (e) => {
      if (e.key === 'p' && e.ctrlKey) {
        e.preventDefault();
        const proofBoxes = document.querySelectorAll('.proof-box');
        const anyExpanded = Array.from(proofBoxes).some(box => !box.classList.contains('collapsed'));
        
        proofBoxes.forEach(box => {
          if (anyExpanded) {
            box.classList.add('collapsed');
          } else {
            box.classList.remove('collapsed');
          }
        });
        
        saveProofState();
      }
    });
    
    document.querySelectorAll('a.ref-link').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const targetId = link.getAttribute('href').substring(1);
        const target = document.getElementById(targetId);
        if (target) {
          target.scrollIntoView({ behavior: 'smooth', block: 'center' });
          target.style.background = '#fef3c7';
          target.style.transition = 'background 0.3s ease';
          setTimeout(() => { target.style.background = ''; }, 1500);
        }
      });
    });
  </script>
</body>
</html>