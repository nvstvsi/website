<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BV_on_R</title>
  <script>
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$', '$$'], ['\\[', '\\]']],
      processEscapes: true,
      processEnvironments: true,
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '0.8em',
      packages: {'[+]': ['ams']},
      macros: {
        R: '\\mathbb{R}',
        C: '\\mathbb{C}',
        N: '\\mathbb{N}',
        Z: '\\mathbb{Z}',
        Q: '\\mathbb{Q}',
        E: '\\mathbb{E}',
        F: '\\mathbb{F}',
        S: '\\mathbb{S}',
        H: '\\mathcal{H}',
        L: '\\mathcal{L}',
        dif: '\\,\\mathrm{d}',
        supp: '\\operatorname{supp}',
        proj: '\\operatorname{proj}',
        Id: '\\operatorname{Id}',
        Span: '\\operatorname{span}',
        graph: '\\operatorname{graph}',
        dist: '\\operatorname{dist}',
        diam: '\\operatorname{diam}',
        avg: '\\operatorname{avg}',
        div: '\\operatorname{div}',
        vol: '\\operatorname{vol}',
        ord: '\\operatorname{ord}',
        Chi: '\\mathbf{1}',
        sub: '\\subseteq',
        mres: '\\downharpoonright',
        ddag: '\\ddagger',
        dag: '\\dagger',
        norm: ['\\left\\| #1 \\right\\|', 1],
        abs: ['\\left| #1 \\right|', 1],
        set: ['\\left\\{ #1 \\right\\}', 1],
        inner: ['\\langle #1, #2 \\rangle', 2],
        floor: ['\\lfloor #1 \\rfloor', 1],
        ceil: ['\\lceil #1 \\rceil', 1],
        bigskull: '\\unicode{x1F480}',
        skull: '\\unicode{x2620}',
        mathwitch: '\\unicode{x1F9D9}',
        pumpkin: '\\unicode{x1F383}',
        mathpumpkin: '\\unicode{x1F383}',
        bigpumpkin: '\\unicode{x1F383}',
        mathghost: '\\unicode{x1F47B}',
        mathcat: '\\unicode{x1F408}',
        mathbat: '\\unicode{x1F987}',
        esssup: '\\operatorname{ess\\,sup}',
        essinf: '\\operatorname{ess\\,inf}',
        Lip: '\\operatorname{Lip}',
        pd: ['\\frac{\\partial#1}{\\partial#2}', 2],
        od: ['\\frac{\\mathrm{d}#1}{\\mathrm{d}#2}', 2],
        dashint: '\\mathchoice{\\rlap{-}\\!\\int}{\\rlap{\\raise.15ex\\hbox{\\smash{\\scriptscriptstyle-}}}\\int}{\\rlap{\\raise.09ex\\hbox{\\smash{\\scriptscriptstyle-}}}\\int}{\\rlap{\\raise.09ex\\hbox{\\smash{\\scriptscriptstyle-}}}\\int}'
      }
    },
    startup: {
      pageReady: () => {
        return MathJax.startup.defaultPageReady().then(() => {
          console.log('MathJax ready');
        });
      }
    }
  };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" id="MathJax-script"></script>
  <script>
  // Auto-reload when watch.js signals a rebuild
  (function() {
    // Save state before unload
    window.addEventListener('beforeunload', function() {
      saveProofState();
      saveCollapsibleState();
    });
    
    const eventSource = new EventSource('http://localhost:35729/reload-stream');
    
    eventSource.onmessage = function(event) {
      if (event.data === 'reload') {
        console.log('üìù File updated, saving state and reloading...');
        // Save state before reload
        saveProofState();
        saveCollapsibleState();
        // Small delay to ensure localStorage flush
        setTimeout(() => {
          window.location.reload();
        }, 50);
      }
    };
    
    eventSource.onerror = function() {
      console.log('‚ö†Ô∏è  Auto-reload server not available. Run node watch.js to enable auto-reload.');
      eventSource.close();
    };
    
    console.log('üîÑ Auto-reload enabled');
  })();
  </script>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: Georgia, "Times New Roman", serif;
      font-size: 16px;
      line-height: 1.7;
      max-width: 900px;
      margin: 0 auto;
      padding: 40px 20px;
      color: #1a1a1a;
      background: #ffffff;
    }
    h2, h3, h4 {
      margin-top: 2em;
      margin-bottom: 0.75em;
      color: #000;
      font-weight: 600;
    }
    h2 { font-size: 1.5em; border-bottom: 1px solid #e0e0e0; padding-bottom: 0.3em; }
    h3 { font-size: 1.25em; }
    h4 { font-size: 1.1em; }
    p {
      margin: 1em 0;
      text-indent: 2em;
    }
    p:first-of-type,
    h2 + p,
    h3 + p,
    h4 + p,
    .theorem-box + p,
    .proof-box + p {
      text-indent: 0;
    }
    .noindent + p,
    p:has(> .noindent:first-child) {
      text-indent: 0 !important;
    }
    .noindent {
      display: none;
    }
    .theorem-box {
      margin: 1.75em 0;
      padding: 1.25em;
      border-left: 5px solid #16a34a;
      background: linear-gradient(to top, #bbf7d0 0%, #d1fae5 100%);
      border-radius: 6px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }
    .definition-box { border-left-color: #16a34a; background: linear-gradient(to top, #d1fae5 0%, #ecfdf5 100%); }
    .lemma-box { border-left-color: #1e3a8a; background: linear-gradient(to top, #bfdbfe 0%, #dbeafe 100%); }
    .corollary-box { border-left-color: #9333ea; background: linear-gradient(to top, #e9d5ff 0%, #f3e8ff 100%); }
    .proposition-box { border-left-color: #dc2626; background: linear-gradient(to top, #fecaca 0%, #fee2e2 100%); }
    .remark-box { border-left-color: #64748b; background: linear-gradient(to top, #e2e8f0 0%, #f1f5f9 100%); }
    .example-box { border-left-color: #0891b2; background: linear-gradient(to top, #a5f3fc 0%, #cffafe 100%); }
    .construction-box { border-left-color: #ea580c; background: linear-gradient(to top, #fed7aa 0%, #ffedd5 100%); }
    .notation-box { border-left-color: #ca8a04; background: linear-gradient(to top, #fef08a 0%, #fef9c3 100%); }
    .exercise-box { border-left-color: #ea580c; background: linear-gradient(to top, #fed7aa 0%, #ffedd5 100%); }
    .problem-box { border-left-color: #ec4899; background: linear-gradient(to top, #fbcfe8 0%, #fce7f3 100%); }
    .theorem-header {
      margin-bottom: 0.75em;
      font-size: 1.05em;
      font-weight: 600;
    }
    .theorem-header.clickable {
      cursor: pointer;
      user-select: none;
    }
    .theorem-header.clickable:hover {
      background: rgba(0,0,0,0.03);
      margin: -0.5em -0.75em 0.75em -0.75em;
      padding: 0.5em 0.75em;
      border-radius: 4px;
    }
    .collapsible-icon {
      display: inline-block;
      transition: transform 0.2s ease;
      font-size: 0.75em;
      margin-right: 0.5em;
      color: #6b7280;
    }
    .collapsible-box.collapsed .collapsible-icon {
      transform: rotate(-90deg);
    }
    .collapsible-content {
      transition: max-height 0.3s ease;
      overflow: hidden;
    }
    .collapsible-box.collapsed .collapsible-content {
      display: none;
    }
    .theorem-content {
      padding-left: 0.5em;
      line-height: 1.8;
    }
    .proof-box {
      margin: 1.5em 0;
      border: 1px solid #e5e7eb;
      border-radius: 6px;
      background: white;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }
    .proof-header {
      position: sticky;
      top: 0;
      background: linear-gradient(to bottom, #fafafa 0%, #f5f5f5 100%);
      border-bottom: 1px solid #e5e7eb;
      z-index: 100;
      border-radius: 6px 6px 0 0;
    }
    .proof-toggle {
      width: 100%;
      padding: 0.85em 1.25em;
      border: none;
      background: transparent;
      text-align: left;
      cursor: pointer;
      font-family: inherit;
      font-size: 1em;
      display: flex;
      align-items: center;
      gap: 0.75em;
      transition: background 0.15s;
    }
    .proof-toggle:hover { background: rgba(0,0,0,0.03); }
    .proof-toggle-icon {
      display: inline-block;
      transition: transform 0.2s ease;
      font-size: 0.75em;
      color: #6b7280;
    }
    .proof-box.collapsed .proof-toggle-icon {
      transform: rotate(-90deg);
    }
    .proof-content {
      padding: 1.25em;
      line-height: 1.8;
    }
    .proof-box.collapsed .proof-content {
      display: none;
    }
    .proof-end {
      float: right;
      font-size: 1.3em;
      margin-left: 0.5em;
      color: #374151;
    }
    .subproof {
      margin: 1em 0;
      border: 1px solid #d1d5db;
      border-radius: 4px;
      background: #f9fafb;
    }
    .subproof-header {
      background: linear-gradient(to bottom, #f9fafb 0%, #f3f4f6 100%);
      border-bottom: 1px solid #d1d5db;
      border-radius: 4px 4px 0 0;
    }
    .subproof-toggle {
      width: 100%;
      padding: 0.6em 1em;
      border: none;
      background: transparent;
      text-align: left;
      cursor: pointer;
      font-family: inherit;
      font-size: 0.95em;
      display: flex;
      align-items: center;
      gap: 0.5em;
      transition: background 0.15s;
    }
    .subproof-toggle:hover {
      background: rgba(0,0,0,0.03);
    }
    .subproof-toggle-icon {
      display: inline-block;
      transition: transform 0.2s ease;
      font-size: 0.7em;
      color: #6b7280;
    }
    .subproof.collapsed .subproof-toggle-icon {
      transform: rotate(-90deg);
    }
    .subproof-content {
      padding: 1em;
      line-height: 1.7;
    }
    .subproof.collapsed .subproof-content {
      display: none;
    }
    .ref-link {
      color: #2563eb;
      text-decoration: none;
      font-weight: 500;
      padding: 0 0.15em;
      border-radius: 2px;
    }
    .ref-link:hover {
      background: #dbeafe;
      text-decoration: underline;
    }
    .ref-unknown {
      color: #dc2626;
      font-weight: bold;
      background: #fee2e2;
      padding: 0.1em 0.3em;
      border-radius: 3px;
    }
    strong { font-weight: 600; }
    em { font-style: italic; }
    ol, ul {
      margin: 1em 0;
      padding-left: 2.5em;
      line-height: 1.8;
    }
    li {
      margin: 0.5em 0;
    }
    .latex-image {
      max-width: 100%;
      height: auto;
      display: block;
      margin: 1.5em auto;
    }
    .latex-figure .latex-image {
      display: inline-block;
      margin: 0.5em;
      vertical-align: middle;
    }
    .latex-figure {
      margin: 2em 0;
      text-align: center;
      line-height: 0;
    }
    .latex-figure .figure-content {
      margin-bottom: 0.75em;
      line-height: normal;
    }
    .latex-figure .figure-content > * {
      vertical-align: middle;
    }
    .latex-figure figcaption {
      font-size: 0.9em;
      color: #4b5563;
      font-style: italic;
      margin-top: 0.5em;
    }
  </style>
</head>
<body>
  <h2>Functions of Bounded Variation on $\R$</h2>
<p><span class="noindent"></span>In this section, we study functions of bounded variation on $\R$, and absolutely continuous functions on $\R$.</p>
<p>In this section $[a,b]$ will always denote a closed, bounded interval in $\R$ with $a < b$.</p>
<div class="theorem-box definition-box" id="def:BV_on_interval">
  <div class="theorem-header"><strong>Definition ?</strong> (Total Variation, Bounded Variation)</div>
  <div class="theorem-content">Let $f:[a,b]\to \R$ be a function.
    For each partition $P = \{ a = x_0 < x_1 < \cdots < x_N = b \}$ of $[a,b]$, we define the <em>total variation</em> of $f$ with respect to the partition $P$ to be
    \[ V(f,P) := \sum_{k=1}^N |f(x_k) - f(x_{k-1})|. \]
    The <em>total variation</em> of $f$ on $[a,b]$ is
    \[ V_a^b(f) := \sup \{ V(f,P) : P \text{ is a partition of } [a,b] \} \in [0,\infty]. \]
    If $[c,d] \subseteq [a,b]$ is a subinterval, then $V_c^d(f)$ is the total variation of the restriction $f|_{[c,d]}$.
<p><div style="margin: 1em 0;"></div></p>
<p><span class="noindent"></span>We say that $f$ is of <em>bounded variation</em> on $[a,b]$ if $V_a^b(f) < \infty$.</p>
<p><div style="margin: 1em 0;"></div></p>
<p><span class="noindent"></span>The set of all functions of bounded variation on $[a,b]$ is denoted by $BV([a,b])$.</div>
</div></p>
<div class="theorem-box remark-box collapsible-box collapsed" id="rem:BV_functions_on_a_closed_bounded_interval_are_bounded" data-collapsible-id="collapsible-rem:BV_functions_on_a_closed_bounded_interval_are_bounded">
  <div class="theorem-header clickable" onclick="toggleCollapsible('collapsible-rem:BV_functions_on_a_closed_bounded_interval_are_bounded')">
    <span class="collapsible-icon">‚ñº</span>
    <strong>Remark ?</strong> (BV Functions on a Closed, Bounded Interval are Bounded)
  </div>
  <div class="theorem-content collapsible-content" id="collapsible-rem:BV_functions_on_a_closed_bounded_interval_are_bounded">If $f:[a,b]\to\R$ is of bounded variation on $[a,b]$, then $f$ is bounded.
<p>The proof is easy.
    For each $x \in [a,b]$ we consider the partition $P = \{ a, x, b \}$ of $[a,b]$.
    Then we have
    \[ V(f,P) = |f(x) - f(a)| + |f(b) - f(x)| \leq V_a^b(f) < \infty \]
    which implies that
    \[ |f(x)| \leq |f(x) - f(a)| + |f(a)| \leq |f(x) - f(a)| + |f(b) - f(x)| + |f(a)| \leq V_a^b(f) + |f(a)|. \]
    Thus $f$ is bounded above by $V_a^b(f) + |f(a)|$ on $[a,b]$.</div>
</div></p>
<div class="theorem-box remark-box collapsible-box collapsed" id="rem:BV_on_R" data-collapsible-id="collapsible-rem:BV_on_R">
  <div class="theorem-header clickable" onclick="toggleCollapsible('collapsible-rem:BV_on_R')">
    <span class="collapsible-icon">‚ñº</span>
    <strong>Remark ?</strong> (Functions of Bounded Variation on $\R$)
  </div>
  <div class="theorem-content collapsible-content" id="collapsible-rem:BV_on_R">We say that a function $f:\R\to\R$ is of bounded variation on $\R$ if it is of bounded variation on every closed, bounded interval $[a,b] \subseteq \R$ and 
    \[ \sup_{ \substack{ a ,b \in \R \\ a < b } } V_a^b(f) < \infty. \]
    This supremum is called the total variation of $f$ on $\R$ and is denoted by $V_{-\infty}^\infty(f)$.
<p><div style="margin: 1em 0;"></div></p>
<p><span class="noindent"></span>The set of all functions of bounded variation on $\R$ is denoted by $BV(\R)$.</div>
</div></p>
<div class="theorem-box example-box collapsible-box collapsed" id="ex:increasing_functions_are_BV" data-collapsible-id="collapsible-ex:increasing_functions_are_BV">
  <div class="theorem-header clickable" onclick="toggleCollapsible('collapsible-ex:increasing_functions_are_BV')">
    <span class="collapsible-icon">‚ñº</span>
    <strong>Example ?</strong> (Increasing Functions are BV)
  </div>
  <div class="theorem-content collapsible-content" id="collapsible-ex:increasing_functions_are_BV">If $f:[a,b]\to\R$ is increasing, then for each partition $P = \{ a = x_0 < x_1 < \cdots < x_N = b \}$ of $[a,b]$, we have
    \[ V(f,P) = \sum_{k=1}^N |f(x_k) - f(x_{k-1})| = \sum_{k=1}^N (f(x_k) - f(x_{k-1})) = f(b) - f(a). \]
    Thus $V_a^b(f) = f(b) - f(a) < \infty$, so $f$ is of bounded variation on $[a,b]$.</div>
</div>
<div class="theorem-box example-box collapsible-box collapsed" id="ex:lipschitz_functions_are_BV" data-collapsible-id="collapsible-ex:lipschitz_functions_are_BV">
  <div class="theorem-header clickable" onclick="toggleCollapsible('collapsible-ex:lipschitz_functions_are_BV')">
    <span class="collapsible-icon">‚ñº</span>
    <strong>Example ?</strong> (Lipschitz Functions are BV)
  </div>
  <div class="theorem-content collapsible-content" id="collapsible-ex:lipschitz_functions_are_BV">If $f:[a,b]\to\R$ is Lipschitz with Lipschitz constant $L > 0$, then for each partition $P = \{ a = x_0 < x_1 < \cdots < x_N = b \}$ of $[a,b]$, we have
    \[ V(f,P) = \sum_{k=1}^N |f(x_k) - f(x_{k-1})| \leq \sum_{k=1}^N L |x_k - x_{k-1}| = L(b-a). \]
    Thus $V_a^b(f) \leq L(b-a) < \infty$, so $f$ is of bounded variation on $[a,b]$.</div>
</div>
<div class="theorem-box example-box collapsible-box collapsed" id="ex:differences_of_increasing_functions_are_BV" data-collapsible-id="collapsible-ex:differences_of_increasing_functions_are_BV">
  <div class="theorem-header clickable" onclick="toggleCollapsible('collapsible-ex:differences_of_increasing_functions_are_BV')">
    <span class="collapsible-icon">‚ñº</span>
    <strong>Example ?</strong> (Differences of Increasing Functions are BV)
  </div>
  <div class="theorem-content collapsible-content" id="collapsible-ex:differences_of_increasing_functions_are_BV">If $f,g:[a,b]\to\R$ are increasing functions, then for each partition $P = \{ a = x_0 < x_1 < \cdots < x_N = b \}$ of $[a,b]$, we have
    \begin{align*}
        V(f-g,P) &= \sum_{k=1}^N |(f-g)(x_k) - (f-g)(x_{k-1})| \\
            &= \sum_{k=1}^N |(f(x_k) - f(x_{k-1})) - (g(x_k) - g(x_{k-1}))| \\
            &\leq \sum_{k=1}^N |f(x_k) - f(x_{k-1})| + \sum_{k=1}^N |g(x_k) - g(x_{k-1})| \\
            &= V(f,P) + V(g,P).
    \end{align*}
    Taking the supremum over all partitions $P$ of $[a,b]$ gives
    \[ V_a^b(f-g) \leq V_a^b(f) + V_a^b(g) < \infty, \]
    so $f-g$ is of bounded variation on $[a,b]$.</div>
</div>
<div class="theorem-box example-box collapsible-box collapsed" id="ex:function_of_unbounded_variation" data-collapsible-id="collapsible-ex:function_of_unbounded_variation">
  <div class="theorem-header clickable" onclick="toggleCollapsible('collapsible-ex:function_of_unbounded_variation')">
    <span class="collapsible-icon">‚ñº</span>
    <strong>Example ?</strong> (A Function of Unbounded Variation)
  </div>
  <div class="theorem-content collapsible-content" id="collapsible-ex:function_of_unbounded_variation">The function ...</div>
</div>
<div class="theorem-box exercise-box" id="ex:BV_is_a_vector_space">
  <div class="theorem-header"><strong>Exercise ?</strong> ($BV$ is a Vector Space)</div>
  <div class="theorem-content">Let $[a,b]$ be a closed, bounded interval in $\R$ with $a < b$.
    Then $BV([a,b])$ is a vector space over $\R$.
    Also $BV(\R)$ is closed under products.</div>
</div>
<div class="proof-box collapsed" data-proof-id="proof-num-0">
  <div class="proof-header">
    <button class="proof-toggle" onclick="toggleProof('proof-num-0')" aria-expanded="false">
      <span class="proof-toggle-icon">‚ñº</span>
      <strong>Proof</strong>
    </button>
  </div>
  <div class="proof-content" id="proof-num-0">
    First it is obvious that the zero function is in $BV([a,b])$ since $V_a^b(0) = 0 < \infty$.
    Now let $f,g\in BV([a,b])$ and let $\alpha\in\R$.
    We need to show that $f+g$ and $\alpha f$ are in $BV([a,b])$.
<p>Let $P = \{ a = x_0 < x_1 < \cdots < x_N = b \}$ be a partition of $[a,b]$.
    Then we have
    \begin{align*}
        V(f+g,P) &= \sum_{k=1}^N |(f+g)(x_k) - (f+g)(x_{k-1})| \\
            &= \sum_{k=1}^N |(f(x_k) - f(x_{k-1})) + (g(x_k) - g(x_{k-1}))| \\
            &\leq \sum_{k=1}^N |f(x_k) - f(x_{k-1})| + \sum_{k=1}^N |g(x_k) - g(x_{k-1})| \\
            &= V(f,P) + V(g,P)
    \end{align*}
    by the triangle inequality.
    Taking the supremum over all partitions $P$ of $[a,b]$ gives
    \[ V_a^b(f+g) \leq V_a^b(f) + V_a^b(g) < \infty, \]
    so $f+g$ is in $BV([a,b])$.</p>
<p>Now let $P = \{ a = x_0 < x_1 < \cdots < x_N = b \}$ be a partition of $[a,b]$.
    Then we have
    \begin{align*}
        V(\alpha f,P) &= \sum_{k=1}^N |\alpha f(x_k) - \alpha f(x_{k-1})| \\
            &= \sum_{k=1}^N |\alpha| |f(x_k) - f(x_{k-1})| \\
            &= |\alpha| V(f,P).
    \end{align*}
    Taking the supremum over all partitions $P$ of $[a,b]$ gives
    \[ V_a^b(\alpha f) = |\alpha| V_a^b(f) < \infty, \]
    so $\alpha f$ is in $BV([a,b])$.</p>
<p>This shows that $BV([a,b])$ is closed under addition and scalar multiplication, and so $BV([a,b])$ is a vector space over $\R$.</p>
<p><div style="margin: 1em 0;"></div></p>
<p>To see that $BV([a,b])$ is closed under products, let $f,g\in BV([a,b])$.
    Not that both $f$ and $g$ are bounded on $[a,b]$ since for each $x\in[a,b]$ we have
    \[ |f(x)| \leq |f(x) - f(a)| + |f(a)| \leq V_a^b(f) + |f(a)| < \infty \]
    and similarly for $g$.
    Thus 
    \[ \sup_{x\in[a,b]} |f(x)| \leq V_a^b(f) + |f(a)| < \infty \quad \text{and} \quad \sup_{x\in[a,b]} |g(x)| \leq V_a^b(g) + |g(a)| < \infty. \]</p>
<p>Let $P = \{ a = x_0 < x_1 < \cdots < x_N = b \}$ be a partition of $[a,b]$.
    Then we have
    \begin{align*}
        V(fg,P) &= \sum_{k=1}^N |(fg)(x_k) - (fg)(x_{k-1})| \\
            &= \sum_{k=1}^N |f(x_k)g(x_k) - f(x_{k-1})g(x_{k-1})| \\
            &= \sum_{k=1}^N |f(x_k)g(x_k) - f(x_k)g(x_{k-1}) + f(x_k)g(x_{k-1}) - f(x_{k-1})g(x_{k-1})| \\
            &\leq \sum_{k=1}^N |f(x_k)| |g(x_k) - g(x_{k-1})| + \sum_{k=1}^N |g(x_{k-1})| |f(x_k) - f(x_{k-1})| &&\text{by the triangle inequality}\\
            &\leq \left( \sup_{x\in[a,b]} |f(x)| \right) V(g,P) + \left( \sup_{x\in[a,b]} |g(x)| \right) V(f,P). \\
    \end{align*}
    Taking the supremum over all partitions $P$ of $[a,b]$ gives
    \[ V_a^b(fg) \leq \left( \sup_{x\in[a,b]} |f(x)| \right) V_a^b(g) + \left( \sup_{x\in[a,b]} |g(x)| \right) V_a^b(f) < \infty, \]
    so $fg$ is in $BV([a,b])$.</p>
<p>This shows that $BV([a,b])$ is closed under products.
    <span class="proof-end">‚ñ°</span>
  </div>
</div></p>
<div class="theorem-box proposition-box" id="prop:additivity_of_total_variation">
  <div class="theorem-header"><strong>Proposition ?</strong> (Additivity of Total Variation)</div>
  <div class="theorem-content">Let $f:[a,b]\to\R$ be a function and let $c\in (a,b)$. Then
    \[ V_a^b(f) = V_a^c(f) + V_c^b(f). \]</div>
</div>
<div class="proof-box collapsed" data-proof-id="proof-num-1">
  <div class="proof-header">
    <button class="proof-toggle" onclick="toggleProof('proof-num-1')" aria-expanded="false">
      <span class="proof-toggle-icon">‚ñº</span>
      <strong>Proof</strong>
    </button>
  </div>
  <div class="proof-content" id="proof-num-1">
    <em>Step 1:</em> We show that if $P$ is a partition of $[a,b]$ and $P'$ is a refinement of $P$ obtained by adding the point $c$ to $P$, then
    \[ V(f,P) \leq V(f,P'). \]
<p>Let $P = \{ a = x_0 < x_1 < \cdots < x_N = b \}$ be a partition of $[a,b]$, and suppose that $x_{j-1} < c < x_j$ for some $j\in\{1,2,\ldots,N\}$.
    Then the refinement $P'$ of $P$ obtained by adding the point $c$ is given by the points
    \[ a = x_0 < x_1 < \cdots < x_{j-1} < c < x_j < \cdots < x_N = b \]
    and we have
    \begin{align*}
        V(f,P') &= \sum_{k=1}^{j-1} |f(x_k) - f(x_{k-1})| + |f(c) - f(x_{j-1})| + |f(x_j) - f(c)| + \sum_{k=j+1}^N |f(x_k) - f(x_{k-1})| \\
            &\geq \sum_{k=1}^{j-1} |f(x_k) - f(x_{k-1})| + |f(x_j) - f(x_{j-1})| + \sum_{k=j+1}^N |f(x_k) - f(x_{k-1})| \\
            &= V(f,P)
    \end{align*}
    by the triangle inequality.</p>
<p>Thus adding a point to a partition can only increase the total variation with respect to that partition.</p>
<p><div style="margin: 1em 0;"></div>
    <em>Step 2:</em> Let $P_1$ be a partition of $[a,c]$ and let $P_2$ be a partition of $[c,b]$.
    Then the union $P = P_1 \cup P_2$ is a partition of $[a,b]$, and we have
    \[ V(f,P) = V(f,P_1) + V(f,P_2). \]
    Taking the supremum over all partitions $P_1$ of $[a,c]$ and all partitions $P_2$ of $[c,b]$ gives
    \[ V_a^b(f) \geq V_a^c(f) + V_c^b(f). \]
    To see the reverse inequality, let $P$ be a partition of $[a,b]$.
    Whether or not $c$ is in $P$, we can form a refinement $P' := P \cup \{c\}$, and by Step 1 we have
    \[ V(f,P) \leq V(f,P') = V(f,P_1) + V(f,P_2) \leq V_a^c(f) + V_c^b(f) \]
    where $P_1 := P' \cap [a,c]$ is a partition of $[a,c]$ and $P_2 := P' \cap [c,b]$ is a partition of $[c,b]$.
    Taking the supremum over all partitions $P$ of $[a,b]$ gives
    \[ V_a^b(f) \leq V_a^c(f) + V_c^b(f). \]
    Combining the two inequalities gives the desired result.
    <span class="proof-end">‚ñ°</span>
  </div>
</div></p>
<div class="theorem-box corollary-box" id="cor:total_variation_function_is_increasing">
  <div class="theorem-header"><strong>Corollary ?</strong> (Total Variation Function is Increasing)</div>
  <div class="theorem-content">Let $f:[a,b]\to\R$ be a function of bounded variation.
    Then the function
    \[ [a,b] \ni x \longmapsto V_a^x(f) \in [0, V_a^b(f)] \]
    is increasing.</div>
</div>
<div class="proof-box collapsed" data-proof-id="proof-num-2">
  <div class="proof-header">
    <button class="proof-toggle" onclick="toggleProof('proof-num-2')" aria-expanded="false">
      <span class="proof-toggle-icon">‚ñº</span>
      <strong>Proof</strong>
    </button>
  </div>
  <div class="proof-content" id="proof-num-2">
    First of all see that by definition, $V_a^x(f)\geq 0$ for all $x\in[a,b]$.
    Thus the additivity of total variation (Proposition <span class="ref-unknown" title="Reference not found: prop:additivity_of_total_variation">[prop:additivity_of_total_variation?]</span>) implies that $V_a^x(f) \leq V_a^b(f)$ for all $x\in[a,b]$.
<p>Now let $x,y\in[a,b]$ be such that $x < y$.
    Then by the additivity of total variation, we have
    \[ V_a^y(f) - V_a^x(f) = V_x^y(f) \geq 0. \]
    Thus $V_a^x(f) \leq V_a^y(f)$, which shows that the function $x\mapsto V_a^x(f)$ is increasing.
    <span class="proof-end">‚ñ°</span>
  </div>
</div></p>
<div class="theorem-box theorem-box" id="thm:jordan_decomposition">
  <div class="theorem-header"><strong>Theorem ?</strong> (Jordan Decomposition)</div>
  <div class="theorem-content">Let $f:[a,b]\to\R$ be a function.
    Then $f$ is of bounded variation on $[a,b]$ if and only if there exist increasing functions $f_1,f_2:[a,b]\to\R$ such that
    \[ f = f_1 - f_2. \]
    In this case, we can take
    \[ f_1(x) := f(x) + V_a^x(f) \quad\text{and}\quad f_2(x) := V_a^x(f) \]
    which are both increasing functions.</div>
</div>
<div class="proof-box collapsed" data-proof-id="proof-num-3">
  <div class="proof-header">
    <button class="proof-toggle" onclick="toggleProof('proof-num-3')" aria-expanded="false">
      <span class="proof-toggle-icon">‚ñº</span>
      <strong>Proof</strong>
    </button>
  </div>
  <div class="proof-content" id="proof-num-3">
    ($\Rightarrow$) Suppose that $f$ is of bounded variation on $[a,b]$.
    Define the functions $f_1,f_2:[a,b]\to\R$ by 
    \[ f_1(x) := f(x) + V_a^x(f) \quad\text{and}\quad f_2(x) := V_a^x(f) \qquad\forall x\in[a,b]. \]
    By Corollary <span class="ref-unknown" title="Reference not found: cor:total_variation_function_is_increasing">[cor:total_variation_function_is_increasing?]</span>, we know that $f_2$ is increasing.
<p>Now we show that $f_1$ is increasing.
    See that for each $x,y\in[a,b]$ such that $x < y$, we have
    \[ f(x) - f(y) \leq |f(x) - f(y)| = V(f|_{[x,y]},\{x,y\}) \leq V_x^y(f) = V_a^y(f) - V_a^x(f) \]
    which implies that
    \[ V_a^x(f) + f(x) \leq V_a^y(f) + f(y). \]
    That is, $a\leq x < y \leq b$ implies that $f_1(x) \leq f_1(y)$, so $f_1$ is increasing.</p>
<p>For each $x\in[a,b]$ we trivially have $f(x) = f_1(x) - f_2(x)$.</p>
<p>($\Leftarrow$) Suppose that there exist increasing functions $f_1,f_2:[a,b]\to\R$ such that $f = f_1 - f_2$.
    Then by Example <span class="ref-unknown" title="Reference not found: ex:differences_of_increasing_functions_are_BV">[ex:differences_of_increasing_functions_are_BV?]</span>, we see that $f$ is of bounded variation on $[a,b]$.
    <span class="proof-end">‚ñ°</span>
  </div>
</div></p>
<div class="theorem-box corollary-box" id="cor:BV_functions_are_differentiable_a_e">
  <div class="theorem-header"><strong>Corollary ?</strong> (BV Functions are Differentiable a.e.)</div>
  <div class="theorem-content">Let $f:[a,b]\to\R$ be a function of bounded variation.
    Then the derivative $f'$ exists and is finite almost everywhere on $(a,b)$, and $f'$ is integrable.</div>
</div>
<div class="proof-box collapsed" data-proof-id="proof-num-4">
  <div class="proof-header">
    <button class="proof-toggle" onclick="toggleProof('proof-num-4')" aria-expanded="false">
      <span class="proof-toggle-icon">‚ñº</span>
      <strong>Proof</strong>
    </button>
  </div>
  <div class="proof-content" id="proof-num-4">
    Since $f$ is of bounded variation on $[a,b]$, by the Jordan decomposition (Theorem <span class="ref-unknown" title="Reference not found: thm:jordan_decomposition">[thm:jordan_decomposition?]</span>) there exist increasing functions $f_1,f_2:[a,b]\to\R$ such that $f = f_1 - f_2$.
    By Theorem <span class="ref-unknown" title="Reference not found: thm:increasing_functions_are_differentiable_a_e">[thm:increasing_functions_are_differentiable_a_e?]</span>, both $f_1$ and $f_2$ are differentiable almost everywhere on $(a,b)$, and their derivatives $f_1'$ and $f_2'$ are integrable.
    Thus $f' = f_1' - f_2'$ exists and is finite almost everywhere on $(a,b)$, and $f' = f_1' - f_2'$ is integrable.
    <span class="proof-end">‚ñ°</span>
  </div>
</div>
<p>This fact is pretty shocking --- much more so than the fact that monotone functions are differentiable almost everywhere.
In particular, since Lipschitz functions are of bounded variation (Example <span class="ref-unknown" title="Reference not found: ex:lipschitz_functions_are_BV">[ex:lipschitz_functions_are_BV?]</span>), we see that Lipschitz functions are differentiable almost everywhere, which is a very strong regularity property.</p>
<div class="theorem-box exercise-box" id="ex:rademachers_theorem_in_one_dimension">
  <div class="theorem-header"><strong>Exercise ?</strong> (Rademacher's Theorem in One Dimension)</div>
  <div class="theorem-content">Let $I \subseteq \R$ be an interval, and let $f:I\to\R$ be a Lipschitz function.
    Then $f$ is differentiable almost everywhere on $I$.</div>
</div>
<div class="proof-box collapsed" data-proof-id="proof-num-5">
  <div class="proof-header">
    <button class="proof-toggle" onclick="toggleProof('proof-num-5')" aria-expanded="false">
      <span class="proof-toggle-icon">‚ñº</span>
      <strong>Proof</strong>
    </button>
  </div>
  <div class="proof-content" id="proof-num-5">
    Let $I \subseteq \R$ be an interval, and let $f:I\to\R$ be a Lipschitz function.
    If $I$ is closed and bounded, then by Example <span class="ref-unknown" title="Reference not found: ex:lipschitz_functions_are_BV">[ex:lipschitz_functions_are_BV?]</span> and Corollary <span class="ref-unknown" title="Reference not found: cor:BV_functions_are_differentiable_a_e">[cor:BV_functions_are_differentiable_a_e?]</span>, we know that $f$ is differentiable almost everywhere on $I$.
<p>Now suppose that $I$ is not closed and bounded, so is one of the forms
    \[ (-\infty,b),(a,\infty) ,(-\infty,b], [a,\infty), (a,b), [a,b), (a,b], \text{ or } \R. \]
    Then we can write $I$ as a countable union of closed, bounded intervals $\{[a_k,b_k]\}_{k=1}^\infty$ such that $[a_k,b_k] \subseteq I$ for all $k\in\N$.
    For each $k\in\N$, the restriction $f|_{[a_k,b_k]}:[a_k,b_k]\to\R$ is Lipschitz, so by Example <span class="ref-unknown" title="Reference not found: ex:lipschitz_functions_are_BV">[ex:lipschitz_functions_are_BV?]</span> and Corollary <span class="ref-unknown" title="Reference not found: cor:BV_functions_are_differentiable_a_e">[cor:BV_functions_are_differentiable_a_e?]</span>, we know that $f|_{[a_k,b_k]}$ is differentiable almost everywhere on $[a_k,b_k]$.</p>
<p>Thus for each $k\in\N$, there exists a set $N_k \subseteq [a_k,b_k]$ with measure zero such that $f|_{[a_k,b_k]}$ is differentiable at every point in $[a_k,b_k] \setminus N_k$.
    Let
    \[ N := \bigcup_{k=1}^\infty N_k. \]
    Then $N$ has measure zero since it is a countable union of measure zero sets.
    Also if $x\in I \setminus N$, then there exists some $k\in\N$ such that $x\in[a_k,b_k]$, and since $x\notin N$, we have $x\notin N_k$, so $f|_{[a_k,b_k]}$ is differentiable at $x$.
    Thus $f$ is differentiable at every point in $I \setminus N$, which shows that $f$ is differentiable almost everywhere on $I$.
    <span class="proof-end">‚ñ°</span>
  </div>
</div></p>
<div class="theorem-box exercise-box" id="ex:BV_on_R_are_differentiable_a_e">
  <div class="theorem-header"><strong>Exercise ?</strong> (BV Functions on $\R$ are Differentiable a.e.)</div>
  <div class="theorem-content">Every function of bounded variatin on $\R$ is differentiable almost everywhere.</div>
</div>
<div class="proof-box collapsed" data-proof-id="proof-num-6">
  <div class="proof-header">
    <button class="proof-toggle" onclick="toggleProof('proof-num-6')" aria-expanded="false">
      <span class="proof-toggle-icon">‚ñº</span>
      <strong>Proof</strong>
    </button>
  </div>
  <div class="proof-content" id="proof-num-6">
    Let $f:\R\to\R$ be a function of bounded variation on $\R$.
    Then by Remark <span class="ref-unknown" title="Reference not found: rem:BV_on_R">[rem:BV_on_R?]</span>, we know that $f$ is of bounded variation on every closed, bounded interval $[a,b] \subseteq \R$.
    Thus by Corollary <span class="ref-unknown" title="Reference not found: cor:BV_functions_are_differentiable_a_e">[cor:BV_functions_are_differentiable_a_e?]</span>, we know that $f$ is differentiable almost everywhere on every closed, bounded interval $[a,b] \subseteq \R$.
<p>Now consider the collection $\{ [-k,k] : k\in\Z^+ \}$ which is a collection of closed, bounded intervals that cover $\R$.
    For each $k\in\Z^+$, there exists a set $N_k \subseteq [-k,k]$ with measure zero such that $f$ is differentiable at every point in $[-k,k] \setminus N_k$.
    Let
    \[ N := \bigcup_{k=1}^\infty N_k. \]
    Then $N$ has measure zero since it is a countable union of measure zero sets.
    Also if $x\in \R \setminus N$, then there exists some $k\in\Z^+$ such that $x\in[-k,k]$, and since $x\notin N$, we have $x\notin N_k$, so $f$ is differentiable at $x$.
    Thus $f$ is differentiable at every point in $\R \setminus N$, which shows that $f$ is differentiable almost everywhere on $\R$.
    <span class="proof-end">‚ñ°</span>
  </div>
</div></p>
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      console.log('Restoring proof collapse states...');
      try {
        const openProofs = JSON.parse(localStorage.getItem('openProofs') || '{}');
        const currentPage = window.location.pathname;
        const pageOpen = openProofs[currentPage] || [];
        
        console.log('Current page:', currentPage);
        console.log('Open proof IDs stored:', pageOpen);
        console.log('Found ' + pageOpen.length + ' open proofs for this page');
        
        document.querySelectorAll('.proof-box').forEach(box => {
          const proofId = box.getAttribute('data-proof-id');
          console.log('Checking proof:', proofId, 'Should be open:', pageOpen.includes(proofId));
          if (pageOpen.includes(proofId)) {
            // This proof should be open
            box.classList.remove('collapsed');
            const button = box.querySelector('.proof-toggle');
            button.setAttribute('aria-expanded', 'true');
          } else {
            // This proof should be collapsed (default)
            box.classList.add('collapsed');
            const button = box.querySelector('.proof-toggle');
            button.setAttribute('aria-expanded', 'false');
          }
        });
        
        const openBoxes = JSON.parse(localStorage.getItem('openBoxes') || '{}');
        const pageBoxes = openBoxes[currentPage] || [];
        
        console.log('Open box IDs stored:', pageBoxes);
        
        document.querySelectorAll('.collapsible-box').forEach(box => {
          const boxId = box.getAttribute('data-collapsible-id');
          console.log('Checking box:', boxId, 'Should be open:', pageBoxes.includes(boxId));
          if (pageBoxes.includes(boxId)) {
            box.classList.remove('collapsed');
          } else {
            box.classList.add('collapsed');
          }
        });
        
        console.log('Proof states restored');
      } catch (e) {
        console.error('Error restoring collapse state:', e);
      }
    });
    
    function toggleProof(proofId) {
      const proofContent = document.getElementById(proofId);
      const proofBox = proofContent.closest('.proof-box');
      proofBox.classList.toggle('collapsed');
      
      const button = proofBox.querySelector('.proof-toggle');
      button.setAttribute('aria-expanded', !proofBox.classList.contains('collapsed'));
      
      saveProofState();
    }
    
    function toggleSubproof(subproofId) {
      const subproofContent = document.getElementById(subproofId);
      const subproof = subproofContent.closest('.subproof');
      subproof.classList.toggle('collapsed');
      
      const button = subproof.querySelector('.subproof-toggle');
      button.setAttribute('aria-expanded', !subproof.classList.contains('collapsed'));
    }
    
    function saveProofState() {
      try {
        const currentPage = window.location.pathname;
        const openProofs = JSON.parse(localStorage.getItem('openProofs') || '{}');
        if (!openProofs[currentPage]) {
          openProofs[currentPage] = [];
        }
        
        // Get all OPEN (not collapsed) proofs
        openProofs[currentPage] = [];
        document.querySelectorAll('.proof-box:not(.collapsed)').forEach(box => {
          const proofId = box.getAttribute('data-proof-id');
          if (proofId) {
            openProofs[currentPage].push(proofId);
          }
        });
        
        localStorage.setItem('openProofs', JSON.stringify(openProofs));
        console.log('Saved proof state (open proofs):', openProofs[currentPage]);
      } catch (e) {
        console.error('Error saving collapse state:', e);
      }
    }
    
    function toggleCollapsible(collapsibleId) {
      const content = document.getElementById(collapsibleId);
      const box = content.closest('.collapsible-box');
      box.classList.toggle('collapsed');
      
      saveCollapsibleState();
    }
    
    function saveCollapsibleState() {
      try {
        const currentPage = window.location.pathname;
        const openBoxes = JSON.parse(localStorage.getItem('openBoxes') || '{}');
        if (!openBoxes[currentPage]) {
          openBoxes[currentPage] = [];
        }
        
        // Get all OPEN (not collapsed) boxes
        openBoxes[currentPage] = [];
        document.querySelectorAll('.collapsible-box:not(.collapsed)').forEach(box => {
          const boxId = box.getAttribute('data-collapsible-id');
          if (boxId) {
            openBoxes[currentPage].push(boxId);
          }
        });
        
        localStorage.setItem('openBoxes', JSON.stringify(openBoxes));
      } catch (e) {
        console.error('Error saving box state:', e);
      }
    }
    
    document.addEventListener('keydown', (e) => {
      if (e.key === 'p' && e.ctrlKey) {
        e.preventDefault();
        const proofBoxes = document.querySelectorAll('.proof-box');
        const anyExpanded = Array.from(proofBoxes).some(box => !box.classList.contains('collapsed'));
        
        proofBoxes.forEach(box => {
          if (anyExpanded) {
            box.classList.add('collapsed');
          } else {
            box.classList.remove('collapsed');
          }
        });
        
        saveProofState();
      }
    });
    
    document.querySelectorAll('a.ref-link').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const targetId = link.getAttribute('href').substring(1);
        const target = document.getElementById(targetId);
        if (target) {
          target.scrollIntoView({ behavior: 'smooth', block: 'center' });
          target.style.background = '#fef3c7';
          target.style.transition = 'background 0.3s ease';
          setTimeout(() => { target.style.background = ''; }, 1500);
        }
      });
    });
  </script>
</body>
</html>