<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>rademacher</title>
  <script>
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$', '$$'], ['\\[', '\\]']],
      processEscapes: true,
      processEnvironments: true,
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '0.8em',
      packages: {'[+]': ['ams']},
      macros: {
        R: '\\mathbb{R}',
        C: '\\mathbb{C}',
        N: '\\mathbb{N}',
        Z: '\\mathbb{Z}',
        Q: '\\mathbb{Q}',
        E: '\\mathbb{E}',
        F: '\\mathbb{F}',
        S: '\\mathbb{S}',
        H: '\\mathcal{H}',
        L: '\\mathcal{L}',
        dif: '\\,\\mathrm{d}',
        supp: '\\operatorname{supp}',
        proj: '\\operatorname{proj}',
        Id: '\\operatorname{Id}',
        Span: '\\operatorname{span}',
        graph: '\\operatorname{graph}',
        dist: '\\operatorname{dist}',
        diam: '\\operatorname{diam}',
        avg: '\\operatorname{avg}',
        div: '\\operatorname{div}',
        vol: '\\operatorname{vol}',
        ord: '\\operatorname{ord}',
        Chi: '\\mathbf{1}',
        sub: '\\subseteq',
        mres: '\\downharpoonright',
        ddag: '\\ddagger',
        dag: '\\dagger',
        norm: ['\\left\\| #1 \\right\\|', 1],
        abs: ['\\left| #1 \\right|', 1],
        set: ['\\left\\{ #1 \\right\\}', 1],
        inner: ['\\langle #1, #2 \\rangle', 2],
        floor: ['\\lfloor #1 \\rfloor', 1],
        ceil: ['\\lceil #1 \\rceil', 1],
        llbracket: '\\unicode{x27E6}',
        rrbracket: '\\unicode{x27E7}',
        bigskull: '\\unicode{x1F480}',
        skull: '\\unicode{x2620}',
        mathwitch: '\\unicode{x1F9D9}',
        pumpkin: '\\unicode{x1F383}',
        mathpumpkin: '\\unicode{x1F383}',
        bigpumpkin: '\\unicode{x1F383}',
        mathghost: '\\unicode{x1F47B}',
        mathcat: '\\unicode{x1F408}',
        mathbat: '\\unicode{x1F987}',
        esssup: '\\operatorname{ess\\,sup}',
        essinf: '\\operatorname{ess\\,inf}',
        Lip: '\\operatorname{Lip}',
        pd: ['\\frac{\\partial#1}{\\partial#2}', 2],
        od: ['\\frac{\\mathrm{d}#1}{\\mathrm{d}#2}', 2],
        dashint: '\\mathchoice{\\rlap{-}\\!\\int}{\\rlap{\\raise.15ex\\hbox{\\smash{\\scriptscriptstyle-}}}\\int}{\\rlap{\\raise.09ex\\hbox{\\smash{\\scriptscriptstyle-}}}\\int}{\\rlap{\\raise.09ex\\hbox{\\smash{\\scriptscriptstyle-}}}\\int}',
        eurologo: '\\unicode{x20AC}',
        starredbullet: '\\unicode{x2726}',
        grimace: '\\unicode{x1F62C}',
        textthing: '\\unicode{x2639}',
        noway: '\\unicode{x26D4}',
        warning: '\\unicode{x26A0}',
        danger: '\\unicode{x26A0}',
        textxswup: '\\unicode{x2195}',
        textxswdown: '\\unicode{x2195}',
        decoone: '\\unicode{x2756}',
        decotwo: '\\unicode{x2767}',
        decothreeleft: '\\unicode{x2619}',
        decothreeright: '\\unicode{x2767}',
        decofourleft: '\\unicode{x261A}',
        decofourright: '\\unicode{x261B}',
        floweroneleft: '\\unicode{x2740}',
        floweroneright: '\\unicode{x2740}',
        lefthand: '\\unicode{x261C}',
        righthand: '\\unicode{x261E}',
        decosix: '\\unicode{x2766}',
        bomb: '\\unicode{x1F4A3}',
        caution: '\\unicode{x2621}',
        leftblackhand: '\\unicode{x261A}',
        rightblackhand: '\\unicode{x261B}',
        leafleft: '\\unicode{x2618}',
        leafright: '\\unicode{x2618}',
        leafNW: '\\unicode{x2618}',
        leafNE: '\\unicode{x2618}',
        leafSE: '\\unicode{x2618}',
        leafSW: '\\unicode{x2618}',
        aldineleft: '\\unicode{x2619}',
        aldineright: '\\unicode{x2767}',
        aldine: '\\unicode{x2766}',
        aldinesmall: '\\unicode{x2767}',
        aldinesmallrevert: '\\unicode{x2619}',
        aldinesmallup: '\\unicode{x2766}',
        grappe: '\\unicode{x2766}',
        rightgrappe: '\\unicode{x2767}',
        leftgrappe: '\\unicode{x2619}',
        oldpilcrowone: '\\unicode{x00B6}',
        oldpilcrowtwo: '\\unicode{x00B6}',
        oldpilcrowthree: '\\unicode{x00B6}',
        oldpilcrowfour: '\\unicode{x00B6}',
        oldpilcrowfive: '\\unicode{x00B6}',
        oldpilcrowsix: '\\unicode{x00B6}'
      }
    },
    startup: {
      pageReady: () => {
        return MathJax.startup.defaultPageReady().then(() => {
          console.log('MathJax ready');
        });
      }
    }
  };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" id="MathJax-script"></script>
  <script>
  (function() {
    window.addEventListener('beforeunload', function() {
      saveProofState();
      saveCollapsibleState();
    });
    
    const eventSource = new EventSource('http://localhost:35729/reload-stream');
    
    eventSource.onmessage = function(event) {
      if (event.data === 'reload') {
        console.log('üìù File updated, saving state and reloading...');
        saveProofState();
        saveCollapsibleState();
        setTimeout(() => {
          window.location.reload();
        }, 50);
      }
    };
    
    eventSource.onerror = function() {
      console.log('‚ö†Ô∏è  Auto-reload server not available. Run node watch.js to enable auto-reload.');
      eventSource.close();
    };
    
    console.log('üîÑ Auto-reload enabled');
  })();
  </script>
  <style>
    * { box-sizing: border-box; }
    
    body {
      font-family: Georgia, "Times New Roman", serif;
      font-size: 16px;
      line-height: 1.7;
      margin: 0;
      padding: 0;
      color: #1a1a1a;
      background: #ffffff;
    }
    
    /* Layout with sidebar */
    .page-layout {
      display: flex;
      min-height: 100vh;
    }
    
    /* Sidebar styles */
    .sidebar {
      width: 280px;
      background: #fff;
      border-right: 1px solid #e0e0e0;
      position: fixed;
      top: 0;
      left: 0;
      height: 100vh;
      overflow-y: auto;
      padding: 20px 0;
      font-size: 14px;
    }
    
    .sidebar-header {
      padding: 15px 20px 25px;
      border-bottom: 1px solid #e0e0e0;
    }
    
    .sidebar-header h1 {
      font-size: 1.3em;
      font-weight: 600;
      color: #1a1a1a;
      margin: 0 0 5px 0;
    }
    
    .sidebar-header .subtitle {
      font-size: 0.85em;
      color: #666;
      font-style: italic;
    }
    
    .sidebar-header .back-link {
      display: block;
      font-size: 0.8em;
      color: #666;
      text-decoration: none;
      margin-top: 12px;
    }
    
    .sidebar-header .back-link:hover {
      color: #1a1a1a;
    }
    
    .sidebar-nav {
      padding: 10px 0;
    }
    
    .chapter-group {
      margin-bottom: 2px;
    }
    
    .chapter-title {
      padding: 12px 20px;
      font-size: 0.9em;
      font-weight: 600;
      color: #333;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .chapter-title:hover {
      background: #f5f5f5;
    }
    
    .chapter-title .toggle {
      font-size: 0.65em;
      color: #999;
      transition: transform 0.2s;
    }
    
    .chapter-group.expanded .chapter-title .toggle {
      transform: rotate(90deg);
    }
    
    .section-list {
      display: none;
      padding: 5px 0;
      background: #f8f8f8;
    }
    
    .chapter-group.expanded .section-list {
      display: block;
    }
    
    .section-link {
      display: block;
      padding: 8px 20px 8px 35px;
      font-size: 0.85em;
      color: #555;
      text-decoration: none;
      border-left: 3px solid transparent;
    }
    
    .section-link:hover {
      background: #f0f0f0;
      color: #1a1a1a;
    }
    
    .section-link.active {
      background: #e8e8e8;
      border-left-color: #333;
      color: #000;
      font-weight: 500;
    }
    
    /* Main content area */
    .main-content {
      margin-left: 280px;
      flex: 1;
      max-width: 900px;
      padding: 40px 60px;
    }
    
    @media (max-width: 1100px) {
      .sidebar {
        width: 240px;
      }
      .main-content {
        margin-left: 240px;
        padding: 30px 40px;
      }
    }
    
    @media (max-width: 800px) {
      .sidebar {
        position: relative;
        width: 100%;
        height: auto;
        border-right: none;
        border-bottom: 1px solid #e0e0e0;
      }
      .main-content {
        margin-left: 0;
        padding: 20px;
      }
      .page-layout {
        flex-direction: column;
      }
    }
    
    h2, h3, h4 {
      margin-top: 2em;
      margin-bottom: 0.75em;
      color: #000;
      font-weight: 600;
    }
    h2 { font-size: 1.5em; border-bottom: 1px solid #e0e0e0; padding-bottom: 0.3em; }
    h3 { font-size: 1.25em; }
    h4 { font-size: 1.1em; }
    p {
      margin: 1em 0;
      text-indent: 2em;
    }
    p:first-of-type,
    h2 + p,
    h3 + p,
    h4 + p,
    .theorem-box + p,
    .proof-box + p {
      text-indent: 0;
    }
    .noindent + p,
    p:has(> .noindent:first-child) {
      text-indent: 0 !important;
    }
    .noindent {
      display: none;
    }
    .theorem-box {
      margin: 1.75em 0;
      padding: 1.25em;
      border-left: 5px solid #16a34a;
      background: linear-gradient(to top, #bbf7d0 0%, #d1fae5 100%);
      border-radius: 6px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }
    .definition-box { border-left-color: #16a34a; background: linear-gradient(to top, #d1fae5 0%, #ecfdf5 100%); }
    .lemma-box { border-left-color: #1e3a8a; background: linear-gradient(to top, #bfdbfe 0%, #dbeafe 100%); }
    .corollary-box { border-left-color: #9333ea; background: linear-gradient(to top, #e9d5ff 0%, #f3e8ff 100%); }
    .proposition-box { border-left-color: #dc2626; background: linear-gradient(to top, #fecaca 0%, #fee2e2 100%); }
    .remark-box { border-left-color: #64748b; background: linear-gradient(to top, #e2e8f0 0%, #f1f5f9 100%); }
    .example-box { border-left-color: #0891b2; background: linear-gradient(to top, #a5f3fc 0%, #cffafe 100%); }
    .construction-box { border-left-color: #ea580c; background: linear-gradient(to top, #fed7aa 0%, #ffedd5 100%); }
    .notation-box { border-left-color: #ca8a04; background: linear-gradient(to top, #fef08a 0%, #fef9c3 100%); }
    .exercise-box { border-left-color: #ea580c; background: linear-gradient(to top, #fed7aa 0%, #ffedd5 100%); }
    .problem-box { border-left-color: #ec4899; background: linear-gradient(to top, #fbcfe8 0%, #fce7f3 100%); }
    .theorem-header {
      margin-bottom: 0.75em;
      font-size: 1.05em;
      font-weight: 600;
    }
    .theorem-header.clickable {
      cursor: pointer;
      user-select: none;
    }
    .theorem-header.clickable:hover {
      background: rgba(0,0,0,0.03);
      margin: -0.5em -0.75em 0.75em -0.75em;
      padding: 0.5em 0.75em;
      border-radius: 4px;
    }
    .collapsible-icon {
      display: inline-block;
      transition: transform 0.2s ease;
      font-size: 0.75em;
      margin-right: 0.5em;
      color: #6b7280;
    }
    .collapsible-box.collapsed .collapsible-icon {
      transform: rotate(-90deg);
    }
    .collapsible-content {
      transition: max-height 0.3s ease;
      overflow: hidden;
    }
    .collapsible-box.collapsed .collapsible-content {
      display: none;
    }
    .theorem-content {
      padding-left: 0.5em;
      line-height: 1.8;
    }
    .proof-box {
      margin: 1.5em 0;
      border: 1px solid #e5e7eb;
      border-radius: 6px;
      background: white;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }
    .proof-header {
      position: sticky;
      top: 0;
      background: linear-gradient(to bottom, #fafafa 0%, #f5f5f5 100%);
      border-bottom: 1px solid #e5e7eb;
      z-index: 100;
      border-radius: 6px 6px 0 0;
    }
    .proof-toggle {
      width: 100%;
      padding: 0.85em 1.25em;
      border: none;
      background: transparent;
      text-align: left;
      cursor: pointer;
      font-family: inherit;
      font-size: 1em;
      display: flex;
      align-items: center;
      gap: 0.75em;
      transition: background 0.15s;
    }
    .proof-toggle:hover { background: rgba(0,0,0,0.03); }
    .proof-toggle-icon {
      display: inline-block;
      transition: transform 0.2s ease;
      font-size: 0.75em;
      color: #6b7280;
    }
    .proof-box.collapsed .proof-toggle-icon {
      transform: rotate(-90deg);
    }
    .proof-content {
      padding: 1.25em;
      line-height: 1.8;
    }
    .proof-box.collapsed .proof-content {
      display: none;
    }
    .proof-end {
      float: right;
      font-size: 1.3em;
      margin-left: 0.5em;
      color: #374151;
    }
    .subproof {
      margin: 1em 0;
      border: 1px solid #d1d5db;
      border-radius: 4px;
      background: #f9fafb;
    }
    .subproof-header {
      background: linear-gradient(to bottom, #f9fafb 0%, #f3f4f6 100%);
      border-bottom: 1px solid #d1d5db;
      border-radius: 4px 4px 0 0;
    }
    .subproof-toggle {
      width: 100%;
      padding: 0.6em 1em;
      border: none;
      background: transparent;
      text-align: left;
      cursor: pointer;
      font-family: inherit;
      font-size: 0.95em;
      display: flex;
      align-items: center;
      gap: 0.5em;
      transition: background 0.15s;
    }
    .subproof-toggle:hover {
      background: rgba(0,0,0,0.03);
    }
    .subproof-toggle-icon {
      display: inline-block;
      transition: transform 0.2s ease;
      font-size: 0.7em;
      color: #6b7280;
    }
    .subproof.collapsed .subproof-toggle-icon {
      transform: rotate(-90deg);
    }
    .subproof-content {
      padding: 1em;
      line-height: 1.7;
    }
    .subproof.collapsed .subproof-content {
      display: none;
    }
    .ref-link {
      color: #2563eb;
      text-decoration: none;
      font-weight: 500;
      padding: 0 0.15em;
      border-radius: 2px;
    }
    .ref-link:hover {
      background: #dbeafe;
      text-decoration: underline;
    }
    .ref-unknown {
      color: #dc2626;
      font-weight: bold;
      background: #fee2e2;
      padding: 0.1em 0.3em;
      border-radius: 3px;
    }
    strong { font-weight: 600; }
    em { font-style: italic; }
    ol, ul {
      margin: 1em 0;
      padding-left: 2.5em;
      line-height: 1.8;
    }
    li {
      margin: 0.5em 0;
    }
    .latex-image {
      max-width: 100%;
      height: auto;
      display: block;
      margin: 1.5em auto;
    }
    .latex-figure .latex-image {
      display: inline-block;
      margin: 0.5em;
      vertical-align: middle;
    }
    .latex-figure {
      margin: 2em 0;
      text-align: center;
      line-height: 0;
    }
    .latex-figure .figure-content {
      margin-bottom: 0.75em;
      line-height: normal;
    }
    .latex-figure .figure-content > * {
      vertical-align: middle;
    }
    .latex-figure figcaption {
      font-size: 0.9em;
      color: #4b5563;
      font-style: italic;
      margin-top: 0.5em;
    }
  </style>
</head>
<body>
  <div class="page-layout">
    <nav class="sidebar">
      <div class="sidebar-header">
        <h1>Analysis III</h1>
        <div class="subtitle">Measure Theory &amp; Integration</div>
        <a href="../index.html" class="back-link">‚Üê Table of Contents</a>
      </div>
      <div class="sidebar-nav">
        <div class="chapter-group expanded">
          <div class="chapter-title" onclick="toggleChapter(this)"><span>1. Measure Theory</span><span class="toggle">‚ñ∂</span></div>
          <div class="section-list">
            <a href="../01-measure-theory/measure-theory.html" class="section-link">Overview</a>
            <a href="../01-measure-theory/basics.html" class="section-link">Outer Measures</a>
            <a href="../01-measure-theory/lebesgue-meas.html" class="section-link">Lebesgue Measure</a>
            <a href="../01-measure-theory/cantor.html" class="section-link">The Cantor Set</a>
            <a href="../01-measure-theory/measure-spaces.html" class="section-link">Measure Spaces</a>
          </div>
        </div>
        <div class="chapter-group">
          <div class="chapter-title" onclick="toggleChapter(this)"><span>2. Integration</span><span class="toggle">‚ñ∂</span></div>
          <div class="section-list">
            <a href="../02-integration/integration.html" class="section-link">Overview</a>
            <a href="../02-integration/integrals-1.html" class="section-link">Simple Functions</a>
            <a href="../02-integration/integrals-2.html" class="section-link">General Functions</a>
            <a href="../02-integration/convergence.html" class="section-link">Convergence Theorems</a>
            <a href="../02-integration/inequality-party.html" class="section-link">Integral Inequalities</a>
            <a href="../02-integration/lp_spaces.html" class="section-link">L·µñ Spaces</a>
          </div>
        </div>
        <div class="chapter-group">
          <div class="chapter-title" onclick="toggleChapter(this)"><span>3. Product Measures</span><span class="toggle">‚ñ∂</span></div>
          <div class="section-list">
            <a href="../03-fubini/fubini_ch.html" class="section-link">Overview</a>
            <a href="../03-fubini/fubini.html" class="section-link">Fubini-Tonelli</a>
            <a href="../03-fubini/integrals-3.html" class="section-link">Product Measures</a>
          </div>
        </div>
        <div class="chapter-group">
          <div class="chapter-title" onclick="toggleChapter(this)"><span>4. Differentiation I</span><span class="toggle">‚ñ∂</span></div>
          <div class="section-list">
            <a href="../04-differentiation-1/differentiation.html" class="section-link">Overview</a>
            <a href="../04-differentiation-1/covering.html" class="section-link">Vitali Covering</a>
            <a href="../04-differentiation-1/monotone.html" class="section-link">Monotone Functions</a>
            <a href="../04-differentiation-1/BV_on_R.html" class="section-link">Bounded Variation</a>
            <a href="../04-differentiation-1/FTOC.html" class="section-link">FTC for Lebesgue</a>
            <a href="../04-differentiation-1/HL.html" class="section-link">Hardy-Littlewood</a>
          </div>
        </div>
        <div class="chapter-group">
          <div class="chapter-title" onclick="toggleChapter(this)"><span>5. Differentiation I (cont)</span><span class="toggle">‚ñ∂</span></div>
          <div class="section-list">
            <a href="../05-differentiation-1/differentiation.html" class="section-link">Overview</a>
            <a href="../05-differentiation-1/r-nik.html" class="section-link">Radon-Nikodym</a>
          </div>
        </div>
        <div class="chapter-group">
          <div class="chapter-title" onclick="toggleChapter(this)"><span>6. Differentiation II</span><span class="toggle">‚ñ∂</span></div>
          <div class="section-list">
            <a href="../06-differentiation-2/diff-2.html" class="section-link">Overview</a>
            <a href="../06-differentiation-2/vector-measures.html" class="section-link">Vector Measures</a>
            <a href="../06-differentiation-2/r-nik.html" class="section-link">Radon-Nikodym</a>
            <a href="../06-differentiation-2/besi.html" class="section-link">Besicovitch</a>
            <a href="../06-differentiation-2/densities.html" class="section-link">Densities</a>
            <a href="../06-differentiation-2/diff-measures.html" class="section-link">Measure Derivatives</a>
          </div>
        </div>
        <div class="chapter-group">
          <div class="chapter-title" onclick="toggleChapter(this)"><span>7. Riesz Representation</span><span class="toggle">‚ñ∂</span></div>
          <div class="section-list">
            <a href="../06-riesz/riesz.html" class="section-link">Overview</a>
            <a href="../06-riesz/riesz_functional.html" class="section-link">Riesz Representation</a>
            <a href="../06-riesz/LCH_spaces.html" class="section-link">LCH Spaces</a>
          </div>
        </div>
        <div class="chapter-group">
          <div class="chapter-title" onclick="toggleChapter(this)"><span>8. Integral Formulas</span><span class="toggle">‚ñ∂</span></div>
          <div class="section-list">
            <a href="../07-formulas/formulas.html" class="section-link">Overview</a>
            <a href="../07-formulas/hausdorff_meas.html" class="section-link">Hausdorff Measures</a>
            <a href="../07-formulas/lippy.html" class="section-link">Lipschitz Maps</a>
            <a href="../07-formulas/rademacher.html" class="section-link">Rademacher</a>
            <a href="../07-formulas/coarea-prereq.html" class="section-link">Coarea Prerequisites</a>
            <a href="../07-formulas/coarea.html" class="section-link">Coarea Formula</a>
            <a href="../07-formulas/area-prereq.html" class="section-link">Area Prerequisites</a>
            <a href="../07-formulas/area-formula.html" class="section-link">Area Formula</a>
          </div>
        </div>
        <div class="chapter-group">
          <div class="chapter-title" onclick="toggleChapter(this)"><span>9. Extension Results</span><span class="toggle">‚ñ∂</span></div>
          <div class="section-list">
            <a href="../08-ext-res/ext-res.html" class="section-link">Overview</a>
            <a href="../08-ext-res/taylor_thm_integral_remainder.html" class="section-link">Taylor's Theorem</a>
            <a href="../08-ext-res/whitney-cover.html" class="section-link">Whitney Covering</a>
            <a href="../08-ext-res/whitney-partition-of-unity.html" class="section-link">Partition of Unity</a>
            <a href="../08-ext-res/whitney-decomposition.html" class="section-link">Decomposition</a>
            <a href="../08-ext-res/whitney-extension-theorem.html" class="section-link">Extension Theorem</a>
            <a href="../08-ext-res/whitney-extension-proof.html" class="section-link">Extension Proof</a>
            <a href="../08-ext-res/whitney-extension-applications.html" class="section-link">Applications</a>
            <a href="../08-ext-res/whitney-extension.html" class="section-link">Summary</a>
            <a href="../08-ext-res/more-bump.html" class="section-link">More Bump Functions</a>
          </div>
        </div>
      </div>
    </nav>
    
    <main class="main-content">
      <h2>Rademacher's Theorem</h2>
<p>In this section, we will prove the famous Rademacher's theorem, which states that Lipschitz functions on $\R^n$ are differentiable almost everywhere.
Later on, we will give another (independent) proof of Rademacher's theorem using the theory of Sobolev spaces.</p>
<h3>Rademacher's Theorem</h3>
<div class="theorem-box theorem-box" id="thm:rademacher_theorem">
  <div class="theorem-header"><strong>Theorem ?</strong> (Rademacher's Theorem)</div>
  <div class="theorem-content">Let $U \subseteq \R^n$ be open, and let $f : U \to \R$ be a Lipschitz function.
    Then $f$ is differentiable almost everywhere on $U$ and the derivative $Df : U \to \R^n$ is essentially bounded with
    \[ \|Df\|_{L^\infty(U)} \leq \Lip(f). \]
    In the case $U$ is a convex open set, we have equality $\|Df\|_{L^\infty(U)} = \Lip(f)$.</div>
</div>
<p>Here we remind you that the $L^\infty$-norm of the derivative $Df : U \to \R^n$, which is an $\R^n$-valued map, is defined by
\[ \|Df\|_{L^\infty(U)} := \| \|Df(\cdot)\| \|_{L^\infty(U)} = \esssup_{x \in U} \|Df(x)\| \]
i.e. as the $L^\infty$-norm of the function $x \mapsto \|Df(x)\|$.</p>
<p>Before the proof, we state a result that we will need and is of its own interest.</p>
<div class="theorem-box lemma-box" id="lem:fundamental_lemma_of_calculus_of_variations">
  <div class="theorem-header"><strong>Lemma ?</strong> (Fundamental Lemma in the Calculus of Variations)</div>
  <div class="theorem-content">Let $U\subseteq \R^n$ and let $f \in L^1_{\text{loc}}(U)$ be a locally integrable function.
    If \[ \int_{U} f(x) \varphi(x) \, dx = 0 \quad \text{for all } \varphi \in C_c^\infty(\R^n), \]
    then $f = 0$ almost everywhere in $\R^n$.</div>
</div>
<div class="proof-box collapsed" data-proof-id="proof-num-0">
  <div class="proof-header">
    <button class="proof-toggle" onclick="toggleProof('proof-num-0')" aria-expanded="false">
      <span class="proof-toggle-icon">‚ñº</span>
      <strong>Proof</strong>
    </button>
  </div>
  <div class="proof-content" id="proof-num-0">
    Towards a contradiction, suppose that $f\neq 0$ on a set of positive measure.
    Without loss of generality, suppose that there exists a set $A \subseteq \R^n$ with $\mathcal{L}^n(A) > 0$ such that $f(x) > 0$ for all $x\in A$.
    Hence there is a compact set $K \subset U$ and an $\epsilon > 0$ such that $f \geq \epsilon$ on $K$.
<p>Let $\{ V_j \}_{j=1}^\infty$ be a decreasing sequence of open sets such that $K \subset V_j \subset \subset U$; for each $j\geq 1$ let $\varphi_j \in C_c^\infty(V_j)$ be a bump function such that $\varphi_j = 1$ on $K$ and $0 \leq \varphi_j \leq 1$.
    Then we see that 
    \[ 0 = \int_{U} f(x) \varphi_j(x) \, \dif x \geq \int_{K} f(x)\varphi_j(x) \,\dif x - \int_{V_j \setminus K} f(x) \varphi_j(x) \, \dif x \geq \epsilon \mathcal{L}^n(K) - \int_{V_j \setminus K} f(x) \varphi_j(x) \, \dif x \]
    which converges to $\epsilon \mathcal{L}^n(K) > 0$ as $j \to \infty$ by the Dominated Convergence Theorem, a contradiction.
    <span class="proof-end">‚ñ°</span>
  </div>
</div></p>
<p>With the Fundamental Lemma of the Calculus of Variations in hand, we can now prove Rademacher's theorem.</p>
<div class="proof-box collapsed" data-proof-id="proof-proof-of-rademacher-s-theorem">
  <div class="proof-header">
    <button class="proof-toggle" onclick="toggleProof('proof-proof-of-rademacher-s-theorem')" aria-expanded="false">
      <span class="proof-toggle-icon">‚ñº</span>
      <strong>Proof of Rademacher's Theorem</strong>
    </button>
  </div>
  <div class="proof-content" id="proof-proof-of-rademacher-s-theorem">
    <em>Step 1:</em> We first prove the result in the case $U = \R^n$.
    <div style="margin: 1em 0;"></div>
<p><span class="noindent"></span>Let $f : \R^n \to \R$ be a Lipschitz function.
    For each unit vector $v \in \mathbb{S}^{n-1}$ and each $x\in \R^n$ we define
    \[ D_v f(x) := \lim_{t \to 0} \frac{f(x + tv) - f(x)}{t} \]
    whenever this limit exists.</p>
<p><div style="margin: 1em 0;"></div>
    <em>Step 1a:</em> We claim that for each $v\in \mathbb{S}^{n-1}$, the directional derivative $D_v f(x)$ exists for almost every $x \in \R^n$.
    <div style="margin: 1em 0;"></div></p>
<div class="subproof collapsed" data-subproof-id="subproof-1763576799681-0">
      <div class="subproof-header">
        <button class="subproof-toggle" onclick="toggleSubproof('subproof-1763576799681-0')" aria-expanded="false">
          <span class="subproof-toggle-icon">‚ñº</span>
          <strong>Proof of Step 1a</strong>
        </button>
      </div>
      <div class="subproof-content" id="subproof-1763576799681-0">
        Fix $v \in \mathbb{S}^{n-1}$.
    For each $x\in \R^n$ we also define
    \[ \overline{D}_v f(x) := \limsup_{t \to 0} \frac{f(x + tv) - f(x)}{t} \quad\text{and}\quad  \underline{D}_v f(x) := \liminf_{t \to 0} \frac{f(x + tv) - f(x)}{t} \]
    so that $D_v f(x)$ exists if and only if $\overline{D}_v f(x) = \underline{D}_v f(x)$.
    See that continuity of $f$ implies that $\overline{D}_v f$ and $\underline{D}_v f$ are measurable functions, as they are pointwise limits of measurable functions.
    Thus the set of points 
    \[ A_v := \{ x \in \R^n : \overline{D}_v f(x) > \underline{D}_v f(x) \} \]
    where $D_v f(x)$ does not exist is a measurable set.
    We will show that $A_v$ has measure zero.
<p>For each $x\in \R^n$ we define a function
    \[ \phi_{x,v} : \R\to \R, \qquad \phi_{x,v}(t) := f(x + tv). \]
    Then for each $x\in \R^n$ see that $\phi_{x,v}$ is a Lipschitz function on $\R$ with Lipschitz constant at most $\Lip(f)$, so by <span class="ref-unknown" title="Reference not found: ex:lipschitz_functions_are_absolutely_continuous">[ex:lipschitz_functions_are_absolutely_continuous?]</span> we know that $\phi_{x,v}$ is absolutely continuous on $\R$.
    Since AC functions on $\R$ are differentiable almost everywhere (Corollary <span class="ref-unknown" title="Reference not found: cor:AC_functions_are_differentiable_almost_everywhere">[cor:AC_functions_are_differentiable_almost_everywhere?]</span>), we know that for each $x\in \R^n$ the function $\phi_{x,v}$ is differentiable almost everywhere on $\R$.</p>
<p>Let $x\in \R^n$ be arbitrary, and let $L_{x,v} := \{  x + tv : t \in \R \}\subset \R^n$ be the line parallel to $v$ passing through $x$.
    Then the set $A_v \cap L_{x,v}$ is the set of points on the line $L_{x,v}$ where the directional derivative $D_v f$ does not exist.
    See that $x + tv \in A_v$ if and only if $\phi_{x,v}$ is not differentiable at $t$, so we have
    \[ A_v \cap L_{x,v} = \{ x + tv : t \in \R, \phi_{x,v} \ \text{ is not differentiable at } t \}. \]
    Letting $R_{x,v}$ be an affine isometry of $\R^n$ that sends $x$ to the origin and $v$ to $e_1 = (1,0,\ldots,0)$, we have
    \[ R_{x,v}( A_v \cap L_{x,v}) = (\{ t\in \R : \phi_{x,v} \ \text{ is not differentiable at } t \}) \times  \{0\}^{n-1}. \]
    Therefore
    \begin{align*}
        \mathcal{H}_{\R^n}^1(A_v \cap L_{x,v}) &= \mathcal{H}_{\R^n}^1(R_{x,v}( A_v \cap L_{x,v})) &&\text{ by isometry invariance of Hausdorff measure}\\
            &= \mathcal{H}_{\R^n}^1\left( (\{ t\in \R : \phi_{x,v} \ \text{ is not differentiable at } t \}) \times  \{0\}^{n-1} \right) \\
            &= \mathcal{H}^1_{\R \times \{0\}^{n-1}}(\{ t\in \R : \phi_{x,v} \ \text{ is not differentiable at } t \} \times \{ 0 \}^{n-1}) &&\text{ by remark [rem:which_hausdorff_measure_on_subsets?]}\\
            &= \mathcal{H}^1_{\R}(\{ t\in \R : \phi_{x,v} \ \text{ is not differentiable at } t \}) &&\text{ by isometry invariance of Hausdorff measure}\\
            &= \mathcal{L}^1(\{ t\in \R : \phi_{x,v} \ \text{ is not differentiable at } t \}) &&\text{ since }\mathcal{H}^1_{\R} = \mathcal{L}^1\\
            &= 0
    \end{align*}
    since $\phi_{x,v}$ is differentiable almost everywhere on $\R$.
    Thus for each $x\in \R^n$ we have shown that
    \[ \mathcal{H}^1(A_v \cap L_{x,v}) = 0. \]</p>
<p>See that for each $x\in \{v\}^\perp$ and each $t\in \R$, we have
    \[ \Chi_{A_v}(x + tv) = \begin{cases}
        1, & \text{if } x + tv \in A_v \\ 
        0, & \text{if } x + tv \notin A_v
    \end{cases} = \begin{cases}
        1, & \text{if } x + tv \in A_v \cap L_{x,v} \\
        0, & \text{otherwise}
    \end{cases} \]
    so that
    \[\Chi_{A_v}(x + tv) = \Chi_{A_v \cap L_{x,v}}(x+tv). \]</p>
<p>Thus by Funbini-Tonelli <span class="ref-unknown" title="Reference not found: prop:fubini_tonelli_for_hausdorff_measures_on_orthogonal_subspaces">[prop:fubini_tonelli_for_hausdorff_measures_on_orthogonal_subspaces?]</span> we have
    \begin{align*}
        \mathcal{L}^n(A_v) = \mathcal{H}^n(A_v) &= \int_{\R^n} \Chi_{A_v} \dif \mathcal{H}^n \\
            &=\int_{\operatorname{span}\{v\}} \int_{ \{v\}^\perp } \Chi_{A_v}(x+y) \,\dif \mathcal{H}^1(y) \,\dif \mathcal{H}^{n-1}(x) \\
            &=\int_{\R} \int_{ \{v\}^\perp } \Chi_{A_v}(x+tv) \,\dif \mathcal{H}^1(t) \,\dif \mathcal{H}^{n-1}(x) \\
            &=\int_{\R} \int_{ \{v\}^\perp } \Chi_{A_v \cap L_{x,v}}(x+tv) \,\dif \mathcal{H}^1(t) \,\dif \mathcal{H}^{n-1}(x) \\
            &=\int_\R \mathcal{H}^1(A_v \cap L_{x,v}) \,\dif \mathcal{H}^{n-1}(x) = 0
    \end{align*}
    since $\mathcal{H}^1(A_v \cap L_{x,v}) = 0$ for each $x\in \R^n$.
    Therefore the set $A_v$ where the directional derivative $D_v f$ does not exist has measure zero.</p>
<p>Thus we have shown that for each $v \in \mathbb{S}^{n-1}$, the directional derivative $D_v f(x)$ exists for almost every $x \in \R^n$.
        <span class="proof-end">‚ñ°</span>
      </div>
    </div></p>
<p><div style="margin: 1em 0;"></div>
    <em>Step 1b:</em> Now we define the gradient $\nabla f$.
    <div style="margin: 1em 0;"></div></p>
<p>For each $k = 1,2,\ldots,n$ we let $e_k$ be the $k$-th standard basis vector in $\R^n$, and we let 
    \[ D_k f(x) := D_{e_k} f(x) \]
    be the directional derivative of $f$ at $x$ in the direction $e_k$, whenever this limit exists.
    By Step 1a, for each $k = 1,2,\ldots,n$, the directional derivative $D_k f(x)$ exists for almost every $x \in \R^n$.</p>
<p>For each $x \in \R^n$ where all of the directional derivatives $D_1 f(x),\ldots,D_n f(x)$ are defined, we define the gradient $\nabla f(x) \in \R^n$ by
    \[ \nabla f(x) := (D_1 f(x),\ldots,D_n f(x)). \]
    Then $\nabla f(x)$ is well-defined for almost every $x \in \R^n$, but we still need to show that $f$ is actually differentiable at almost every point.
    (Recall that the existance of all directional derivatives does <em>not</em> imply differentiability.)</p>
<p><div style="margin: 1em 0;"></div>
    <em>Step 1c:</em> We claim that for each $v\in \mathbb{S}^{n-1}$ and almost every $x \in \R^n$ we have
    \[  D_v f(x) = \nabla f(x) \cdot v. \]
    <div style="margin: 1em 0;"></div></p>
<div class="subproof collapsed" data-subproof-id="subproof-1763576799681-1">
      <div class="subproof-header">
        <button class="subproof-toggle" onclick="toggleSubproof('subproof-1763576799681-1')" aria-expanded="false">
          <span class="subproof-toggle-icon">‚ñº</span>
          <strong>Proof of Step 1c</strong>
        </button>
      </div>
      <div class="subproof-content" id="subproof-1763576799681-1">
        Fix $v \in \mathbb{S}^{n-1}$ and let $\zeta \in C^\infty_c(\R^n)$ be an arbitrary bump function.
    Then for each $t\neq 0$ we see that
    \begin{align*}
        \int_{\R^n} \left( \frac{f(x+tv)- f(x)}{t} \right) \zeta(x) \,\dif x &= \int_{\R^n} \frac{f(x+tv)\zeta(x)}{t} \,\dif x - \int_{\R^n} \frac{f(x)\zeta(x)}{t} \,\dif x \\
            &= \int_{\R^n} \frac{f(x)\zeta(x-tv)}{t} \,\dif x - \int_{\R^n} \frac{f(x)\zeta(x)}{t} \,\dif x \\
            &= \int_{\R^n} f(x) \left( \frac{\zeta(x-tv) - \zeta(x)}{t} \right) \,\dif x \\
            &= -\int_{\R^n} f(x) \left( \frac{\zeta(x) - \zeta(x-tv)}{t} \right) \,\dif x \qquad\qquad(\heartsuit)
    \end{align*}
    by using translation invariance and linearity of the Lebesgue integral.
<p>Notice that for each $k\geq 1$ we have
    \[ \abs{ \frac{f\left( x + \frac{1}{k}v \right) - f(x)}{\frac{1}{k}} } \leq \Lip(f) \|v\| = \Lip(f) \]
    by definition of $f$ being Lipschitz, and also
    \[ \abs{ \frac{\zeta(x) - \zeta\left(x - \frac{1}{k}v\right)}{\frac{1}{k}} } \leq \|\nabla \zeta\|_{L^\infty(\R^n)} \|v\| =  \|\nabla \zeta\|_{L^\infty(\R^n)} \]
    by Exercise <span class="ref-unknown" title="Reference not found: ex:c1_functions_are_locally_lipschitz">[ex:c1_functions_are_locally_lipschitz?]</span>.
    These uniform bounds mean that we can apply the dominated convergence theorem to each side of $(\heartsuit)$ to conclude
    \begin{align*}
        \int_{\R^n} D_v f(x) \zeta(x) \,\dif x &= \int_{\R^n} \left( \lim_{k \to \infty} \frac{f\left( x + \frac{1}{k}v \right) - f(x)}{\frac{1}{k}} \right) \zeta(x) \,\dif x  &&\text{by definition of } D_v f \\
            &= \lim_{k \to \infty} \int_{\R^n} \frac{f\left( x + \frac{1}{k}v \right) - f(x)}{\frac{1}{k}} \zeta(x) \,\dif x &&\text{by Dominated Convergence Theorem}\\
            &= -\lim_{k \to \infty} \int_{\R^n} f(x) \left( \frac{\zeta(x) - \zeta\left(x - \frac{1}{k}v\right)}{\frac{1}{k}} \right) \,\dif x &&\text{ by } (\heartsuit) \\
            &= -\int_{\R^n} f(x) \left( \lim_{k \to \infty} \frac{\zeta(x) - \zeta\left(x - \frac{1}{k}v\right)}{\frac{1}{k}} \right) \,\dif x &&\text{ by Dominated Convergence Theorem}\\
            &= -\int_{\R^n} f(x) \nabla \zeta(x) \cdot v \,\dif x.
    \end{align*}</p>
<p><em>Note:</em> Later on (once everything is defined), the previous computation can be interpreted as saying that the weak directional derivative of $f$ in the direction $v$ is given by $D_v f = \nabla f \cdot v$.</p>
<p>We continue with the previous computation
    \[ \int_{\R^n} D_v f(x) \zeta(x) \,\dif x = -\int_{\R^n} f(x) \nabla \zeta(x) \cdot v \,\dif x = -\sum_{k=1}^n v_k \int_{\R^n} f(x) \partial_k \zeta(x) \,\dif x. \tag{$\spadesuit$} \]
    For the moment, we fix $k \in \{1,2,\ldots,n\}$.
    Then we can use Fubini's theorem and Integration by Parts for $AC$ functions to write
    \begin{align*}
        \int_{\R^n} f(x) \partial_k \zeta(x) \,\dif x &= \int_{\R^{n-1}} \left( \int_{\R} f(x_1,\ldots,x_n) \partial_k \zeta(x_1,\ldots,x_n) \,\dif x_k \right) \dif x_1\cdots \widehat{\dif x_k} \cdots \dif x_n \\
            &= -\int_{\R^{n-1}} \left( \int_{\R} \partial_k f(x_1,\ldots,x_n) \zeta(x_1,\ldots,x_n) \,\dif x_k \right) \dif x_1\cdots \widehat{\dif x_k} \cdots \dif x_n \\
            &= -\int_{\R^n} \partial_k f(x) \zeta(x) \,\dif x. 
    \end{align*}
    Returning to the previous computation $(\spadesuit)$, we have
    \begin{align*}
        \int_{\R^n} D_v f(x) \zeta(x) \,\dif x &= -\sum_{k=1}^n v_k \int_{\R^n} f(x) \partial_k \zeta(x) \,\dif x \\
            &= \sum_{k=1}^n v_k \int_{\R^n} \partial_k f(x) \zeta(x) \,\dif x \\
            &= \int_{\R^n} (\nabla f(x) \cdot v) \zeta(x) \,\dif x.
    \end{align*}
    Since $\zeta \in C^\infty_c(\R^n)$ was arbitrary, this shows that
    \[ \int_{\R^n} D_v f(x) \zeta(x) \,\dif x = \int_{\R^n} (\nabla f(x) \cdot v) \zeta(x) \,\dif x \quad\qquad\forall \zeta \in C^\infty_c(\R^n). \]
    By the Fundamental Theorem of the Calculus of Variations <span class="ref-unknown" title="Reference not found: lem:fundamental_lemma_of_calculus_of_variations">[lem:fundamental_lemma_of_calculus_of_variations?]</span>, this implies that
    \[ D_v f(x) = \nabla f(x) \cdot v \qquad \text{ for a.e. } x \in \R^n \]
    as claimed.
        <span class="proof-end">‚ñ°</span>
      </div>
    </div></p>
<p><div style="margin: 1em 0;"></div>
    <em>Step 2:</em> We let $\{ v_k \}_{k=1}^\infty$ be a countable dense subset of $\mathbb{S}^{n-1}$.
    For each $k\geq 1$, let $A_{v_k}$ be the set
    \[ A_{v_k} := \{ x \in \R^n : \text{ both } D_{v_k} f(x) \text{ and } \nabla f(x) \text{ exist and } D_{v_k} f(x) = \nabla f(x) \cdot v_k \}. \]
    Then by Step 1c, we know that $\mathcal{L}^n(\R^n \setminus A_{v_k}) = 0$ for each $k\geq 1$.
    Therefore the set
    \[ A := \bigcap_{k=1}^\infty A_{v_k} \]
    satisfies $\mathcal{L}^n(\R^n \setminus A) = 0$ since it is a countable intersection of full measure sets.
    We claim that $f$ is differentiable at each point $x \in A$.</p>
<div class="subproof collapsed" data-subproof-id="subproof-1763576799681-2">
      <div class="subproof-header">
        <button class="subproof-toggle" onclick="toggleSubproof('subproof-1763576799681-2')" aria-expanded="false">
          <span class="subproof-toggle-icon">‚ñº</span>
          <strong>Proof of Claim in Step 2</strong>
        </button>
      </div>
      <div class="subproof-content" id="subproof-1763576799681-2">
        Fix $x \in A$.
        For each $v\in \S^{n-1}$ and each $t > 0$ we define 
        \[ R(x,v,t) := \frac{f(x+tv) - f(x)}{t} - \nabla f(x) \cdot v. \]
        Then since $x \in A \subseteq A_{v_k}$ for each $k\geq 1$, we have
        \[ \lim_{t \to 0} R(x,v_k,t) = 0 \qquad\forall k \geq 1. \]
        For $v , \hat{v} \in \S^{n-1}$ and $t > 0$, we have
        \begin{align*}
            |R(x,v,t) - R(x,\hat{v},t)| &\leq \left| \frac{f(x+tv) - f(x+t\hat{v})}{t} \right| + |\nabla f(x) \cdot (v - \hat{v})| \\
                &\leq \Lip(f) \|v - \hat{v}\| + \|\nabla f(x)\| \|v - \hat{v}\| \\
                &= (\Lip(f) + \|\nabla f(x)\|) \|v - \hat{v}\|.
        \end{align*}
<p>Now let $\epsilon > 0$ be arbitrary.
        Since $\{ v_k \}_{k=1}^\infty$ is dense in $\S^{n-1}$, there exists $N \geq 1$ such that for each $v \in \S^{n-1}$ there exists $k \in \{1,2,\ldots,N\}$ with
        \[ \|v - v_k\| < \frac{\epsilon}{ 2(\Lip(f) + \|\nabla f(x)\|)}. \]
        Since $\lim_{t \to 0} R(x,v_k,t) = 0$ for each $k = 1,2,\ldots,N$, there exists $\delta > 0$ such that for all $t \in (0,\delta)$ and all $k = 1,2,\ldots,N$, we have
        \[ |R(x,v_k,t)| < \frac{\epsilon}{2}. \]
        As a result, for each $v \in \S^{n-1}$ there exists $k \in \{1,2,\ldots,N\}$ such that for all $t \in (0,\delta)$ we have
        \[ | R(x,v,t) | \leq |R(x,v,t) - R(x,v_k,t)| + |R(x,v_k,t)| < \epsilon. \]
        We note that $\delta > 0$ does not depend on $v \in \S^{n-1}$.</p>
<p>Now let $y\in \R^n\setminus \{ x \}$ be arbitrary and let $v := \frac{y-x}{\|y-x\|} \in \S^{n-1}$.
        Then 
        \[ y = x + \|y-x\| v. \]
        We set $t := \|y-x\| > 0$ and compute that
        \begin{align*}
            f(y) - f(x) &= f(x + tv) - f(x) \\
                &= t \left( \frac{f(x + tv) - f(x)}{t} - \nabla f(x) \cdot v \right) + t \nabla f(x) \cdot v \\
                &= t R(x,v,t) + \nabla f(x) \cdot (y-x).
        \end{align*}
        Now if $y \in B(x,\delta)\setminus \{ x \}$, then $t = \|y-x\| < \delta$, so we have
        \[ |f(y) - f(x) - \nabla f(x) \cdot (y-x)| = |t R(x,v,t)| < \epsilon \|y-x\|. \]
        Since $\epsilon > 0$ was arbitrary, this shows that
        \[ \lim_{y \to x} \frac{ |f(y) - f(x) - \nabla f(x) \cdot (y-x)| }{ \|y-x\| } = 0, \]
        so $f$ is differentiable at $x$ with derivative $Df(x) = \nabla f(x)$.</p>
<p>Since $x \in A$ was arbitrary, this shows that $f$ is differentiable at each point $x \in A$.
        <span class="proof-end">‚ñ°</span>
      </div>
    </div></p>
<p>With the claim proved, the fact that $\mathcal{L}^n(\R^n \setminus A) = 0$ implies that $f$ is differentiable almost everywhere on $\R^n$.</p>
<p><div style="margin: 1em 0;"></div>
In summary, we have shown that if $f : \R^n \to \R$ is a Lipschitz function, then $f$ is differentiable almost everywhere on $\R^n$.</p>
<p><div style="margin: 1em 0;"></div>
    <em>Step 3:</em>
    Now let $U\subseteq \R^n$ be an arbitrary open set, and let $f : U \to \R$ be a Lipschitz function.
    We claim that $f$ is differentiable almost everywhere on $U$.
    <div style="margin: 1em 0;"></div></p>
<p>This is easy to see. 
    By McShane's Extension Lemma <span class="ref-unknown" title="Reference not found: lem:mcshane_lemma">[lem:mcshane_lemma?]</span>, there exists a Lipschitz extension $\tilde{f} : \R^n \to \R$ of $f$ with $\Lip(\tilde{f}) = \Lip(f)$.
    By Step 2, the function $\tilde{f}$ is differentiable almost everywhere on $\R^n$.
    Thus the restriction $f = \tilde{f}|_U$ is differentiable almost everywhere on $U$ as well.</p>
<p><div style="margin: 1em 0;"></div>
    <em>Step 4:</em>
    We show that the derivative $Df : U \to \R^n$ is essentially bounded with
    \[ \|Df\|_{L^\infty(U)} \leq \Lip(f). \]</p>
<div class="subproof collapsed" data-subproof-id="subproof-1763576799681-3">
      <div class="subproof-header">
        <button class="subproof-toggle" onclick="toggleSubproof('subproof-1763576799681-3')" aria-expanded="false">
          <span class="subproof-toggle-icon">‚ñº</span>
          <strong>Proof of Step 4</strong>
        </button>
      </div>
      <div class="subproof-content" id="subproof-1763576799681-3">
        Let $x \in U$ be a point where $f$ is differentiable and assume that $Df(x) \neq 0$.
        Then by definition of differentiability, we have
        \[ \lim_{ y \to x } \frac{ |f(y) - f(x) - Df(x)(y-x)| }{ \|y-x\| } = 0. \]
        Thus for any $\epsilon > 0$, there exists $\delta > 0$ such that for all $y \in U$ with $\|y-x\| < \delta$, we have
        \[ |f(y) - f(x) - Df(x)(y-x)| \leq \epsilon \|y-x\|. \]
        Rearranging and using the triangle inequality, we have
        \[ |Df(x)(y-x)| \leq |f(y) - f(x)| + \epsilon \|y-x\| \qquad\forall y \in U \text{ with } \|y-x\| < \delta. \]
        Using the Lipschitz property of $f$, we have
        \[ |Df(x)(y-x)| \leq (\Lip(f) + \epsilon) \|y-x\| \qquad\forall y \in U \text{ with } \|y-x\| < \delta. \]
        Dividing both sides by $\|y-x\| > 0$, we obtain
        \[ \frac{ |Df(x)(y-x)| }{ \|y-x\| } \leq \Lip(f) + \epsilon \qquad\forall y \in U \text{ with } \|y-x\| < \delta. \]
        Since $U$ is an open set, there exists a point $y \in U$ with $\|y-x\| < \delta$ such that
        \[ \frac{y-x}{\|y-x\|} = \frac{Df(x)}{\|Df(x)\|}. \]
        That is, the vector $y-x$ points in the direction of maximal increase of the linear map $Df(x)$.
        With this choice of $y$, the previous inequality implies
        \[ \|Df(x)\| = \frac{ |Df(x)(y-x)| }{ \|y-x\| } \leq \Lip(f) + \epsilon. \]
        Since $\epsilon > 0$ was arbitrary, we conclude that
        \[ \|Df(x)\| \leq \Lip(f). \]
        Since this holds for each $x \in U$ where $f$ is differentiable, we conclude that
        \[ \|Df\|_{L^\infty(U)} \leq \Lip(f) \]
        by step 3.
        <span class="proof-end">‚ñ°</span>
      </div>
    </div>
<p><div style="margin: 1em 0;"></div>
    <em>Step 5:</em> In the case that $U$ is convex, we show that we have equality $\|Df\|_{L^\infty(U)} = \Lip(f)$.
    <div style="margin: 1em 0;"></div></p>
<div class="subproof collapsed" data-subproof-id="subproof-1763576799681-4">
      <div class="subproof-header">
        <button class="subproof-toggle" onclick="toggleSubproof('subproof-1763576799681-4')" aria-expanded="false">
          <span class="subproof-toggle-icon">‚ñº</span>
          <strong>Proof of Step 5</strong>
        </button>
      </div>
      <div class="subproof-content" id="subproof-1763576799681-4">
        Assume that $U \subseteq \R^n$ is a convex open set.
        Let $x,y \in U$ be arbitrary.
        Then the function 
        \[ g_{x,y}: [0,1] \to \R^n, \quad g_{x,y}(t) := f(x + t(y-x)) \]
        is absolutely continuous on $[0,1]$ with derivative
        \[ g_{x,y}'(t) = Df(x + t(y-x))(y-x) \]
        for almost every $t \in [0,1]$.
        Thus by the Fundamental Theorem of Calculus for $AC$ functions <span class="ref-unknown" title="Reference not found: thm:fundamental_theorem_of_calculus_for_ac_functions">[thm:fundamental_theorem_of_calculus_for_ac_functions?]</span> we have
        \begin{align*}
            f(y) - f(x) = g_{x,y}(1) - g_{x,y}(0) &= \int_0^1 g_{x,y}'(t) \,\dif t \\
                &= \int_0^1 Df(x + t(y-x))(y-x) \,\dif t.
        \end{align*}
        Taking norms and using the triangle inequality, we have
        \begin{align*}
            |f(y) - f(x)| &= \left| \int_0^1 Df(x + t(y-x))(y-x) \,\dif t \right| \\
                &\leq \int_0^1 |Df(x + t(y-x))(y-x)| \,\dif t \\
                &\leq \int_0^1 \|Df(x + t(y-x))\| \|y-x\| \,\dif t && \text{ by Cauchy-Schwarz inequality} \\
                &= \|y-x\| \int_0^1 \|Df(x + t(y-x))\| \,\dif t \\
                &\leq \|y-x\| \cdot \esssup_{t\in[0,1]} \|Df(x + t(y-x))\| \int_0^1 1 \,\dif t \\
                &\leq \|Df\|_{L^\infty(U)} \|y-x\|.
        \end{align*}
        Since $x,y \in U$ were arbitrary, it follows that
        \[ \Lip(f) \leq \|Df\|_{L^\infty(U)}. \]
        Combining this with the inequality from Step 4, we conclude that
        \[ \Lip(f) = \|Df\|_{L^\infty(U)}. \]
        <span class="proof-end">‚ñ°</span>
      </div>
    </div>
    <span class="proof-end">‚ñ°</span>
  </div>
</div>
<div class="theorem-box exercise-box" id="ex:equality_fails_for_non_convex_sets">
  <div class="theorem-header"><strong>Exercise ?</strong> (Equality Fails for Non-Convex Sets)</div>
  <div class="theorem-content">Give an example of a non-convex open set $U \subseteq \R^2$ and a Lipschitz function $f : U \to \R$ such that
    \[ \|Df\|_{L^\infty(U)} < \Lip(f). \]</div>
</div>
<div class="proof-box collapsed" data-proof-id="proof-num-2">
  <div class="proof-header">
    <button class="proof-toggle" onclick="toggleProof('proof-num-2')" aria-expanded="false">
      <span class="proof-toggle-icon">‚ñº</span>
      <strong>Proof</strong>
    </button>
  </div>
  <div class="proof-content" id="proof-num-2">
<p><span class="proof-end">‚ñ°</span>
  </div>
</div></p>
<div class="theorem-box theorem-box" id="thm:rademacher_theorem_for_rn_valued_maps">
  <div class="theorem-header"><strong>Theorem ?</strong> (Rademacher's Theorem for $\R^m$-Valued Maps)</div>
  <div class="theorem-content">Let $U \subseteq \R^n$ be open, and let $f : U \to \R^m$ be a Lipschitz map.
    Then $f$ is differentiable almost everywhere on $U$.</div>
</div>
<div class="proof-box collapsed" data-proof-id="proof-num-3">
  <div class="proof-header">
    <button class="proof-toggle" onclick="toggleProof('proof-num-3')" aria-expanded="false">
      <span class="proof-toggle-icon">‚ñº</span>
      <strong>Proof</strong>
    </button>
  </div>
  <div class="proof-content" id="proof-num-3">
    For each $k = 1,2,\ldots,m$, let $\pi_k : \R^m \to \R$ be the projection onto the $k$-th coordinate, i.e.
    \[ \pi_k(y_1,y_2,\ldots,y_m) := y_k. \]
    Then we have
    \[ f(x) = (f_1(x), f_2(x), \ldots, f_m(x)) \qquad\forall x \in U \]
    and for each $k = 1,2,\ldots,m$, the function $f_k := \pi_k \circ f : U \to \R$ is a Lipschitz function with $\Lip(f_k) \leq \Lip(f)$.
<p>By Rademacher's Theorem <span class="ref-unknown" title="Reference not found: thm:rademacher_theorem">[thm:rademacher_theorem?]</span>, for each $k=1,2,\ldots,m$, the function $f_k$ is differentiable almost everywhere on $U$ and has essentially bounded derivative $Df_k : U \to \R^n$.
    Thus the function $f : U \to \R^m$ is differentiable almost everywhere on $U$, with derivative
    \[ Df(x)h = (Df_1(x)h, Df_2(x)h, \ldots, Df_m(x)h) \qquad\forall h \in \R^n \]
    for almost every $x \in U$.
    <span class="proof-end">‚ñ°</span>
  </div>
</div></p>
<div class="theorem-box corollary-box" id="cor:rademacher_for_locally_lipschitz">
  <div class="theorem-header"><strong>Corollary ?</strong> (Rademacher's Theorem for Locally Lipschitz Functions)</div>
  <div class="theorem-content">Let $U \subseteq \R^n$ be open, and let $f : U \to \R^m$ be a locally Lipschitz map.
    Then $f$ is differentiable almost everywhere on $U$.</div>
</div>
<div class="proof-box collapsed" data-proof-id="proof-num-4">
  <div class="proof-header">
    <button class="proof-toggle" onclick="toggleProof('proof-num-4')" aria-expanded="false">
      <span class="proof-toggle-icon">‚ñº</span>
      <strong>Proof</strong>
    </button>
  </div>
  <div class="proof-content" id="proof-num-4">
    For each $x \in U$, since $f$ is locally Lipschitz, there exists an open ball $B(x,r_x) \subseteq U$ such that the restriction $f|_{B(x,r_x)} : B(x,r_x) \to \R^m$ is Lipschitz.
    By Rademacher's Theorem for $\R^m$-valued maps <span class="ref-unknown" title="Reference not found: thm:rademacher_theorem_for_rn_valued_maps">[thm:rademacher_theorem_for_rn_valued_maps?]</span>, the function $f|_{B(x,r_x)}$ is differentiable almost everywhere on $B(x,r_x)$.
<p>The collection of open balls $\{ B(x,r_x) : x \in U \}$ forms an open cover of $U$.
    Since $\R^n$ is a separable metric space, there exists a countable subcover $\{ B(x_k,r_{x_k}) : k = 1,2,\ldots \}$ of $U$.
    Then the set
    \[ A := U \setminus \bigcup_{k=1}^\infty \{ y \in B(x_k,r_{x_k}) : f|_{B(x_k,r_{x_k})} \text{ is not differentiable at } y \} \]
    satisfies
    \[ \mathcal{L}^n(U \setminus A) = 0 \]
    since it is a countable union of measure zero sets.
    Thus $f$ is differentiable at each point in $A$, so $f$ is differentiable almost everywhere on $U$.
    <span class="proof-end">‚ñ°</span>
  </div>
</div></p>
<div class="theorem-box corollary-box" id="cor:differentiability_on_level_sets">
  <div class="theorem-header"><strong>Corollary ?</strong> (Differentiability on Level Sets)</div>
  <div class="theorem-content"><ol><li>Let $U \subseteq \R^n$ be open, and let $f : U \to \R^m$ be a locally Lipschitz map.
        Then $D f(x) = 0$ for almost every $x \in f^{-1}(\{ 0 \})$.
        </li><li>Let $U \subseteq \R^n$ be open, and let $f,g : U \to \R^m$ be locally Lipschitz maps.
        Then $Dg(f(x))Df(x) = I_n$ for almost every $x \in U$ with $g(f(x)) = x$.</li></ol></div>
</div>
<div class="proof-box collapsed" data-proof-id="proof-num-5">
  <div class="proof-header">
    <button class="proof-toggle" onclick="toggleProof('proof-num-5')" aria-expanded="false">
      <span class="proof-toggle-icon">‚ñº</span>
      <strong>Proof</strong>
    </button>
  </div>
  <div class="proof-content" id="proof-num-5">
<p><span class="proof-end">‚ñ°</span>
  </div>
</div></p>
<p>We finish this section with a nice generalization of Rademacher's Theorem due to Stepanov.</p>
<div class="theorem-box theorem-box" id="thm:stepanov">
  <div class="theorem-header"><strong>Theorem ?</strong> (Stepanov's Theorem)</div>
  <div class="theorem-content"></div>
</div>
<div class="proof-box collapsed" data-proof-id="proof-num-6">
  <div class="proof-header">
    <button class="proof-toggle" onclick="toggleProof('proof-num-6')" aria-expanded="false">
      <span class="proof-toggle-icon">‚ñº</span>
      <strong>Proof</strong>
    </button>
  </div>
  <div class="proof-content" id="proof-num-6">
<p><span class="proof-end">‚ñ°</span>
  </div>
</div></p>
    </main>
  </div>
  
  <script>
    function toggleChapter(element) {
      element.parentElement.classList.toggle('expanded');
    }
    
    // Highlight current page in sidebar
    document.addEventListener('DOMContentLoaded', () => {
      const currentPath = window.location.pathname;
      const links = document.querySelectorAll('.section-link');
      links.forEach(link => {
        if (currentPath.endsWith(link.getAttribute('href').split('/').pop())) {
          link.classList.add('active');
          // Expand parent chapter
          const group = link.closest('.chapter-group');
          if (group) group.classList.add('expanded');
        }
      });
    });
    
    window.addEventListener('DOMContentLoaded', () => {
      console.log('Restoring proof collapse states...');
      try {
        const openProofs = JSON.parse(localStorage.getItem('openProofs') || '{}');
        const currentPage = window.location.pathname;
        const pageOpen = openProofs[currentPage] || [];
        
        console.log('Current page:', currentPage);
        console.log('Open proof IDs stored:', pageOpen);
        console.log('Found ' + pageOpen.length + ' open proofs for this page');
        
        document.querySelectorAll('.proof-box').forEach(box => {
          const proofId = box.getAttribute('data-proof-id');
          console.log('Checking proof:', proofId, 'Should be open:', pageOpen.includes(proofId));
          if (pageOpen.includes(proofId)) {
            box.classList.remove('collapsed');
            const button = box.querySelector('.proof-toggle');
            button.setAttribute('aria-expanded', 'true');
          } else {
            box.classList.add('collapsed');
            const button = box.querySelector('.proof-toggle');
            button.setAttribute('aria-expanded', 'false');
          }
        });
        
        const openBoxes = JSON.parse(localStorage.getItem('openBoxes') || '{}');
        const pageBoxes = openBoxes[currentPage] || [];
        
        console.log('Open box IDs stored:', pageBoxes);
        
        document.querySelectorAll('.collapsible-box').forEach(box => {
          const boxId = box.getAttribute('data-collapsible-id');
          console.log('Checking box:', boxId, 'Should be open:', pageBoxes.includes(boxId));
          if (pageBoxes.includes(boxId)) {
            box.classList.remove('collapsed');
          } else {
            box.classList.add('collapsed');
          }
        });
        
        console.log('Proof states restored');
      } catch (e) {
        console.error('Error restoring collapse state:', e);
      }
    });
    
    function toggleProof(proofId) {
      const proofContent = document.getElementById(proofId);
      const proofBox = proofContent.closest('.proof-box');
      proofBox.classList.toggle('collapsed');
      
      const button = proofBox.querySelector('.proof-toggle');
      button.setAttribute('aria-expanded', !proofBox.classList.contains('collapsed'));
      
      saveProofState();
    }
    
    function toggleSubproof(subproofId) {
      const subproofContent = document.getElementById(subproofId);
      const subproof = subproofContent.closest('.subproof');
      subproof.classList.toggle('collapsed');
      
      const button = subproof.querySelector('.subproof-toggle');
      button.setAttribute('aria-expanded', !subproof.classList.contains('collapsed'));
    }
    
    function saveProofState() {
      try {
        const currentPage = window.location.pathname;
        const openProofs = JSON.parse(localStorage.getItem('openProofs') || '{}');
        if (!openProofs[currentPage]) {
          openProofs[currentPage] = [];
        }
        
        openProofs[currentPage] = [];
        document.querySelectorAll('.proof-box:not(.collapsed)').forEach(box => {
          const proofId = box.getAttribute('data-proof-id');
          if (proofId) {
            openProofs[currentPage].push(proofId);
          }
        });
        
        localStorage.setItem('openProofs', JSON.stringify(openProofs));
        console.log('Saved proof state (open proofs):', openProofs[currentPage]);
      } catch (e) {
        console.error('Error saving collapse state:', e);
      }
    }
    
    function toggleCollapsible(collapsibleId) {
      const content = document.getElementById(collapsibleId);
      const box = content.closest('.collapsible-box');
      box.classList.toggle('collapsed');
      
      saveCollapsibleState();
    }
    
    function saveCollapsibleState() {
      try {
        const currentPage = window.location.pathname;
        const openBoxes = JSON.parse(localStorage.getItem('openBoxes') || '{}');
        if (!openBoxes[currentPage]) {
          openBoxes[currentPage] = [];
        }
        
        openBoxes[currentPage] = [];
        document.querySelectorAll('.collapsible-box:not(.collapsed)').forEach(box => {
          const boxId = box.getAttribute('data-collapsible-id');
          if (boxId) {
            openBoxes[currentPage].push(boxId);
          }
        });
        
        localStorage.setItem('openBoxes', JSON.stringify(openBoxes));
      } catch (e) {
        console.error('Error saving box state:', e);
      }
    }
    
    document.addEventListener('keydown', (e) => {
      if (e.key === 'p' && e.ctrlKey) {
        e.preventDefault();
        const proofBoxes = document.querySelectorAll('.proof-box');
        const anyExpanded = Array.from(proofBoxes).some(box => !box.classList.contains('collapsed'));
        
        proofBoxes.forEach(box => {
          if (anyExpanded) {
            box.classList.add('collapsed');
          } else {
            box.classList.remove('collapsed');
          }
        });
        
        saveProofState();
      }
    });
    
    document.querySelectorAll('a.ref-link').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const targetId = link.getAttribute('href').substring(1);
        const target = document.getElementById(targetId);
        if (target) {
          target.scrollIntoView({ behavior: 'smooth', block: 'center' });
          target.style.background = '#fef3c7';
          target.style.transition = 'background 0.3s ease';
          setTimeout(() => { target.style.background = ''; }, 1500);
        }
      });
    });
  </script>
</body>
</html>