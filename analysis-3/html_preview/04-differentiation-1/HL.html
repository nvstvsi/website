<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HL</title>
  <script>
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$', '$$'], ['\\[', '\\]']],
      processEscapes: true,
      processEnvironments: true,
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '0.8em',
      packages: {'[+]': ['ams']},
      macros: {
        R: '\\mathbb{R}',
        C: '\\mathbb{C}',
        N: '\\mathbb{N}',
        Z: '\\mathbb{Z}',
        Q: '\\mathbb{Q}',
        E: '\\mathbb{E}',
        F: '\\mathbb{F}',
        S: '\\mathbb{S}',
        H: '\\mathcal{H}',
        L: '\\mathcal{L}',
        dif: '\\,\\mathrm{d}',
        supp: '\\operatorname{supp}',
        proj: '\\operatorname{proj}',
        Id: '\\operatorname{Id}',
        Span: '\\operatorname{span}',
        graph: '\\operatorname{graph}',
        dist: '\\operatorname{dist}',
        diam: '\\operatorname{diam}',
        avg: '\\operatorname{avg}',
        div: '\\operatorname{div}',
        vol: '\\operatorname{vol}',
        ord: '\\operatorname{ord}',
        Chi: '\\mathbf{1}',
        sub: '\\subseteq',
        mres: '\\downharpoonright',
        ddag: '\\ddagger',
        dag: '\\dagger',
        norm: ['\\left\\| #1 \\right\\|', 1],
        abs: ['\\left| #1 \\right|', 1],
        set: ['\\left\\{ #1 \\right\\}', 1],
        inner: ['\\langle #1, #2 \\rangle', 2],
        floor: ['\\lfloor #1 \\rfloor', 1],
        ceil: ['\\lceil #1 \\rceil', 1],
        llbracket: '\\unicode{x27E6}',
        rrbracket: '\\unicode{x27E7}',
        bigskull: '\\unicode{x1F480}',
        skull: '\\unicode{x2620}',
        mathwitch: '\\unicode{x1F9D9}',
        pumpkin: '\\unicode{x1F383}',
        mathpumpkin: '\\unicode{x1F383}',
        bigpumpkin: '\\unicode{x1F383}',
        mathghost: '\\unicode{x1F47B}',
        mathcat: '\\unicode{x1F408}',
        mathbat: '\\unicode{x1F987}',
        esssup: '\\operatorname{ess\\,sup}',
        essinf: '\\operatorname{ess\\,inf}',
        Lip: '\\operatorname{Lip}',
        pd: ['\\frac{\\partial#1}{\\partial#2}', 2],
        od: ['\\frac{\\mathrm{d}#1}{\\mathrm{d}#2}', 2],
        dashint: '\\mathchoice{\\rlap{-}\\!\\int}{\\rlap{\\raise.15ex\\hbox{\\smash{\\scriptscriptstyle-}}}\\int}{\\rlap{\\raise.09ex\\hbox{\\smash{\\scriptscriptstyle-}}}\\int}{\\rlap{\\raise.09ex\\hbox{\\smash{\\scriptscriptstyle-}}}\\int}',
        eurologo: '\\unicode{x20AC}',
        starredbullet: '\\unicode{x2726}',
        grimace: '\\unicode{x1F62C}',
        textthing: '\\unicode{x2639}',
        noway: '\\unicode{x26D4}',
        warning: '\\unicode{x26A0}',
        danger: '\\unicode{x26A0}',
        textxswup: '\\unicode{x2195}',
        textxswdown: '\\unicode{x2195}',
        decoone: '\\unicode{x2756}',
        decotwo: '\\unicode{x2767}',
        decothreeleft: '\\unicode{x2619}',
        decothreeright: '\\unicode{x2767}',
        decofourleft: '\\unicode{x261A}',
        decofourright: '\\unicode{x261B}',
        floweroneleft: '\\unicode{x2740}',
        floweroneright: '\\unicode{x2740}',
        lefthand: '\\unicode{x261C}',
        righthand: '\\unicode{x261E}',
        decosix: '\\unicode{x2766}',
        bomb: '\\unicode{x1F4A3}',
        caution: '\\unicode{x2621}',
        leftblackhand: '\\unicode{x261A}',
        rightblackhand: '\\unicode{x261B}',
        leafleft: '\\unicode{x2618}',
        leafright: '\\unicode{x2618}',
        leafNW: '\\unicode{x2618}',
        leafNE: '\\unicode{x2618}',
        leafSE: '\\unicode{x2618}',
        leafSW: '\\unicode{x2618}',
        aldineleft: '\\unicode{x2619}',
        aldineright: '\\unicode{x2767}',
        aldine: '\\unicode{x2766}',
        aldinesmall: '\\unicode{x2767}',
        aldinesmallrevert: '\\unicode{x2619}',
        aldinesmallup: '\\unicode{x2766}',
        grappe: '\\unicode{x2766}',
        rightgrappe: '\\unicode{x2767}',
        leftgrappe: '\\unicode{x2619}',
        oldpilcrowone: '\\unicode{x00B6}',
        oldpilcrowtwo: '\\unicode{x00B6}',
        oldpilcrowthree: '\\unicode{x00B6}',
        oldpilcrowfour: '\\unicode{x00B6}',
        oldpilcrowfive: '\\unicode{x00B6}',
        oldpilcrowsix: '\\unicode{x00B6}'
      }
    },
    startup: {
      pageReady: () => {
        return MathJax.startup.defaultPageReady().then(() => {
          console.log('MathJax ready');
        });
      }
    }
  };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" id="MathJax-script"></script>
  <script>
  (function() {
    window.addEventListener('beforeunload', function() {
      saveProofState();
      saveCollapsibleState();
    });
    
    const eventSource = new EventSource('http://localhost:35729/reload-stream');
    
    eventSource.onmessage = function(event) {
      if (event.data === 'reload') {
        console.log('üìù File updated, saving state and reloading...');
        saveProofState();
        saveCollapsibleState();
        setTimeout(() => {
          window.location.reload();
        }, 50);
      }
    };
    
    eventSource.onerror = function() {
      console.log('‚ö†Ô∏è  Auto-reload server not available. Run node watch.js to enable auto-reload.');
      eventSource.close();
    };
    
    console.log('üîÑ Auto-reload enabled');
  })();
  </script>
  <style>
    * { box-sizing: border-box; }
    
    body {
      font-family: Georgia, "Times New Roman", serif;
      font-size: 16px;
      line-height: 1.7;
      margin: 0;
      padding: 0;
      color: #1a1a1a;
      background: #ffffff;
    }
    
    /* Layout with sidebar */
    .page-layout {
      display: flex;
      min-height: 100vh;
    }
    
    /* Sidebar styles */
    .sidebar {
      width: 280px;
      background: #fff;
      border-right: 1px solid #e0e0e0;
      position: fixed;
      top: 0;
      left: 0;
      height: 100vh;
      overflow-y: auto;
      padding: 20px 0;
      font-size: 14px;
    }
    
    .sidebar-header {
      padding: 15px 20px 25px;
      border-bottom: 1px solid #e0e0e0;
    }
    
    .sidebar-header h1 {
      font-size: 1.3em;
      font-weight: 600;
      color: #1a1a1a;
      margin: 0 0 5px 0;
    }
    
    .sidebar-header .subtitle {
      font-size: 0.85em;
      color: #666;
      font-style: italic;
    }
    
    .sidebar-header .back-link {
      display: block;
      font-size: 0.8em;
      color: #666;
      text-decoration: none;
      margin-top: 12px;
    }
    
    .sidebar-header .back-link:hover {
      color: #1a1a1a;
    }
    
    .sidebar-nav {
      padding: 10px 0;
    }
    
    .chapter-group {
      margin-bottom: 2px;
    }
    
    .chapter-title {
      padding: 12px 20px;
      font-size: 0.9em;
      font-weight: 600;
      color: #333;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .chapter-title:hover {
      background: #f5f5f5;
    }
    
    .chapter-title .toggle {
      font-size: 0.65em;
      color: #999;
      transition: transform 0.2s;
    }
    
    .chapter-group.expanded .chapter-title .toggle {
      transform: rotate(90deg);
    }
    
    .section-list {
      display: none;
      padding: 5px 0;
      background: #f8f8f8;
    }
    
    .chapter-group.expanded .section-list {
      display: block;
    }
    
    .section-link {
      display: block;
      padding: 8px 20px 8px 35px;
      font-size: 0.85em;
      color: #555;
      text-decoration: none;
      border-left: 3px solid transparent;
    }
    
    .section-link:hover {
      background: #f0f0f0;
      color: #1a1a1a;
    }
    
    .section-link.active {
      background: #e8e8e8;
      border-left-color: #333;
      color: #000;
      font-weight: 500;
    }
    
    /* Main content area */
    .main-content {
      margin-left: 280px;
      flex: 1;
      max-width: 900px;
      padding: 40px 60px;
    }
    
    @media (max-width: 1100px) {
      .sidebar {
        width: 240px;
      }
      .main-content {
        margin-left: 240px;
        padding: 30px 40px;
      }
    }
    
    @media (max-width: 800px) {
      .sidebar {
        position: relative;
        width: 100%;
        height: auto;
        border-right: none;
        border-bottom: 1px solid #e0e0e0;
      }
      .main-content {
        margin-left: 0;
        padding: 20px;
      }
      .page-layout {
        flex-direction: column;
      }
    }
    
    h2, h3, h4 {
      margin-top: 2em;
      margin-bottom: 0.75em;
      color: #000;
      font-weight: 600;
    }
    h2 { font-size: 1.5em; border-bottom: 1px solid #e0e0e0; padding-bottom: 0.3em; }
    h3 { font-size: 1.25em; }
    h4 { font-size: 1.1em; }
    p {
      margin: 1em 0;
      text-indent: 2em;
    }
    p:first-of-type,
    h2 + p,
    h3 + p,
    h4 + p,
    .theorem-box + p,
    .proof-box + p {
      text-indent: 0;
    }
    .noindent + p,
    p:has(> .noindent:first-child) {
      text-indent: 0 !important;
    }
    .noindent {
      display: none;
    }
    .theorem-box {
      margin: 1.75em 0;
      padding: 1.25em;
      border-left: 5px solid #16a34a;
      background: linear-gradient(to top, #bbf7d0 0%, #d1fae5 100%);
      border-radius: 6px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }
    .definition-box { border-left-color: #16a34a; background: linear-gradient(to top, #d1fae5 0%, #ecfdf5 100%); }
    .lemma-box { border-left-color: #1e3a8a; background: linear-gradient(to top, #bfdbfe 0%, #dbeafe 100%); }
    .corollary-box { border-left-color: #9333ea; background: linear-gradient(to top, #e9d5ff 0%, #f3e8ff 100%); }
    .proposition-box { border-left-color: #dc2626; background: linear-gradient(to top, #fecaca 0%, #fee2e2 100%); }
    .remark-box { border-left-color: #64748b; background: linear-gradient(to top, #e2e8f0 0%, #f1f5f9 100%); }
    .example-box { border-left-color: #0891b2; background: linear-gradient(to top, #a5f3fc 0%, #cffafe 100%); }
    .construction-box { border-left-color: #ea580c; background: linear-gradient(to top, #fed7aa 0%, #ffedd5 100%); }
    .notation-box { border-left-color: #ca8a04; background: linear-gradient(to top, #fef08a 0%, #fef9c3 100%); }
    .exercise-box { border-left-color: #ea580c; background: linear-gradient(to top, #fed7aa 0%, #ffedd5 100%); }
    .problem-box { border-left-color: #ec4899; background: linear-gradient(to top, #fbcfe8 0%, #fce7f3 100%); }
    .theorem-header {
      margin-bottom: 0.75em;
      font-size: 1.05em;
      font-weight: 600;
    }
    .theorem-header.clickable {
      cursor: pointer;
      user-select: none;
    }
    .theorem-header.clickable:hover {
      background: rgba(0,0,0,0.03);
      margin: -0.5em -0.75em 0.75em -0.75em;
      padding: 0.5em 0.75em;
      border-radius: 4px;
    }
    .collapsible-icon {
      display: inline-block;
      transition: transform 0.2s ease;
      font-size: 0.75em;
      margin-right: 0.5em;
      color: #6b7280;
    }
    .collapsible-box.collapsed .collapsible-icon {
      transform: rotate(-90deg);
    }
    .collapsible-content {
      transition: max-height 0.3s ease;
      overflow: hidden;
    }
    .collapsible-box.collapsed .collapsible-content {
      display: none;
    }
    .theorem-content {
      padding-left: 0.5em;
      line-height: 1.8;
    }
    .proof-box {
      margin: 1.5em 0;
      border: 1px solid #e5e7eb;
      border-radius: 6px;
      background: white;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }
    .proof-header {
      position: sticky;
      top: 0;
      background: linear-gradient(to bottom, #fafafa 0%, #f5f5f5 100%);
      border-bottom: 1px solid #e5e7eb;
      z-index: 100;
      border-radius: 6px 6px 0 0;
    }
    .proof-toggle {
      width: 100%;
      padding: 0.85em 1.25em;
      border: none;
      background: transparent;
      text-align: left;
      cursor: pointer;
      font-family: inherit;
      font-size: 1em;
      display: flex;
      align-items: center;
      gap: 0.75em;
      transition: background 0.15s;
    }
    .proof-toggle:hover { background: rgba(0,0,0,0.03); }
    .proof-toggle-icon {
      display: inline-block;
      transition: transform 0.2s ease;
      font-size: 0.75em;
      color: #6b7280;
    }
    .proof-box.collapsed .proof-toggle-icon {
      transform: rotate(-90deg);
    }
    .proof-content {
      padding: 1.25em;
      line-height: 1.8;
    }
    .proof-box.collapsed .proof-content {
      display: none;
    }
    .proof-end {
      float: right;
      font-size: 1.3em;
      margin-left: 0.5em;
      color: #374151;
    }
    .subproof {
      margin: 1em 0;
      border: 1px solid #d1d5db;
      border-radius: 4px;
      background: #f9fafb;
    }
    .subproof-header {
      background: linear-gradient(to bottom, #f9fafb 0%, #f3f4f6 100%);
      border-bottom: 1px solid #d1d5db;
      border-radius: 4px 4px 0 0;
    }
    .subproof-toggle {
      width: 100%;
      padding: 0.6em 1em;
      border: none;
      background: transparent;
      text-align: left;
      cursor: pointer;
      font-family: inherit;
      font-size: 0.95em;
      display: flex;
      align-items: center;
      gap: 0.5em;
      transition: background 0.15s;
    }
    .subproof-toggle:hover {
      background: rgba(0,0,0,0.03);
    }
    .subproof-toggle-icon {
      display: inline-block;
      transition: transform 0.2s ease;
      font-size: 0.7em;
      color: #6b7280;
    }
    .subproof.collapsed .subproof-toggle-icon {
      transform: rotate(-90deg);
    }
    .subproof-content {
      padding: 1em;
      line-height: 1.7;
    }
    .subproof.collapsed .subproof-content {
      display: none;
    }
    .ref-link {
      color: #2563eb;
      text-decoration: none;
      font-weight: 500;
      padding: 0 0.15em;
      border-radius: 2px;
    }
    .ref-link:hover {
      background: #dbeafe;
      text-decoration: underline;
    }
    .ref-unknown {
      color: #dc2626;
      font-weight: bold;
      background: #fee2e2;
      padding: 0.1em 0.3em;
      border-radius: 3px;
    }
    strong { font-weight: 600; }
    em { font-style: italic; }
    ol, ul {
      margin: 1em 0;
      padding-left: 2.5em;
      line-height: 1.8;
    }
    li {
      margin: 0.5em 0;
    }
    .latex-image {
      max-width: 100%;
      height: auto;
      display: block;
      margin: 1.5em auto;
    }
    .latex-figure .latex-image {
      display: inline-block;
      margin: 0.5em;
      vertical-align: middle;
    }
    .latex-figure {
      margin: 2em 0;
      text-align: center;
      line-height: 0;
    }
    .latex-figure .figure-content {
      margin-bottom: 0.75em;
      line-height: normal;
    }
    .latex-figure .figure-content > * {
      vertical-align: middle;
    }
    .latex-figure figcaption {
      font-size: 0.9em;
      color: #4b5563;
      font-style: italic;
      margin-top: 0.5em;
    }
  </style>
</head>
<body>
  <div class="page-layout">
    <nav class="sidebar">
      <div class="sidebar-header">
        <h1>Analysis III</h1>
        <div class="subtitle">Measure Theory &amp; Integration</div>
        <a href="../index.html" class="back-link">‚Üê Table of Contents</a>
      </div>
      <div class="sidebar-nav">
        <div class="chapter-group expanded">
          <div class="chapter-title" onclick="toggleChapter(this)"><span>1. Measure Theory</span><span class="toggle">‚ñ∂</span></div>
          <div class="section-list">
            <a href="../01-measure-theory/measure-theory.html" class="section-link">Overview</a>
            <a href="../01-measure-theory/basics.html" class="section-link">Outer Measures</a>
            <a href="../01-measure-theory/lebesgue-meas.html" class="section-link">Lebesgue Measure</a>
            <a href="../01-measure-theory/cantor.html" class="section-link">The Cantor Set</a>
            <a href="../01-measure-theory/measure-spaces.html" class="section-link">Measure Spaces</a>
          </div>
        </div>
        <div class="chapter-group">
          <div class="chapter-title" onclick="toggleChapter(this)"><span>2. Integration</span><span class="toggle">‚ñ∂</span></div>
          <div class="section-list">
            <a href="../02-integration/integration.html" class="section-link">Overview</a>
            <a href="../02-integration/integrals-1.html" class="section-link">Simple Functions</a>
            <a href="../02-integration/integrals-2.html" class="section-link">General Functions</a>
            <a href="../02-integration/convergence.html" class="section-link">Convergence Theorems</a>
            <a href="../02-integration/inequality-party.html" class="section-link">Integral Inequalities</a>
            <a href="../02-integration/lp_spaces.html" class="section-link">L·µñ Spaces</a>
          </div>
        </div>
        <div class="chapter-group">
          <div class="chapter-title" onclick="toggleChapter(this)"><span>3. Product Measures</span><span class="toggle">‚ñ∂</span></div>
          <div class="section-list">
            <a href="../03-fubini/fubini_ch.html" class="section-link">Overview</a>
            <a href="../03-fubini/fubini.html" class="section-link">Fubini-Tonelli</a>
            <a href="../03-fubini/integrals-3.html" class="section-link">Product Measures</a>
          </div>
        </div>
        <div class="chapter-group">
          <div class="chapter-title" onclick="toggleChapter(this)"><span>4. Differentiation I</span><span class="toggle">‚ñ∂</span></div>
          <div class="section-list">
            <a href="../04-differentiation-1/differentiation.html" class="section-link">Overview</a>
            <a href="../04-differentiation-1/covering.html" class="section-link">Vitali Covering</a>
            <a href="../04-differentiation-1/monotone.html" class="section-link">Monotone Functions</a>
            <a href="../04-differentiation-1/BV_on_R.html" class="section-link">Bounded Variation</a>
            <a href="../04-differentiation-1/FTOC.html" class="section-link">FTC for Lebesgue</a>
            <a href="../04-differentiation-1/HL.html" class="section-link">Hardy-Littlewood</a>
          </div>
        </div>
        <div class="chapter-group">
          <div class="chapter-title" onclick="toggleChapter(this)"><span>5. Differentiation I (cont)</span><span class="toggle">‚ñ∂</span></div>
          <div class="section-list">
            <a href="../05-differentiation-1/differentiation.html" class="section-link">Overview</a>
            <a href="../05-differentiation-1/r-nik.html" class="section-link">Radon-Nikodym</a>
          </div>
        </div>
        <div class="chapter-group">
          <div class="chapter-title" onclick="toggleChapter(this)"><span>6. Differentiation II</span><span class="toggle">‚ñ∂</span></div>
          <div class="section-list">
            <a href="../06-differentiation-2/diff-2.html" class="section-link">Overview</a>
            <a href="../06-differentiation-2/vector-measures.html" class="section-link">Vector Measures</a>
            <a href="../06-differentiation-2/r-nik.html" class="section-link">Radon-Nikodym</a>
            <a href="../06-differentiation-2/besi.html" class="section-link">Besicovitch</a>
            <a href="../06-differentiation-2/densities.html" class="section-link">Densities</a>
            <a href="../06-differentiation-2/diff-measures.html" class="section-link">Measure Derivatives</a>
          </div>
        </div>
        <div class="chapter-group">
          <div class="chapter-title" onclick="toggleChapter(this)"><span>7. Riesz Representation</span><span class="toggle">‚ñ∂</span></div>
          <div class="section-list">
            <a href="../06-riesz/riesz.html" class="section-link">Overview</a>
            <a href="../06-riesz/riesz_functional.html" class="section-link">Riesz Representation</a>
            <a href="../06-riesz/LCH_spaces.html" class="section-link">LCH Spaces</a>
          </div>
        </div>
        <div class="chapter-group">
          <div class="chapter-title" onclick="toggleChapter(this)"><span>8. Integral Formulas</span><span class="toggle">‚ñ∂</span></div>
          <div class="section-list">
            <a href="../07-formulas/formulas.html" class="section-link">Overview</a>
            <a href="../07-formulas/hausdorff_meas.html" class="section-link">Hausdorff Measures</a>
            <a href="../07-formulas/lippy.html" class="section-link">Lipschitz Maps</a>
            <a href="../07-formulas/rademacher.html" class="section-link">Rademacher</a>
            <a href="../07-formulas/coarea-prereq.html" class="section-link">Coarea Prerequisites</a>
            <a href="../07-formulas/coarea.html" class="section-link">Coarea Formula</a>
            <a href="../07-formulas/area-prereq.html" class="section-link">Area Prerequisites</a>
            <a href="../07-formulas/area-formula.html" class="section-link">Area Formula</a>
          </div>
        </div>
        <div class="chapter-group">
          <div class="chapter-title" onclick="toggleChapter(this)"><span>9. Extension Results</span><span class="toggle">‚ñ∂</span></div>
          <div class="section-list">
            <a href="../08-ext-res/ext-res.html" class="section-link">Overview</a>
            <a href="../08-ext-res/taylor_thm_integral_remainder.html" class="section-link">Taylor's Theorem</a>
            <a href="../08-ext-res/whitney-cover.html" class="section-link">Whitney Covering</a>
            <a href="../08-ext-res/whitney-partition-of-unity.html" class="section-link">Partition of Unity</a>
            <a href="../08-ext-res/whitney-decomposition.html" class="section-link">Decomposition</a>
            <a href="../08-ext-res/whitney-extension-theorem.html" class="section-link">Extension Theorem</a>
            <a href="../08-ext-res/whitney-extension-proof.html" class="section-link">Extension Proof</a>
            <a href="../08-ext-res/whitney-extension-applications.html" class="section-link">Applications</a>
            <a href="../08-ext-res/whitney-extension.html" class="section-link">Summary</a>
            <a href="../08-ext-res/more-bump.html" class="section-link">More Bump Functions</a>
          </div>
        </div>
      </div>
    </nav>
    
    <main class="main-content">
      <h2>Hardy-Littlewood Maximal Function and Lebesgue Differentiation Theorem</h2>
<h3>Differentiation of Integrals</h3>
<p>Suppose $f: [a,b]\to \R$ is an integrable function, and we let 
\[ F(x) := \int_a^x f(t) \,\dif t \qquad \forall x \in [a,b]. \]
If we want to differentiate the function $F$ at a point $x \in (a,b)$, we must use the difference quotient
\[ \frac{F(x+h) - F(x)}{h} = \frac{1}{h} \int_x^{x+h} f(t) \,\dif t. \]
We pause for a moment to note that this is precisely the average value of $f$ on the interval $(x,x+h)$ when $h > 0$, and on the interval $(x+h,x)$ when $h < 0$.
If we expect anything like the Fundamental Theorem of Calculus to hold, we would want this average value to converge to $f(x)$ as $h \to 0$.
That is, we would want
\[ \frac{1}{|I|} \int_I f(t) \,\dif t \to f(x) \quad \text{as } |I| \to 0, \]
where $I$ is any interval containing $x$, and $|I|$ denotes its length.
We can ask that $x$ be the center of $I$, as $I$ shrinks to $x$, or that only $x\in I$ as $|I| \to 0$.</p>
<p>Moving into higher dimensions, we can ask a similar question.
If $f$ is an integrable function on an open set $U \subseteq \R^n$, can we hope to have
\[ \frac{1}{\vol B} \int_B f(y) \,\dif y \to f(x) \quad \text{as } \vol B \to 0, \]
where $B$ is any ball containing $x$, and $\vol B$ denotes its volume?
This is known as the <strong>averaging problem</strong>.</p>
<div class="theorem-box exercise-box" id="ex:continuity_and_averaging">
  <div class="theorem-header"><strong>Exercise ?</strong> (Continuity and the Averaging Problem)</div>
  <div class="theorem-content">Let $f: U\to \R$ be an integrable function on an open set $U \subseteq \R^n$, and let $x \in U$ be such that $f$ is continuous at $x$.
    Show that
    \[ \frac{1}{\vol B} \int_B f(y) \,\dif y \to f(x) \quad \text{as } \vol B \to 0, \]
    where $B$ is any ball containing $x$.</div>
</div>
<div class="proof-box collapsed" data-proof-id="proof-num-0">
  <div class="proof-header">
    <button class="proof-toggle" onclick="toggleProof('proof-num-0')" aria-expanded="false">
      <span class="proof-toggle-icon">‚ñº</span>
      <strong>Proof</strong>
    </button>
  </div>
  <div class="proof-content" id="proof-num-0">
    Let $\varepsilon > 0$ be arbitrary.
    Since $f$ is continuous at $x$, there exists $\delta > 0$ such that
    \[ |f(y) - f(x)| < \varepsilon \quad \forall y \in B_n(x,\delta). \]
    Now, let $B$ be any ball containing $x$ with volume $\vol B < \vol B_n(0,\delta)$.
    Then $B \subseteq B_n(x,\delta)$, and we have
    \begin{align*}
        \left| \frac{1}{\vol B} \int_B f(y) \,\dif y - f(x) \right|
            &= \left| \frac{1}{\vol B} \int_B (f(y) - f(x)) \,\dif y \right| \\
            &\leq \frac{1}{\vol B} \int_B |f(y) - f(x)| \,\dif y \\
            &< \varepsilon.
    \end{align*}
    Since $\varepsilon > 0$ was arbitrary, the result follows.
    <span class="proof-end">‚ñ°</span>
  </div>
</div>
<h3>The Hardy-Littlewood Maximal Function</h3>
<div class="theorem-box definition-box" id="def:l1_loc_functions">
  <div class="theorem-header"><strong>Definition ?</strong></div>
  <div class="theorem-content">Let $U \subseteq \R^n$ be open.
    A function $f : U \to \R$ is said to be <em>locally integrable</em> on $U$ if for every compact set $K \subseteq U$, we have $f \in L^1(K)$.
    The collection of all locally integrable functions on $U$ is denoted by $L^1_{\text{loc}}(U)$, where we identify functions that are equal almost everywhere.</div>
</div>
<p>That is, an element of $L^1_{\text{loc}}(U)$ is formally an equivalence class of functions that are equal almost everywhere, but we will often abuse notation and refer to a particular representative of this equivalence class as the function itself.</p>
<p>Later we will generalize this definition to arbitrary Borel outer measures, but for now this will suffice.</p>
<div class="theorem-box definition-box" id="def:hardy_littlewood_maximal_function">
  <div class="theorem-header"><strong>Definition ?</strong></div>
  <div class="theorem-content">Let $f \in L^1_{\text{loc}}(\R^n)$.
    The <em>(uncentered) Hardy-Littlewood maximal function</em> of $f$ is the function $M f : \R^n \to [0,\infty]$ defined by
    \[ M f(x) := \sup_{ B \ni x } \frac{1}{\vol B} \int_B |f(y)| \,\dif y, \]
    where the supremum is taken over all balls $B$ containing $x$.
<p><div style="margin: 1em 0;"></div></p>
<p><span class="noindent"></span>Similarly the <em>(centered) Hardy-Littlewood maximal function</em> of $f$ is the function $M_c f : \R^n \to [0,\infty]$ defined by
    \[ M_c f(x) := \sup_{B_n(x,r)} \frac{1}{\vol B_n(x,r)} \int_{B_n(x,r)} |f(y)| \,\dif y, \]
    where the supremum is taken over all balls $B_n(x,r)$ centered at $x$.</div>
</div></p>
<p>For many pruposes, we can work interchangeably with either the centered or uncentered maximal function, as they are pointwise comparable.</p>
<div class="theorem-box exercise-box" id="ex:pointwise_comparison_maximal_functions">
  <div class="theorem-header"><strong>Exercise ?</strong> (Pointwise Comparison of Centered and Uncentered Maximal Functions)</div>
  <div class="theorem-content">Let $f \in L^1_{\text{loc}}(\R^n)$.
    Show that for each $x \in \R^n$, we have
    \[ M_c f(x) \leq M f(x) \leq 2^n M_c f(x). \]</div>
</div>
<div class="proof-box collapsed" data-proof-id="proof-num-1">
  <div class="proof-header">
    <button class="proof-toggle" onclick="toggleProof('proof-num-1')" aria-expanded="false">
      <span class="proof-toggle-icon">‚ñº</span>
      <strong>Proof</strong>
    </button>
  </div>
  <div class="proof-content" id="proof-num-1">
    Let $x \in \R^n$ be arbitrary.
    For any $r > 0$, we have
    \[ \frac{1}{\vol B_n(x,r)} \int_{B_n(x,r)} |f(y)| \,\dif y \leq M f(x), \]
    since $B_n(x,r)$ is a ball containing $x$.
    Taking the supremum over all $r > 0$, we obtain $M_c f(x) \leq M f(x)$.
<p>Conversely, let $B$ be any ball containing $x$.
    Then let $r := \text{radius}(B)$, and see that $B \subseteq B_n(x,2r)$.
    Thus,
    \begin{align*}
        \frac{1}{\vol B} \int_B |f(y)| \,\dif y
            &\leq \frac{1}{\vol B_n(x,2r)} \int_{B_n(x,2r)} |f(y)| \,\dif y \\
            &= \frac{1}{2^n \vol B_n(x,r)} \int_{B_n(x,2r)} |f(y)| \,\dif y \\
            &\leq 2^n M_c f(x).
    \end{align*}
    Taking the supremum over all balls $B$ containing $x$, we obtain $M f(x) \leq 2^n M_c f(x)$.
    <span class="proof-end">‚ñ°</span>
  </div>
</div></p>
<div class="theorem-box exercise-box" id="ex:sublinearity_of_maximal_function">
  <div class="theorem-header"><strong>Exercise ?</strong> (Sublinearity of the Hardy-Littlewood Maximal Function)</div>
  <div class="theorem-content">Let $f,g \in L^1_{\text{loc}}(\R^n)$ and $\alpha \in \R$.
    Show that
    \[ M(f + g)(x) \leq M f(x) + M g(x) \quad \text{and} \quad M(\alpha f)(x) = |\alpha| M f(x) \quad \forall x \in \R^n. \]</div>
</div>
<div class="proof-box collapsed" data-proof-id="proof-num-2">
  <div class="proof-header">
    <button class="proof-toggle" onclick="toggleProof('proof-num-2')" aria-expanded="false">
      <span class="proof-toggle-icon">‚ñº</span>
      <strong>Proof</strong>
    </button>
  </div>
  <div class="proof-content" id="proof-num-2">
    It's easy. 
    Let $x \in \R^n$ be arbitrary.
    For each ball $B$ containing $x$, we have
    \begin{align*}
        \frac{1}{\vol B} \int_B |f(y) + g(y)| \,\dif y
            &\leq \frac{1}{\vol B} \int_B |f(y)| \,\dif y + \frac{1}{\vol B} \int_B |g(y)| \,\dif y \\
            &\leq M f(x) + M g(x).
    \end{align*}
    Taking the supremum over all balls $B$ containing $x$, we obtain $M(f + g)(x) \leq M f(x) + M g(x)$.
<p>Similarly, for each ball $B$ containing $x$, we have
    \[
        \frac{1}{\vol B} \int_B |\alpha f(y)| \,\dif y = |\alpha| \frac{1}{\vol B} \int_B |f(y)| \,\dif y \leq |\alpha| M f(x).
    \]
    Taking the supremum over all balls $B$ containing $x$, we obtain $M(\alpha f)(x) = |\alpha| M f(x)$.
    <span class="proof-end">‚ñ°</span>
  </div>
</div></p>
<div class="theorem-box proposition-box" id="prop:maximal_function_properties">
  <div class="theorem-header"><strong>Proposition ?</strong> (Properties of the Hardy-Littlewood Maximal Function)</div>
  <div class="theorem-content">Let $f \in L^1_{\text{loc}}(\R^n)$.
    Then the following properties hold:
    <ol style="list-style-type: lower-roman;"><li>$M f$ is measurable,
        </li><li>if $f\in L^1(\R^n)$, then $M f(x) < \infty$ for almost every $x \in \R^n$, and
        </li><li>if $f\in L^1(\R^n)$, then for each $\alpha > 0$ the function $M f$ satisfies
            \[ \mathcal{L}^n(\{ x \in \R^n : M f(x) > \alpha \}) \leq \frac{3^n}{\alpha} \|f\|_{L^1(\R^n)} \]</li></ol></div>
</div>
<p>The inequality in part (iii) is known as the <em>Hardy-Littlewood Maximal Inequality</em>, or the <em>weak $(1,1)$ estimate</em> for the maximal function.
The notion of weak estimates will be made precise in later chapters.</p>
<div class="proof-box collapsed" data-proof-id="proof-num-3">
  <div class="proof-header">
    <button class="proof-toggle" onclick="toggleProof('proof-num-3')" aria-expanded="false">
      <span class="proof-toggle-icon">‚ñº</span>
      <strong>Proof</strong>
    </button>
  </div>
  <div class="proof-content" id="proof-num-3">
    (i) Let $\alpha > 0$ be arbitrary.
    Then we see that the set $\{ x \in \R^n : M f(x) > \alpha \}$ is open because if $x$ is in this set, then
    \[ \sup_{r > 0} \frac{1}{\vol B_n(x,r)} \int_{B_n(x,r)} |f(y)| \,\dif y > \alpha. \]
    Thus there exists a ball $B$ containing $x$ such that
    \[ \frac{1}{\vol B} \int_B |f(y)| \,\dif y > \alpha. \]
    and hence for each $\bar{x} \in B$ we also have $M f(\bar{x}) > \alpha$.
    Since $\alpha > 0$ was arbitrary, we conclude that $M f$ is measurable.
<p><div style="margin: 1em 0;"></div></p>
<p>Now we assume that $f \in L^1(\R^n)$, i.e. $\| f \|_{L^1(\R^n)} < \infty$.
We will prove parts (iii) and then show that part (ii) follows from part (iii).</p>
<p><div style="margin: 1em 0;"></div></p>
<p>(iii) Let $\alpha > 0$ be arbitrary, and let
    \[ E_\alpha := \{ x \in \R^n : M f(x) > \alpha \}. \]
    For each $x \in E_\alpha$, there exists a ball $B_x$ containing $x$ such that
    \[ \frac{1}{\vol B_x} \int_{B_x} |f(y)| \,\dif y > \alpha. \]
    Thus, we have
    \[ E_\alpha \subseteq \bigcup_{x \in E_\alpha} B_x. \]</p>
<p>Fix a compact subset $K \subseteq E_\alpha$.
    Then the collection $\{ B_x : x \in K \}$ is an open cover of $K$, so there exists a finite subcover $\{ B_j \}_{j=1}^N$ such that
    \[ K \subseteq \bigcup_{j=1}^N B_j. \]
    By the Vitali Covering Lemma (<span class="ref-unknown" title="Reference not found: lem:finite_3r_covering_lemma">[lem:finite_3r_covering_lemma?]</span>), there exists a disjoint subcollection $\{ B_{j_k} \}_{k=1}^M$ such that
    \[ K \subseteq \bigcup_{k=1}^M 3 B_{j_k}. \]
    Therefore, we have
    \begin{align*}
        \mathcal{L}^n(K) &\leq \sum_{k=1}^M \mathcal{L}^n(3 B_{j_k}) \\
            &= \sum_{k=1}^M 3^n \mathcal{L}^n(B_{j_k}) \\
            &< \sum_{k=1}^M \frac{3^n}{\alpha} \int_{B_{j_k}} |f(y)| \,\dif y \\
            &= \frac{3^n}{\alpha} \int_{\bigcup_{k=1}^M B_{j_k}} |f(y)| \,\dif y \\
            &\leq \frac{3^n}{\alpha} \|f\|_{L^1(\R^n)}
    \end{align*}
    since the balls $B_{j_k}$ are disjoint.
    Since $K \subseteq E_\alpha$ was an arbitrary compact subset, we conclude that
    \[ \mathcal{L}^n(E_\alpha) \leq \frac{3^n}{\alpha} \|f\|_{L^1(\R^n)}. \]</p>
<p>(ii) See that for each $\alpha > 0$, we have
    \[ \{ x \in \R^n : M f(x) = \infty \} \subseteq \{ x\in \R^n : M f(x) > \alpha \} \]
    so we must have that
    \[ \mathcal{L}^n(\{ x \in \R^n : M f(x) = \infty \}) \leq \mathcal{L}^n(\{ x\in \R^n : M f(x) > \alpha \}) \leq \frac{3^n}{\alpha} \|f\|_{L^1(\R^n)} \]
    for all $\alpha > 0$ by part (iii).
    Letting $\alpha \to \infty$, we conclude that $\mathcal{L}^n(\{ x \in \R^n : M f(x) = \infty \}) = 0$.
    <span class="proof-end">‚ñ°</span>
  </div>
</div></p>
<h3>The Lebesgue Differentiation Theorem</h3>
<p>We will now show that the estimate in Proposition <span class="ref-unknown" title="Reference not found: prop:maximal_function_properties">[prop:maximal_function_properties?]</span>(iii) allows us to solve the averaging problem for integrable functions.</p>
<div class="theorem-box theorem-box" id="thm:lebesgue_differentiation_theorem">
  <div class="theorem-header"><strong>Theorem ?</strong> (Lebesgue Differentiation Theorem)</div>
  <div class="theorem-content">Let $f \in L^1_{\text{loc}}(\R^n)$.
    Then for almost every $x \in \R^n$, we have
    \[ \lim_{\substack{ \vol B \to 0 \\ x\in B }} \frac{1}{\vol B} \int_B f(y) \,\dif y = f(x). \]</div>
</div>
<div class="proof-box collapsed" data-proof-id="proof-num-4">
  <div class="proof-header">
    <button class="proof-toggle" onclick="toggleProof('proof-num-4')" aria-expanded="false">
      <span class="proof-toggle-icon">‚ñº</span>
      <strong>Proof</strong>
    </button>
  </div>
  <div class="proof-content" id="proof-num-4">
    <em>Step 1:</em> First we assume that $f \in L^1(\R^n)$.
<p>It suffices to show that for each $\alpha > 0$ the set
    \[  E_\alpha := \left\{ x \in \R^n : \limsup_{\substack{ \vol B \to 0 \\ x\in B }} \left| \frac{1}{\vol B} \int_B f(y) \,\dif y - f(x) \right| > 2\alpha \right\} \]
    has measure zero.
    Indeed, if this is the case, then we see that $ E := \bigcup_{m=1}^\infty E_{1/m}$ has measure zero, and for each $x \notin E$ we have
    \[ \limsup_{\substack{ \vol B \to 0 \\ x\in B }} \left| \frac{1}{\vol B} \int_B f(y) \,\dif y - f(x) \right| < 2 \cdot \frac{1}{m} \quad \forall m \in \N, \]
    which implies that
    \[ \lim_{\substack{ \vol B \to 0 \\ x\in B }} \frac{1}{\vol B} \int_B f(y) \,\dif y = f(x). \]</p>
<p>So, let $\alpha > 0$ be arbitrary, and let $\epsilon > 0$.
    Since $f \in L^1(\R^n)$, there exists $g \in C_c(\R^n)$ such that
    \[ \| f - g \|_{L^1(\R^n)} < \epsilon \]
    since $C_c(\R^n)$ is dense in $L^1(\R^n)$ by Lemma <span class="ref-unknown" title="Reference not found: thm:density_of_Cc_in_Lp_on_lch_space">[thm:density_of_Cc_in_Lp_on_lch_space?]</span>.
    Since $g$ is continuous almost everywhere, by Exercise <span class="ref-unknown" title="Reference not found: ex:continuity_and_averaging">[ex:continuity_and_averaging?]</span> we have
    \[ \lim_{\substack{ \vol B \to 0 \\ x\in B }} \frac{1}{\vol B} \int_B g(y) \,\dif y = g(x) \quad \text{for each } x \in \R^n. \]
    Now
    \[ \frac{1}{\vol B} \int_B f(y) \,\dif y - f(x) = \frac{1}{\vol B} \int_B (f(y) - g(y)) \,\dif y + \frac{1}{\vol B} \int_B g(y) \,\dif y - g(x) + g(x) - f(x) \]
    implies that
    \[ \limsup_{ \substack{ \vol B \to 0 \\ x\in B } } \left| \frac{1}{\vol B} \int_B f(y) \,\dif y - f(x) \right| \leq M(f-g) + |g(x) - f(x)| \]
    by taking the limit superior (the middle term goes to zero by continuity of $g$).
    See that
    \[ E_\alpha \subseteq \{ x : M(f-g)(x) > \alpha \} \cup \{ x : |g(x) - f(x)| > \alpha \} \]
    and Chebyshev's inequality <span class="ref-unknown" title="Reference not found: lem:chebyshevs_inequality">[lem:chebyshevs_inequality?]</span> implies that
    \[ \mathcal{L}^n( \{ x : |f(x) - g(x)| > \alpha \} ) \leq \frac{1}{\alpha} \| f-g \|_{L^1(\R^n)} \]
    and the weak $(1,1)$ estimate from Proposition <span class="ref-unknown" title="Reference not found: prop:maximal_function_properties">[prop:maximal_function_properties?]</span>(iii) implies that
    \[ \mathcal{L}^n( \{ x : M(f-g)(x) > \alpha \} ) \leq \frac{3^n}{\alpha} \| f-g \|_{L^1(\R^n)}. \]
    Therefore, we have
    \[ \mathcal{L}^n(E_\alpha) \leq \frac{(3^n + 1)}{\alpha} \| f-g \|_{L^1(\R^n)} < \frac{(3^n + 1)}{\alpha} \epsilon. \]
    Since $\epsilon > 0$ was arbitrary, we conclude that $\mathcal{L}^n(E_\alpha) = 0$ and thus the result holds when $f \in L^1(\R^n)$.</p>
<p><div style="margin: 1em 0;"></div>
    <em>Step 2:</em> Now we consider the general case when $f \in L^1_{\text{loc}}(\R^n)$.
    For each $m \in \Z^+$, let $f_m := f \cdot \chi_{B_n(0,m)}$.
    Then $f_m \in L^1(\R^n)$ for each $m \in \N$, so by Step 1 we have
    \[ \lim_{\substack{ \vol B \to 0 \\ x\in B }} \frac{1}{\vol B} \int_B f_m(y) \,\dif y = f_m(x) \quad \text{for almost every } x \in \R^n. \]
    Let $A_m$ denote the set of measure zero where this limit fails for $f_m$.
    Then for each $x \notin \bigcup_{m=1}^\infty A_m$ and all $m\in \Z^+$ such that $\| x \| < m$, we have $f_m(x) = f(x)$ and
    \[ \lim_{\substack{ \vol B \to 0 \\ x\in B }} \frac{1}{\vol B} \int_B f(y) \,\dif y = \lim_{\substack{ \vol B \to 0 \\ x\in B }} \frac{1}{\vol B} \int_B f_m(y) \,\dif y = f_m(x) = f(x) \]
    That is, the set $\bigcup_{m=1}^\infty A_m$ has measure zero, and for each $x$ not in this set we have
    \[ \lim_{\substack{ \vol B \to 0 \\ x\in B }} \frac{1}{\vol B} \int_B f(y) \,\dif y = f(x) \]
    as desired.
    <span class="proof-end">‚ñ°</span>
  </div>
</div></p>
<div class="theorem-box corollary-box" id="cor:maximal_function_bounds_function">
  <div class="theorem-header"><strong>Corollary ?</strong> (Maximal Function Bounds Function Almost Everywhere)</div>
  <div class="theorem-content">Let $f \in L^1_{\text{loc}}(\R^n)$.
    Then for almost every $x \in \R^n$, we have $|f(x)| \leq M f(x)$ for almost every $x \in \R^n$.</div>
</div>
<div class="proof-box collapsed" data-proof-id="proof-num-5">
  <div class="proof-header">
    <button class="proof-toggle" onclick="toggleProof('proof-num-5')" aria-expanded="false">
      <span class="proof-toggle-icon">‚ñº</span>
      <strong>Proof</strong>
    </button>
  </div>
  <div class="proof-content" id="proof-num-5">
    We have $|f| \in L^1_{\text{loc}}(\R^n)$ since $f \in L^1_{\text{loc}}(\R^n)$.
    By Theorem <span class="ref-unknown" title="Reference not found: thm:lebesgue_differentiation_theorem">[thm:lebesgue_differentiation_theorem?]</span>, for almost every $x \in \R^n$ we have
    \[ \lim_{\substack{ \vol B \to 0 \\ x\in B }} \frac{1}{\vol B} \int_B |f(y)| \,\dif y = |f(x)|. \]
    Since
    \[ M f(x) = \sup_{ B \ni x } \frac{1}{\vol B} \int_B |f(y)| \,\dif y \geq \lim_{\substack{ \vol B \to 0 \\ x\in B }} \frac{1}{\vol B} \int_B |f(y)| \,\dif y, \]
    we conclude that $|f(x)| \leq M f(x)$ for almost every $x \in \R^n$.
    <span class="proof-end">‚ñ°</span>
  </div>
</div>
<div class="theorem-box corollary-box" id="cor:measure_theory_interior_and_exterior">
  <div class="theorem-header"><strong>Corollary ?</strong> (Measure Theoretic Interior and Exterior)</div>
  <div class="theorem-content">Let $A \subseteq \R^n$ be a Lebesgue measurable set.
    Then for almost every $x \in A$, we have
    \[ \lim_{ r\to 0^+ } \frac{\mathcal{L}^n( B_n(x,r) \cap A )}{\mathcal{L}(B_n(x,r))} = 1 \]
    and for almost every $x \in \R^n \setminus A$, we have
    \[ \lim_{ r\to 0^+ } \frac{\mathcal{L}^n( B_n(x,r) \cap A )}{\mathcal{L}(B_n(x,r))} = 0. \]</div>
</div>
<p>Traditionally, the sets of points $x\in \R^n$ where the above limit equals $1$ are called the <em>measure theoretic interior</em> of $A$, and the set of points where the limit equals $0$ are called the <em>measure theoretic exterior</em> of $A$.
Later, we will study a kind of measure theoretic boundary as well.</p>
<div class="proof-box collapsed" data-proof-id="proof-num-6">
  <div class="proof-header">
    <button class="proof-toggle" onclick="toggleProof('proof-num-6')" aria-expanded="false">
      <span class="proof-toggle-icon">‚ñº</span>
      <strong>Proof</strong>
    </button>
  </div>
  <div class="proof-content" id="proof-num-6">
    Since $A \subseteq \R^n$ is Lebesgue measurable, we have $\chi_A \in L^1_{\text{loc}}(\R^n)$.
    By Theorem <span class="ref-unknown" title="Reference not found: thm:lebesgue_differentiation_theorem">[thm:lebesgue_differentiation_theorem?]</span>, for almost every $x \in \R^n$ we have
    \[ \lim_{ r\to 0^+ } \frac{1}{\mathcal{L}(B_n(x,r))} \int_{B_n(x,r)} \chi_A(y) \,\dif y = \chi_A(x). \]
    If $x \in A$ is such a point, then $\chi_A(x) = 1$ and hence
    \[ \lim_{ r\to 0^+ } \frac{\mathcal{L}^n( B_n(x,r) \cap A )}{\mathcal{L}(B_n(x,r))} = 1. \]
    If $x \in \R^n \setminus A$ is such a point, then $\chi_A(x) = 0$ and hence
    \[ \lim_{ r\to 0^+ } \frac{\mathcal{L}^n( B_n(x,r) \cap A )}{\mathcal{L}(B_n(x,r))} = 0. \]
    <span class="proof-end">‚ñ°</span>
  </div>
</div>
<div class="theorem-box definition-box" id="def:lebesgue_point">
  <div class="theorem-header"><strong>Definition ?</strong> (Lebesgue Point)</div>
  <div class="theorem-content">Let $f \in L^1_{\text{loc}}(\R^n)$.
    A point $x \in \R^n$ is called a <em>Lebesgue point</em> of $f$ if
    \[ \lim_{\substack{ \vol B \to 0 \\ x\in B }} \frac{1}{\vol B} \int_B |f(y) - f(x)| \,\dif y = 0. \]
    The set of all Lebesgue points of $f$ is called the <em>Lebesgue set</em> of $f$.</div>
</div>
<div class="theorem-box remark-box collapsible-box collapsed" id="remark-?" data-collapsible-id="collapsible-remark-1">
  <div class="theorem-header clickable" onclick="toggleCollapsible('collapsible-remark-1')">
    <span class="collapsible-icon">‚ñº</span>
    <strong>Remark ?</strong>
  </div>
  <div class="theorem-content collapsible-content" id="collapsible-remark-1">By Exercise <span class="ref-unknown" title="Reference not found: ex:continuity_and_averaging">[ex:continuity_and_averaging?]</span>, every point where $f$ is continuous is a Lebesgue point of $f$.
    Furthermore, the triangle inequality implies thatif $x$ is a Lebesgue point of $f$, then
    \[ \lim_{\substack{ \vol B \to 0 \\ x\in B }} \frac{1}{\vol B} \int_B f(y) \,\dif y = f(x). \]</div>
</div>
<div class="theorem-box corollary-box" id="cor:lebesgue_points_almost_everywhere">
  <div class="theorem-header"><strong>Corollary ?</strong></div>
  <div class="theorem-content">Let $f \in L^1_{\text{loc}}(\R^n)$.
    Then almost every point $x \in \R^n$ is a Lebesgue point of $f$.</div>
</div>
<div class="proof-box collapsed" data-proof-id="proof-num-7">
  <div class="proof-header">
    <button class="proof-toggle" onclick="toggleProof('proof-num-7')" aria-expanded="false">
      <span class="proof-toggle-icon">‚ñº</span>
      <strong>Proof</strong>
    </button>
  </div>
  <div class="proof-content" id="proof-num-7">
    For each rational number $ r \in \Q $, consider the function $g_r := |f - r|$.
    Then $g_r \in L^1_{\text{loc}}(\R^n)$, so by Theorem <span class="ref-unknown" title="Reference not found: thm:lebesgue_differentiation_theorem">[thm:lebesgue_differentiation_theorem?]</span>, there exists a set $N_r \subseteq \R^n$ of measure zero such that for each $x \in \R^n \setminus N_r$, we have
    \[ \lim_{\substack{ \vol B \to 0 \\ x\in B }} \frac{1}{\vol B} \int_B g_r(y) \,\dif y = g_r(x) = |f(x) - r|. \]
    Let $N := \bigcup_{r \in \Q} N_r$ which has measure zero since $\Q$ is countable.
<p>Now let $x \in \R^n \setminus N$ be arbitrary and assume that $f(x)$ is finite.
    (Note that by Proposition <span class="ref-unknown" title="Reference not found: prop:maximal_function_properties">[prop:maximal_function_properties?]</span>(ii) and <span class="ref-unknown" title="Reference not found: cor:maximal_function_bounds_function">[cor:maximal_function_bounds_function?]</span>, $f(x)$ is finite for almost every $x \in \R^n$.)
    Let $\epsilon > 0$ be arbitrary, and choose $r \in \Q$ such that $|f(x) - r| < \epsilon/2$.
    Because 
    \[ \frac{1}{\vol B} \int_B | f(y) - f(x) | \,\dif y \leq \frac{1}{\vol B} \int_B | f(y) - r | \,\dif y + |f(x) - r| \]
    taking the limit superior as $\vol B \to 0$ and $x \in B$, we have
    \[ \limsup_{\substack{ \vol B \to 0 \\ x\in B }} \frac{1}{\vol B} \int_B | f(y) - f(x) | \,\dif y \leq \lim_{\substack{ \vol B \to 0 \\ x\in B }} \frac{1}{\vol B} \int_B | f(y) - r | \,\dif y + |f(x) - r| = 2|f(x) - r| < \epsilon \]
    since $x \notin N_r$.
    Since $\epsilon > 0$ was arbitrary, we conclude that
    \[ \lim_{\substack{ \vol B \to 0 \\ x\in B }} \frac{1}{\vol B} \int_B | f(y) - f(x) | \,\dif y = 0, \]
    so $x$ is a Lebesgue point of $f$.
    <span class="proof-end">‚ñ°</span>
  </div>
</div></p>
<div class="theorem-box remark-box collapsible-box collapsed" id="rem:precise_representative" data-collapsible-id="collapsible-rem:precise_representative">
  <div class="theorem-header clickable" onclick="toggleCollapsible('collapsible-rem:precise_representative')">
    <span class="collapsible-icon">‚ñº</span>
    <strong>Remark ?</strong> (A Precise Representative)
  </div>
  <div class="theorem-content collapsible-content" id="collapsible-rem:precise_representative">Let $f : \R^n \to \R$ be a locally integrable function.
    By Corollary <span class="ref-unknown" title="Reference not found: cor:lebesgue_points_almost_everywhere">[cor:lebesgue_points_almost_everywhere?]</span>, almost every point $x \in \R^n$ is a Lebesgue point of $f$.
    Thus, we can define a new function $f^* : \R^n \to \R$ by
    \[ f^*(x) := \begin{cases} \lim_{\substack{ \vol B \to 0 \\ x\in B }} \frac{1}{\vol B} \int_B f(y) \,\dif y & \text{if } x \text{ is a Lebesgue point of } f, \\ 0 & \text{otherwise}. \end{cases} \]
    Then $f^*$ is equal to $f$ almost everywhere, and has the property that
    \[ \lim_{\substack{ \vol B \to 0 \\ x\in B }} \frac{1}{\vol B} \int_B f^*(y) \,\dif y = f^*(x) \quad \text{for every } x \in \R^n. \]
    We call $f^*$ the <em>precise representative</em> of $f$.
<p>Recall that $L^1_{\text{loc}}(\R^n)$ is defined as the set of equivalence classes of functions that are equal almost everywhere.
    Thus, if $f,g$ are two representatives of the same equivalence class in $L^1_{\text{loc}}(\R^n)$, then their precise representatives $f^*,g^*$ are equal everywhere.
    In particular, the precise representative for an equivalence class in $L^1_{\text{loc}}(\R^n)$ is unique.
    This is nice, as there is some ambiguity in working with equivalence classes of functions, and a canonical representative removes this ambiguity.
    Thus, if we ever need to evaluate things pointwise, we can always use the precise representative.</div>
</div></p>
<p>So far the theory has been developed for averaging over balls. 
One can generalize this of course, to other families of sets. 
One way to capture this is the following definition.</p>
<div class="theorem-box definition-box" id="def:shrink_regularly">
  <div class="theorem-header"><strong>Definition ?</strong></div>
  <div class="theorem-content">A collection of sets $\{ U_i \}_{i \in I}$ in $\R^n$ is said to <em>shrink regularly</em> to a point $x \in \R^n$ if there exists a constant $c > 0$ such that for each $i \in I$, there exists a ball $B_i$ containing $x$ with
    \[ U_i \subseteq B_i \quad \text{and} \quad \vol B_i \leq c \cdot \vol U_i. \]</div>
</div>
<p>Thus the sets $U_i$ are all contained in balls that are not too much larger in volume.
For instance, if $x\in \R^n$ then the collection of cubes centered at $x$ shrinks regularly to $x$.
With this definition, we can generalize the Lebesgue Differentiation Theorem as follows.</p>
<div class="theorem-box corollary-box" id="cor:lebesgue_differentiation_theorem_shrink_regularly">
  <div class="theorem-header"><strong>Corollary ?</strong></div>
  <div class="theorem-content">Let $f \in L^1_{\text{loc}}(\R^n)$, and let $\{ U_i \}_{i \in I}$ be a collection of sets that shrink regularly to $x \in \R^n$.
    If $x$ is a Lebesgue point of $f$, then
    \[ \lim_{\substack{ \mathcal{L}^n(U_i) \to 0 \\ x\in U_i }} \frac{1}{\mathcal{L}^n(U_i)} \int_{U_i} f(y) \,\dif y = f(x). \]</div>
</div>
<div class="proof-box collapsed" data-proof-id="proof-num-8">
  <div class="proof-header">
    <button class="proof-toggle" onclick="toggleProof('proof-num-8')" aria-expanded="false">
      <span class="proof-toggle-icon">‚ñº</span>
      <strong>Proof</strong>
    </button>
  </div>
  <div class="proof-content" id="proof-num-8">
    Let $x \in \R^n$ be a Lebesgue point of $f$.
    Since $\{ U_i \}_{i \in I}$ shrinks regularly to $x$, there exists a constant $c > 0$ such that for each $i \in I$, there exists a ball $B_i$ containing $x$ with
    \[ U_i \subseteq B_i \quad \text{and} \quad \vol B_i \leq c \cdot \vol U_i. \]
    Then
    \[ \frac{1}{\mathcal{L}^n(U_i)} \int_{U_i} |f(y) - f(x)| \,\dif y \leq \frac{1}{c\,\vol B_i} \int_{B_i} |f(y) - f(x)| \,\dif y. \]
    Taking the limit as $\vol B_i \to 0$, the right-hand side goes to zero since $x$ is a Lebesgue point of $f$.
    Thus,
    \[ \lim_{\substack{ \mathcal{L}^n(U_i) \to 0 \\ x\in U_i }} \frac{1}{\mathcal{L}^n(U_i)} \int_{U_i} |f(y) - f(x)| \,\dif y = 0, \]
    which implies the result.
    <span class="proof-end">‚ñ°</span>
  </div>
</div>
    </main>
  </div>
  
  <script>
    function toggleChapter(element) {
      element.parentElement.classList.toggle('expanded');
    }
    
    // Highlight current page in sidebar
    document.addEventListener('DOMContentLoaded', () => {
      const currentPath = window.location.pathname;
      const links = document.querySelectorAll('.section-link');
      links.forEach(link => {
        if (currentPath.endsWith(link.getAttribute('href').split('/').pop())) {
          link.classList.add('active');
          // Expand parent chapter
          const group = link.closest('.chapter-group');
          if (group) group.classList.add('expanded');
        }
      });
    });
    
    window.addEventListener('DOMContentLoaded', () => {
      console.log('Restoring proof collapse states...');
      try {
        const openProofs = JSON.parse(localStorage.getItem('openProofs') || '{}');
        const currentPage = window.location.pathname;
        const pageOpen = openProofs[currentPage] || [];
        
        console.log('Current page:', currentPage);
        console.log('Open proof IDs stored:', pageOpen);
        console.log('Found ' + pageOpen.length + ' open proofs for this page');
        
        document.querySelectorAll('.proof-box').forEach(box => {
          const proofId = box.getAttribute('data-proof-id');
          console.log('Checking proof:', proofId, 'Should be open:', pageOpen.includes(proofId));
          if (pageOpen.includes(proofId)) {
            box.classList.remove('collapsed');
            const button = box.querySelector('.proof-toggle');
            button.setAttribute('aria-expanded', 'true');
          } else {
            box.classList.add('collapsed');
            const button = box.querySelector('.proof-toggle');
            button.setAttribute('aria-expanded', 'false');
          }
        });
        
        const openBoxes = JSON.parse(localStorage.getItem('openBoxes') || '{}');
        const pageBoxes = openBoxes[currentPage] || [];
        
        console.log('Open box IDs stored:', pageBoxes);
        
        document.querySelectorAll('.collapsible-box').forEach(box => {
          const boxId = box.getAttribute('data-collapsible-id');
          console.log('Checking box:', boxId, 'Should be open:', pageBoxes.includes(boxId));
          if (pageBoxes.includes(boxId)) {
            box.classList.remove('collapsed');
          } else {
            box.classList.add('collapsed');
          }
        });
        
        console.log('Proof states restored');
      } catch (e) {
        console.error('Error restoring collapse state:', e);
      }
    });
    
    function toggleProof(proofId) {
      const proofContent = document.getElementById(proofId);
      const proofBox = proofContent.closest('.proof-box');
      proofBox.classList.toggle('collapsed');
      
      const button = proofBox.querySelector('.proof-toggle');
      button.setAttribute('aria-expanded', !proofBox.classList.contains('collapsed'));
      
      saveProofState();
    }
    
    function toggleSubproof(subproofId) {
      const subproofContent = document.getElementById(subproofId);
      const subproof = subproofContent.closest('.subproof');
      subproof.classList.toggle('collapsed');
      
      const button = subproof.querySelector('.subproof-toggle');
      button.setAttribute('aria-expanded', !subproof.classList.contains('collapsed'));
    }
    
    function saveProofState() {
      try {
        const currentPage = window.location.pathname;
        const openProofs = JSON.parse(localStorage.getItem('openProofs') || '{}');
        if (!openProofs[currentPage]) {
          openProofs[currentPage] = [];
        }
        
        openProofs[currentPage] = [];
        document.querySelectorAll('.proof-box:not(.collapsed)').forEach(box => {
          const proofId = box.getAttribute('data-proof-id');
          if (proofId) {
            openProofs[currentPage].push(proofId);
          }
        });
        
        localStorage.setItem('openProofs', JSON.stringify(openProofs));
        console.log('Saved proof state (open proofs):', openProofs[currentPage]);
      } catch (e) {
        console.error('Error saving collapse state:', e);
      }
    }
    
    function toggleCollapsible(collapsibleId) {
      const content = document.getElementById(collapsibleId);
      const box = content.closest('.collapsible-box');
      box.classList.toggle('collapsed');
      
      saveCollapsibleState();
    }
    
    function saveCollapsibleState() {
      try {
        const currentPage = window.location.pathname;
        const openBoxes = JSON.parse(localStorage.getItem('openBoxes') || '{}');
        if (!openBoxes[currentPage]) {
          openBoxes[currentPage] = [];
        }
        
        openBoxes[currentPage] = [];
        document.querySelectorAll('.collapsible-box:not(.collapsed)').forEach(box => {
          const boxId = box.getAttribute('data-collapsible-id');
          if (boxId) {
            openBoxes[currentPage].push(boxId);
          }
        });
        
        localStorage.setItem('openBoxes', JSON.stringify(openBoxes));
      } catch (e) {
        console.error('Error saving box state:', e);
      }
    }
    
    document.addEventListener('keydown', (e) => {
      if (e.key === 'p' && e.ctrlKey) {
        e.preventDefault();
        const proofBoxes = document.querySelectorAll('.proof-box');
        const anyExpanded = Array.from(proofBoxes).some(box => !box.classList.contains('collapsed'));
        
        proofBoxes.forEach(box => {
          if (anyExpanded) {
            box.classList.add('collapsed');
          } else {
            box.classList.remove('collapsed');
          }
        });
        
        saveProofState();
      }
    });
    
    document.querySelectorAll('a.ref-link').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const targetId = link.getAttribute('href').substring(1);
        const target = document.getElementById(targetId);
        if (target) {
          target.scrollIntoView({ behavior: 'smooth', block: 'center' });
          target.style.background = '#fef3c7';
          target.style.transition = 'background 0.3s ease';
          setTimeout(() => { target.style.background = ''; }, 1500);
        }
      });
    });
  </script>
</body>
</html>